{
  "number": 1739,
  "title": "refactor(http-uri): flatten 3-level nesting in alloc_and_validate empty allocation",
  "body": "## Summary\n\nThe `alloc_and_validate` function contains 3 levels of nested if statements in the empty string allocation logic, which can be simplified with a guard clause.\n\n## Location\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/http/SocketHTTP-uri.c`  \n**Lines**: 141-151  \n**Function**: `alloc_and_validate`  \n**Pattern**: `DEEP_NESTING_3`  \n**Severity**: MEDIUM\n\n## Current Code\n\n```c\nif (!start || end <= start)\n  {\n    if (alloc_empty)\n      {\n        char *empty = arena_strndup (arena, \"\", 0);\n        if (!empty)\n          return URI_PARSE_ERROR;\n        *out_str = empty;\n        *out_len = 0;\n      }\n    return URI_PARSE_OK;\n  }\n```\n\n## Issue\n\nThis code has **3 levels of nesting**:\n1. `if` (empty input check)\n2. `if` (alloc_empty flag check)\n3. `if` (allocation failure check)\n\n## Recommendation\n\nFlatten using guard clauses and early returns:\n\n```c\n/* Handle empty input */\nif (!start || end <= start)\n  {\n    if (!alloc_empty)\n      return URI_PARSE_OK;\n    \n    char *empty = arena_strndup (arena, \"\", 0);\n    if (!empty)\n      return URI_PARSE_ERROR;\n    \n    *out_str = empty;\n    *out_len = 0;\n    return URI_PARSE_OK;\n  }\n```\n\nThis reduces nesting from 3 levels to 2 levels by using an early return for the `!alloc_empty` case.\n\n## Context\n\nThis helper function is used to allocate and validate URI components (scheme, host, path, etc.). The `alloc_empty` parameter controls whether empty strings should be allocated or left as NULL.\n\n## Category\nReadability refactoring",
  "labels": [
    "enhancement",
    "wip:claude-1767051301-3810271"
  ],
  "state": "OPEN",
  "dependencies": []
}