{
  "number": 1743,
  "title": "refactor(http1-serialize): inline single-use add_optional_host_header function",
  "body": "## Summary\n\nThe static function `add_optional_host_header` (lines 287-313) is only called once in the entire file, making it a candidate for inlining to improve code locality.\n\n## Location\n\n**File**: `src/http/SocketHTTP1-serialize.c`\n**Lines**: 287-313 (27 lines)\n**Called at**: Line 319 in `add_request_extras`\n\n## Current Code\n\n```c\nstatic int\nadd_optional_host_header (const SocketHTTP_Request *request, char **buf,\n                          size_t *remaining)\n{\n  size_t auth_len;\n\n  if (!request->authority || request->authority[0] == '\\0')\n    return 0;\n\n  if (request->headers && SocketHTTP_Headers_has (request->headers, \"Host\"))\n    return 0;\n\n  if (safe_append (buf, remaining, HTTP_HOST_PREFIX, HTTP_HOST_PREFIX_LEN) < 0)\n    return -1;\n\n  auth_len = strlen (request->authority);\n  if (!SocketHTTP_header_value_valid (request->authority, auth_len))\n    {\n      SOCKET_RAISE_MSG (\n          SocketHTTP1, SocketHTTP1_SerializeError,\n          \"Invalid authority contains forbidden characters (CR/LF/NUL)\");\n    }\n\n  if (safe_append (buf, remaining, request->authority, auth_len) < 0)\n    return -1;\n\n  return safe_append_crlf (buf, remaining);\n}\n```\n\n**Single call site** (line 319 in `add_request_extras`):\n```c\nif (add_optional_host_header (request, buf, remaining) < 0)\n  return -1;\n```\n\n## Recommendation\n\nInline this 27-line function into its only call site. Note that `add_request_extras` itself is also single-use (#1728), so inlining this function will likely happen as part of that larger inlining operation.\n\n## Pattern\n\n- **Type**: SINGLE_USE_INLINE\n- **Severity**: HIGH (moderate size, but called only once)\n- **Category**: Refactoring / Readability\n\n## Related\n\nThis function is called only from `add_request_extras` (#1728), which is also single-use. These should likely be inlined together.",
  "labels": [
    "enhancement",
    "wip:claude-1767051301-3810271"
  ],
  "state": "OPEN",
  "dependencies": []
}