{
  "number": 1746,
  "title": "refactor(http-server-static): flatten 4-level nesting in sendfile error handling",
  "body": "## Summary\n\nThe `server_serve_static_file` function contains 4-level nested error handling in the sendfile loop (lines 567-582). This deep nesting makes the error handling logic harder to review and maintain.\n\n## Location\n\n**File**: `src/http/SocketHTTPServer-static.c`  \n**Function**: `server_serve_static_file`  \n**Lines**: 567-582  \n**Pattern**: `DEEP_NESTING_4`  \n**Severity**: HIGH\n\n## Current Code\n\n```c\nwhile (remaining > 0)                                  // Level 1\n  {\n    sent = sendfile (Socket_fd (conn->socket), fd, &offset, remaining);\n    if (sent < 0)                                       // Level 2\n      {\n        if (errno == EAGAIN || errno == EWOULDBLOCK)    // Level 3\n          {\n            /* Would block - need to poll for write readiness */\n            /* For simplicity, we'll continue trying */\n            continue;\n          }\n        if (errno == EINTR)                             // Level 4\n          continue;\n        close (fd);\n        return -1;\n      }\n    if (sent == 0)\n      break;\n\n    remaining -= (size_t)sent;\n    SocketMetrics_counter_add (SOCKET_CTR_HTTP_SERVER_BYTES_SENT,\n                               (uint64_t)sent);\n  }\n```\n\n## Recommendation\n\nFlatten the error handling by using a helper function or early continue statements:\n\n```c\nwhile (remaining > 0)\n  {\n    sent = sendfile (Socket_fd (conn->socket), fd, &offset, remaining);\n    \n    /* Handle errors */\n    if (sent < 0)\n      {\n        if (errno == EAGAIN || errno == EWOULDBLOCK || errno == EINTR)\n          continue;\n        close (fd);\n        return -1;\n      }\n    \n    if (sent == 0)\n      break;\n\n    remaining -= (size_t)sent;\n    SocketMetrics_counter_add (SOCKET_CTR_HTTP_SERVER_BYTES_SENT,\n                               (uint64_t)sent);\n  }\n```\n\nThis consolidates the retryable errors into a single condition and reduces nesting from 4 to 2 levels.",
  "labels": [
    "enhancement"
  ],
  "state": "OPEN",
  "dependencies": []
}