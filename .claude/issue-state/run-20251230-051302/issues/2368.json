{
  "number": 2368,
  "title": "refactor: Clarify PROXY_ERROR usage for better code readability (SocketSimple-proxy.c:468)",
  "body": "## Refactoring: Improve Error Code Clarity\n\n**File:** `/home/tetsuo/git/tetsuo-socket/src/simple/SocketSimple-proxy.c`  \n**Line:** 468  \n**Severity:** LOW  \n**Category:** Refactoring  \n**Pattern ID:** MAGIC_VALUE_PROXY_ERROR\n\n### Issue Description\n\nThe constant `PROXY_ERROR` is used at line 468 without clear context. While it is properly defined in `include/socket/SocketProxy.h:297` as a valid enum value, the name is generic and could benefit from clarification.\n\n### Current Code\n\n```c\nTRY {\n  sock = SocketProxy_connect(&core_config, target_host, target_port);\n} EXCEPT(SocketProxy_Failed) {\n  set_proxy_error(PROXY_ERROR, \"Proxy connection failed\");  // Line 468\n  if (sock) Socket_free((Socket_T *)&sock);\n  return NULL;\n}\n```\n\n### Context from SocketProxy.h\n\n```c\ntypedef enum {\n  PROXY_OK = 0,\n  PROXY_ERROR,         /**< Generic proxy error (unspecified cause). */\n  PROXY_ERROR_CONNECT, /**< Failed to establish connection to proxy server. */\n  PROXY_ERROR_AUTH_REQUIRED,\n  // ... other specific error codes\n} SocketProxy_Result;\n```\n\n### Analysis\n\n1. **Current Usage**: `PROXY_ERROR` is correctly used as a generic fallback error\n2. **Issue**: The name doesn't convey \"generic/unspecified\" nature clearly\n3. **Minor Confusion**: Reader must check header to understand it's the generic catch-all\n\n### Recommended Options\n\n**Option 1: Rename in SocketProxy.h** (Breaking change)\n```c\ntypedef enum {\n  PROXY_OK = 0,\n  PROXY_ERROR_UNSPECIFIED,  // or PROXY_ERROR_UNKNOWN\n  PROXY_ERROR_CONNECT,\n  // ...\n} SocketProxy_Result;\n```\n\n**Option 2: Add Comment** (Non-breaking)\n```c\nEXCEPT(SocketProxy_Failed) {\n  // PROXY_ERROR = generic/unspecified error code\n  set_proxy_error(PROXY_ERROR, \"Proxy connection failed\");\n  if (sock) Socket_free((Socket_T *)&sock);\n  return NULL;\n}\n```\n\n**Option 3: Use More Specific Error** (If applicable)\n```c\nEXCEPT(SocketProxy_Failed) {\n  // If we know it's a connection issue:\n  set_proxy_error(PROXY_ERROR_CONNECT, \"Failed to connect to proxy\");\n  if (sock) Socket_free((Socket_T *)&sock);\n  return NULL;\n}\n```\n\n### Recommendation\n\nGiven that:\n- This exception handler catches `SocketProxy_Failed` (a generic exception)\n- We don't have specific error context at this point\n- The function `set_proxy_error()` already decodes specific error codes (lines 64-116)\n\n**Best approach**: Add a clarifying comment and potentially check if a more specific error is available:\n\n```c\nEXCEPT(SocketProxy_Failed) {\n  // Use generic error code since we don't have detailed result at this point\n  set_proxy_error(PROXY_ERROR, \"Proxy connection failed\");\n  if (sock) Socket_free((Socket_T *)&sock);\n  return NULL;\n}\n```\n\n### Related Observations\n\nThe `set_proxy_error()` function (lines 64-116) handles mapping from `SocketProxy_Result` to `SocketSimple_ErrorCode`, but in the exception handler we don't have access to the specific `SocketProxy_Result` value - only the exception itself.\n\nConsider enhancing exception detail passing:\n```c\n// In SocketProxy module, when raising:\nSOCKET_RAISE_WITH_RESULT(SocketProxy, SocketProxy_Failed, result);\n\n// Then here we could:\nEXCEPT(SocketProxy_Failed) {\n  SocketProxy_Result result = /* extract from exception */;\n  set_proxy_error(result, \"Proxy connection failed\");\n  // ...\n}\n```\n\nBut this would require changes to the exception framework itself.\n\n### Priority\n\nLow - code works correctly, this is purely a clarity/documentation issue.\n\n### References\n- include/socket/SocketProxy.h lines 296-316 (SocketProxy_Result enum)\n- CLAUDE.md: Magic Numbers anti-pattern (context: values should be named/documented)",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}