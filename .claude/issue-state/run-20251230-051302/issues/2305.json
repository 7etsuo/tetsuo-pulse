{
  "number": 2305,
  "title": "[REFACTOR] Long function should reuse helper instead of duplicating logic",
  "body": "## Summary\nFunction `Socket_simple_dns_request_result` is 80 lines long and duplicates the logic from `convert_addrinfo_to_result` helper function.\n\n## Location\n- File: `src/simple/SocketSimple-dns.c`\n- Lines: 743-822 (80 lines)\n\n## Issue\nThis function reimplements the entire addrinfo-to-DNSResult conversion instead of calling the existing helper at lines 80-126.\n\nLines 776-811 are nearly identical to lines 98-126 in `convert_addrinfo_to_result`.\n\n## Risk\n- **Severity**: LOW (code quality issue)\n- **Pattern**: LONG_FUNCTION_50\n- **Impact**: Code maintenance, harder to understand and modify\n\n## Current Structure\n```c\nint\nSocket_simple_dns_request_result(SocketSimple_DNSRequest_T req,\n                                 SocketSimple_DNSResult *result)\n{\n    Socket_simple_clear_error();\n\n    // Validation (15 lines)\n    if (!req || !result) { ... }\n    if (!req->complete) { ... }\n    if (req->error != 0) { ... }\n    if (!req->result) { ... }\n\n    // Conversion logic (35 lines) - DUPLICATE of convert_addrinfo_to_result\n    struct addrinfo *p;\n    int count = 0;\n    for (p = req->result; p != NULL; p = p->ai_next)\n        count++;\n    // ... etc (identical to helper)\n\n    return 0;\n}\n```\n\n## Recommendation\nRefactor to use the existing helper:\n\n```c\nint\nSocket_simple_dns_request_result(SocketSimple_DNSRequest_T req,\n                                 SocketSimple_DNSResult *result)\n{\n    Socket_simple_clear_error();\n\n    if (!req || !result) {\n        simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid argument\");\n        return -1;\n    }\n\n    memset(result, 0, sizeof(*result));\n\n    if (!req->complete) {\n        simple_set_error(SOCKET_SIMPLE_ERR_DNS, \"Request not complete\");\n        return -1;\n    }\n\n    if (req->error != 0) {\n        simple_set_error(SOCKET_SIMPLE_ERR_DNS, \"DNS resolution failed\");\n        return -1;\n    }\n\n    if (!req->result) {\n        simple_set_error(SOCKET_SIMPLE_ERR_DNS, \"No result available\");\n        return -1;\n    }\n\n    // Reuse existing helper instead of duplicating\n    return convert_addrinfo_to_result(req->result, result);\n}\n```\n\n## Benefits\n- Reduces function from 80 lines to ~25 lines\n- Eliminates code duplication\n- Single source of truth for conversion logic\n- Easier to maintain and test\n\n## Related Issues\n- #2274 - Same helper not used in `simple_dns_callback_wrapper`",
  "labels": [
    "enhancement",
    "wip:claude-1767093661-4175290"
  ],
  "state": "OPEN",
  "dependencies": []
}