{
  "number": 2338,
  "title": "refactor: Replace duplicated default port switch with named constants (SocketSimple-proxy.c:324)",
  "body": "## Refactoring: Eliminate Magic Numbers for Default Ports\n\n**File:** `/home/tetsuo/git/tetsuo-socket/src/simple/SocketSimple-proxy.c`  \n**Lines:** 324-340  \n**Severity:** MEDIUM  \n**Category:** Redundancy  \n**Pattern ID:** DUPLICATED_DEFAULT_PORT_SWITCH\n\n### Issue Description\n\nDefault port assignment uses a switch statement that duplicates the proxy type enum mapping. The magic numbers 8080 and 1080 appear without named constants, violating the CLAUDE.md anti-pattern guidance.\n\n### Current Code\n```c\n/* Use default port based on type */\nswitch (config->type) {\n  case SOCKET_SIMPLE_PROXY_HTTP:\n  case SOCKET_SIMPLE_PROXY_HTTPS:\n    config->port = 8080;  // Magic number!\n    break;\n  case SOCKET_SIMPLE_PROXY_SOCKS4:\n  case SOCKET_SIMPLE_PROXY_SOCKS4A:\n  case SOCKET_SIMPLE_PROXY_SOCKS5:\n  case SOCKET_SIMPLE_PROXY_SOCKS5H:\n    config->port = 1080;  // Magic number!\n    break;\n  default:\n    config->port = 8080;  // Magic number!\n    break;\n}\n```\n\n### Problems\n\n1. **Magic Numbers**: 8080 and 1080 are hardcoded without named constants\n2. **Duplication**: Proxy type cases are matched again (also in `simple_to_core_proxy_type` and `Socket_simple_proxy_type_name`)\n3. **Maintainability**: Adding new proxy types requires updating multiple switches\n\n### Recommended Fix\n\n**Option 1: Named Constants (Simple)**\n```c\n#define SOCKET_PROXY_DEFAULT_PORT_HTTP  8080\n#define SOCKET_PROXY_DEFAULT_PORT_SOCKS 1080\n\n/* Use default port based on type */\nswitch (config->type) {\n  case SOCKET_SIMPLE_PROXY_HTTP:\n  case SOCKET_SIMPLE_PROXY_HTTPS:\n    config->port = SOCKET_PROXY_DEFAULT_PORT_HTTP;\n    break;\n  case SOCKET_SIMPLE_PROXY_SOCKS4:\n  case SOCKET_SIMPLE_PROXY_SOCKS4A:\n  case SOCKET_SIMPLE_PROXY_SOCKS5:\n  case SOCKET_SIMPLE_PROXY_SOCKS5H:\n    config->port = SOCKET_PROXY_DEFAULT_PORT_SOCKS;\n    break;\n  default:\n    config->port = SOCKET_PROXY_DEFAULT_PORT_HTTP;\n    break;\n}\n```\n\n**Option 2: Helper Function (Better)**\n```c\nstatic int\nget_default_proxy_port(SocketSimple_ProxyType type)\n{\n  switch (type) {\n    case SOCKET_SIMPLE_PROXY_HTTP:\n    case SOCKET_SIMPLE_PROXY_HTTPS:\n      return SOCKET_PROXY_DEFAULT_PORT_HTTP;\n    case SOCKET_SIMPLE_PROXY_SOCKS4:\n    case SOCKET_SIMPLE_PROXY_SOCKS4A:\n    case SOCKET_SIMPLE_PROXY_SOCKS5:\n    case SOCKET_SIMPLE_PROXY_SOCKS5H:\n      return SOCKET_PROXY_DEFAULT_PORT_SOCKS;\n    default:\n      return SOCKET_PROXY_DEFAULT_PORT_HTTP;\n  }\n}\n\n// Usage:\nconfig->port = get_default_proxy_port(config->type);\n```\n\n**Option 3: Dispatch Table (Best - see CLAUDE.md)**\n```c\nstatic const struct {\n  SocketSimple_ProxyType type;\n  int default_port;\n  SocketProxyType core_type;\n  const char *name;\n} proxy_type_info[] = {\n  { SOCKET_SIMPLE_PROXY_HTTP,    8080, SOCKET_PROXY_HTTP,    \"HTTP\"    },\n  { SOCKET_SIMPLE_PROXY_HTTPS,   8080, SOCKET_PROXY_HTTPS,   \"HTTPS\"   },\n  { SOCKET_SIMPLE_PROXY_SOCKS4,  1080, SOCKET_PROXY_SOCKS4,  \"SOCKS4\"  },\n  { SOCKET_SIMPLE_PROXY_SOCKS4A, 1080, SOCKET_PROXY_SOCKS4A, \"SOCKS4a\" },\n  { SOCKET_SIMPLE_PROXY_SOCKS5,  1080, SOCKET_PROXY_SOCKS5,  \"SOCKS5\"  },\n  { SOCKET_SIMPLE_PROXY_SOCKS5H, 1080, SOCKET_PROXY_SOCKS5H, \"SOCKS5h\" },\n};\n```\n\nThis would consolidate all three enum-mapping functions into a single data structure.\n\n### Related Issues\n- See #2338 for enum conversion switch duplication\n\n### References\n- CLAUDE.md: Magic Numbers anti-pattern\n- CLAUDE.md: Dispatch Tables pattern",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}