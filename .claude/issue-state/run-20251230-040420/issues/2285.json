{
  "number": 2285,
  "title": "fix(quic): implicit uint64_t to size_t cast in memcpy may truncate on 32-bit systems (line 112)",
  "body": "## Summary\n**File:** `src/quic/SocketQUICHandshake.c`  \n**Line:** 112  \n**Severity:** HIGH  \n**Category:** Security - Implicit Type Conversion\n\n## Issue\nThe `memcpy` call implicitly casts `uint64_t length` to `size_t` without checking if it fits:\n\n```c\nmemcpy(stream->recv_buffer + stream->recv_offset, data, length);\n```\n\nWhere `length` is declared as `uint64_t` (function parameter at line 83-84).\n\n## Verification\n- `length` parameter is `uint64_t` \n- `memcpy` third parameter expects `size_t`\n- On 32-bit systems: `SIZE_MAX = 4294967295` (2^32-1)\n- On 32-bit systems: `UINT64_MAX = 18446744073709551615` (2^64-1)\n- Implicit cast will truncate high bits if `length > SIZE_MAX`\n\n## Impact\n**32-bit systems:**\n- If `length > SIZE_MAX`, the cast silently truncates\n- memcpy will copy fewer bytes than validated\n- Could lead to incomplete crypto data processing\n- May cause handshake failures or vulnerabilities\n\n**64-bit systems:**\n- No issue (size_t == uint64_t)\n\n## Affected Platforms\n- 32-bit ARM (embedded systems)\n- 32-bit x86 (legacy systems)\n- ILP32 ABIs (x32 ABI on x86-64)\n\n## Recommendation\nAdd size validation before memcpy:\n\n```c\nif (stream->recv_buffer) {\n    uint64_t total_offset;\n    if (stream->recv_offset > UINT64_MAX - length) {\n        return QUIC_HANDSHAKE_ERROR_BUFFER;  /* Overflow */\n    }\n    total_offset = stream->recv_offset + length;\n    if (total_offset > stream->recv_buffer_size) {\n        return QUIC_HANDSHAKE_ERROR_BUFFER;\n    }\n    /* Validate length fits in size_t for memcpy */\n    if (length > SIZE_MAX) {\n        return QUIC_HANDSHAKE_ERROR_BUFFER;\n    }\n    memcpy(stream->recv_buffer + stream->recv_offset, data, (size_t)length);\n}\n```\n\n## Pattern ID\n`IMPLICIT_UINT64_TO_SIZET_CAST`\n\n## Related\n- Issue #2276: Missing overflow check for the addition",
  "labels": [
    "bug",
    "quic"
  ],
  "state": "OPEN",
  "dependencies": []
}