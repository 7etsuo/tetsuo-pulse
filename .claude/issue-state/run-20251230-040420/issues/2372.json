{
  "number": 2372,
  "title": "security: Missing errno validation before ELOOP check in certificate pinning",
  "body": "## Summary\n**File**: `/home/tetsuo/git/tetsuo-socket/src/tls/SocketTLSContext-pinning.c`  \n**Line**: 298  \n**Category**: Security  \n**Severity**: HIGH  \n**Pattern**: MISSING_ERRNO_VALIDATION\n\n## Issue\nThe `open()` system call at line 298 is used without pre-clearing `errno` before checking for `ELOOP` (symlink attack detection). If a prior function call in the same function (such as `tls_validate_file_path()` at line 290) sets `errno` to `ELOOP` for any reason, and then `open()` fails for a *different* reason, the subsequent check at line 301 could incorrectly identify the error as a symlink attack when it was actually something else.\n\n## Code\n```c\n/* Line 298 */\nint fd = open (cert_file, O_RDONLY | O_NOFOLLOW);\nif (fd == -1)\n  {\n    if (errno == ELOOP)  /* Line 301 - could be stale errno */\n      {\n        RAISE_CTX_ERROR_MSG (SocketTLS_Failed,\n            \"Symlinks not allowed for certificate files: %s\", cert_file);\n      }\n    RAISE_CTX_ERROR_FMT (SocketTLS_Failed,\n                         \"Cannot open certificate file '%.200s': %s\",\n                         cert_file, Socket_safe_strerror (errno));\n  }\n```\n\n## Security Impact\n- The `ELOOP` check is security-critical for detecting symlink attacks via `O_NOFOLLOW`\n- Stale `errno` values could cause false positives or mask the real error\n- Incorrect error reporting could aid attackers in bypassing security checks\n\n## Recommendation\nAdd `errno = 0;` before the `open()` call to ensure clean errno state:\n\n```c\nerrno = 0;  /* Ensure clean state for security check */\nint fd = open (cert_file, O_RDONLY | O_NOFOLLOW);\n```\n\nThis is a standard defensive practice when errno values are used for security-sensitive decisions.\n\n## Verification\nThis finding was verified by an automated agent that confirmed:\n1. The code pattern exists at the specified line\n2. No errno zeroing occurs between prior function calls and the open()\n3. The recommendation is applicable and follows security best practices",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}