{
  "number": 2328,
  "title": "refactor(simple-security): extract common wrapper pattern from _new functions",
  "body": "## Summary\n\n`Socket_simple_syn_new` and `Socket_simple_ip_tracker_new` follow identical patterns for wrapping core objects in Simple API handles. This duplication makes maintenance harder and increases the risk of inconsistent error handling.\n\n## Location\n\n- File: `/home/tetsuo/git/tetsuo-socket/src/simple/SocketSimple-security.c`\n- Lines: 66-116 and 414-446\n\n## Current Pattern\n\nBoth functions follow this identical 9-step pattern:\n\n1. Declare `volatile` core type pointer\n2. Declare handle pointer  \n3. Call `Socket_simple_clear_error()`\n4. TRY/EXCEPT block to create core object\n5. Check if core object is NULL (potentially redundant)\n6. `calloc` handle\n7. Check calloc result and free core object on failure\n8. Assign core object to handle\n9. Return handle\n\n## Duplication Example\n\n```c\n// Socket_simple_syn_new (lines 66-116)\nvolatile SocketSYNProtect_T protect = NULL;\nstruct SocketSimple_SYNProtect *handle = NULL;\nSocket_simple_clear_error ();\nTRY { protect = SocketSYNProtect_new (NULL, &core_config); }\nEXCEPT (SocketSYNProtect_Failed) { /* error */ }\nEND_TRY;\nif (!protect) { /* error */ }\nhandle = calloc (1, sizeof (*handle));\n// ... same pattern ...\n\n// Socket_simple_ip_tracker_new (lines 414-446)\nvolatile SocketIPTracker_T tracker = NULL;\nstruct SocketSimple_IPTracker *handle = NULL;\nSocket_simple_clear_error ();\nTRY { tracker = SocketIPTracker_new (NULL, max_per_ip); }\nEXCEPT (SocketIPTracker_Failed) { /* error */ }\nEND_TRY;\nif (!tracker) { /* error */ }\nhandle = calloc (1, sizeof (*handle));\n// ... same pattern ...\n```\n\n## Recommendation\n\nExtract the pattern into a macro or refactor to reduce duplication:\n\n**Option 1: Macro approach (if types are similar)**\n```c\n#define SIMPLE_WRAP_NEW(CORE_TYPE, SIMPLE_TYPE, CORE_CREATE_CALL, CORE_EXCEPTION) \\\n  volatile CORE_TYPE core_obj = NULL; \\\n  struct SIMPLE_TYPE *handle = NULL; \\\n  Socket_simple_clear_error(); \\\n  TRY { core_obj = CORE_CREATE_CALL; } \\\n  EXCEPT(CORE_EXCEPTION) { \\\n    simple_set_error(SOCKET_SIMPLE_ERR_SECURITY, \"Failed to create \" #CORE_TYPE); \\\n    return NULL; \\\n  } \\\n  END_TRY; \\\n  /* ... rest of pattern ... */\n```\n\n**Option 2: Inline functions with callbacks**\n\nIf macros are too complex, consider inline helper functions for the common parts.\n\n## Impact\n\n- Reduces ~80 lines of duplicated boilerplate\n- Makes error handling consistent\n- Easier to add new wrapped types\n- Single place to fix bugs in the pattern\n\n## Pattern ID\n\n`DUPLICATED_PATTERN_NEW_FUNCTIONS`\n\n## Severity\n\nMEDIUM - Code maintainability issue\n\n## Category\n\nrefactor",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}