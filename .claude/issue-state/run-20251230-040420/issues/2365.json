{
  "number": 2365,
  "title": "refactor(tls): deduplicate OCSP parsing in get_ocsp_next_update",
  "body": "## Summary\n\nThe `SocketTLS_get_ocsp_next_update()` function is 68 lines long and duplicates OCSP response parsing code that already exists in `ocsp_parse_response()` helper.\n\n## Location\n\n**File**: `src/tls/SocketTLS.c`\n**Lines**: 2180-2248\n**Function**: `SocketTLS_get_ocsp_next_update()`\n\n## Issue\n\nThe function manually parses OCSP response:\n- Gets raw OCSP response from SSL\n- Calls `d2i_OCSP_RESPONSE()`\n- Checks `OCSP_response_status()`\n- Extracts basic response with `OCSP_response_get1_basic()`\n\nThis duplicates the logic in `ocsp_parse_response()` at line 2008.\n\n## Recommendation\n\nReuse the existing helper:\n\n```c\nint SocketTLS_get_ocsp_next_update(Socket_T socket, time_t *next_update) {\n    assert(socket);\n    assert(next_update);\n    \n    *next_update = (time_t)-1;\n    \n    SSL *ssl = tls_socket_get_ssl(socket);\n    if (!ssl) return -1;\n    \n#if !defined(OPENSSL_NO_OCSP)\n    // Reuse existing parser\n    OCSP_BASICRESP *basic = ocsp_parse_response(ssl);\n    if (!basic) return -1;\n    \n    int result = -1;\n    int resp_count = OCSP_resp_count(basic);\n    \n    for (int i = 0; i < resp_count; i++) {\n        OCSP_SINGLERESP *single = OCSP_resp_get0(basic, i);\n        if (!single) continue;\n        \n        ASN1_GENERALIZEDTIME *nextupd = NULL;\n        (void)OCSP_single_get0_status(single, NULL, NULL, NULL, &nextupd);\n        \n        if (nextupd) {\n            struct tm tm_time = {0};\n            if (ASN1_TIME_to_tm(nextupd, &tm_time) == 1) {\n                *next_update = timegm(&tm_time);\n                result = 1;\n                break;\n            }\n        }\n    }\n    \n    OCSP_BASICRESP_free(basic);\n    return result;\n#else\n    (void)socket;\n    return -1;\n#endif\n}\n```\n\nThis eliminates ~20 lines of duplicated parsing code.\n\n## Impact\n\n- **Severity**: MEDIUM\n- **Category**: Refactoring\n- **Pattern**: LONG_FUNCTION_68, DUPLICATE_OCSP_PARSING\n\n## Labels\n\n- `refactoring`\n- `code-quality`\n- `duplication`\n- `low-priority`",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}