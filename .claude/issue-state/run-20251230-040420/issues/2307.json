{
  "number": 2307,
  "title": "[QUIC Transport Params] Deduplicate server-only role check pattern",
  "body": "## Summary\n\nThe pattern for checking server-only parameters is duplicated across 5 decoder functions. A macro would reduce duplication and improve maintainability.\n\n## Location\n\n**File:** `src/quic/SocketQUICTransportParams.c`\n**Functions:** Multiple parameter decoders  \n**Lines:** 713, 743, 769, 889, 927\n\n## Issue Details\n\n**Severity:** MEDIUM  \n**Category:** Redundancy  \n**Pattern:** DUPLICATE_ROLE_CHECK\n\n### Current Code\n\nThe following pattern appears in 5 functions:\n\n```c\nSocketQUICTransportParams_Result result = check_server_only (peer_role);\nif (result != QUIC_TP_OK)\n  return result;\n```\n\n**Occurrences:**\n1. `decode_param_original_dcid()` - line 743\n2. `decode_param_stateless_reset_token()` - line 769  \n3. `decode_param_preferred_address()` - line 889\n4. `decode_param_retry_scid()` - line 927\n5. Helper function `check_server_only()` defined at line 713\n\n### Recommendation\n\n**Option 1: Macro**\n```c\n/**\n * @brief Check if parameter is server-only and return error if violated.\n *\n * Expands to inline role check with early return on error.\n * Use at start of decoder functions for server-only parameters.\n */\n#define CHECK_SERVER_ONLY(peer_role) \\\n  do { \\\n    if ((peer_role) != QUIC_ROLE_SERVER) \\\n      return QUIC_TP_ERROR_ROLE; \\\n  } while(0)\n```\n\n**Option 2: Keep function but simplify calls**\n```c\n#define RETURN_IF_NOT_SERVER(peer_role) \\\n  do { \\\n    SocketQUICTransportParams_Result __res = check_server_only(peer_role); \\\n    if (__res != QUIC_TP_OK) return __res; \\\n  } while(0)\n```\n\n### Usage After Fix\n\n```c\nstatic SocketQUICTransportParams_Result\ndecode_param_original_dcid (const uint8_t *data, size_t param_len,\n                            SocketQUICRole peer_role,\n                            SocketQUICTransportParams_T *params)\n{\n  CHECK_SERVER_ONLY(peer_role);\n  \n  SocketQUICTransportParams_Result result = \n      decode_connid_value (data, param_len, &params->original_dcid);\n  if (result != QUIC_TP_OK)\n    return result;\n\n  params->has_original_dcid = 1;\n  return QUIC_TP_OK;\n}\n```\n\n### Benefits\n\n- Reduces 3 lines to 1 in each function\n- Makes intent clearer: \"this is server-only\"\n- Easier to maintain if role checking logic changes\n- Consistent with project's use of `do { } while(0)` for macros\n\n## References\n\n- RFC 9000 Section 18.2: Server-only transport parameters\n- Related parameters: `original_dcid`, `stateless_reset_token`, `retry_scid`, `preferred_address`\n\n## Labels\n\n`refactoring`, `redundancy`, `quic`, `medium-priority`, `good-first-issue`",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}