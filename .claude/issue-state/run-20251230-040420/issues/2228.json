{
  "number": 2228,
  "title": "refactor: merge compute_response_with_qop and compute_response_no_qop",
  "body": "## Summary\n\nIn `SocketHTTPClient-auth.c`, `compute_response_with_qop()` (lines 224-242) and `compute_response_no_qop()` (lines 245-259) have nearly identical structure, differing only in their format strings and parameter usage.\n\n## Location\n\n**File:** `/home/tetsuo/git/tetsuo-socket/src/http/SocketHTTPClient-auth.c`  \n**Lines:** 224-272  \n**Functions:** `compute_response_with_qop`, `compute_response_no_qop`, `compute_response_hash`\n\n## Current Code Pattern\n\nBoth functions:\n1. Declare a buffer and length variable\n2. Call `snprintf()` with different numbers of parameters\n3. Check for truncation\n4. Call `digest_hash()`\n5. Return result\n\nThe with_qop variant uses 6 fields: `ha1:nonce:nc:cnonce:qop:ha2`  \nThe no_qop variant uses 3 fields: `ha1:nonce:ha2`\n\n## Issue\n\nCode duplication makes maintenance harder. The logic is already unified in `compute_response_hash()` which dispatches between them, but the functions themselves are redundant.\n\n## Recommendation\n\nMerge into a single function with conditional formatting:\n\n```c\nstatic int\ncompute_response_hash_internal(const char *ha1_hex, const char *nonce,\n                               const char *nc, const char *cnonce,\n                               const char *qop, const char *ha2_hex,\n                               int use_sha256, char *response_hex)\n{\n  char buf[HTTPCLIENT_DIGEST_A_BUFFER_SIZE];\n  int len;\n\n  if (qop != NULL && strcmp(qop, HTTPCLIENT_DIGEST_TOKEN_AUTH) == 0) {\n    if (nc == NULL || cnonce == NULL) return -1;\n    len = snprintf(buf, sizeof(buf), \"%s:%s:%s:%s:%s:%s\",\n                   ha1_hex, nonce, nc, cnonce, qop, ha2_hex);\n  } else {\n    len = snprintf(buf, sizeof(buf), \"%s:%s:%s\", ha1_hex, nonce, ha2_hex);\n  }\n\n  if (len < 0 || (size_t)len >= sizeof(buf))\n    return -1;\n\n  digest_hash(buf, (size_t)len, use_sha256, response_hex);\n  return 0;\n}\n```\n\n## Severity\n\n**MEDIUM** - Code duplication and maintenance burden\n\n## Pattern ID\n\n`DUPLICATE_RESPONSE_COMPUTE`",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}