{
  "number": 2254,
  "title": "refactor(simple-async): extract repeated async context validation",
  "body": "## Summary\n\nThe async context validation pattern \\`if (!async || !async->async)\\` with identical error handling is duplicated across 10+ functions in \\`src/simple/SocketSimple-async.c\\`.\n\n## Details\n\n**File:** \\`src/simple/SocketSimple-async.c\\`\n**Lines:** 199, 316, 335, 349, 375, 390, 405, 422, 442, 459\n**Severity:** HIGH (redundancy)\n**Pattern:** REPEATED_VALIDATION\n\n## Current Code (Duplicated 10+ times)\n\n\\`\\`\\`c\nif (!async || !async->async)\n  {\n    simple_set_error (SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid async context\");\n    return -1;  // or 0, or NULL depending on function\n  }\n\\`\\`\\`\n\n## Affected Functions\n\n- \\`Socket_simple_async_process\\` (line 316)\n- \\`Socket_simple_async_cancel\\` (line 335)\n- \\`Socket_simple_async_cancel_all\\` (line 349)\n- \\`Socket_simple_async_get_progress\\` (line 375)\n- \\`Socket_simple_async_send_continue\\` (line 390)\n- \\`Socket_simple_async_recv_continue\\` (line 405)\n- \\`Socket_simple_async_set_timeout\\` (line 422)\n- \\`Socket_simple_async_expire_stale\\` (line 442)\n- \\`Socket_simple_async_is_available\\` (line 459)\n- \\`Socket_simple_async_backend_name\\` (line 468)\n- \\`async_operation_common\\` (line 199)\n\n## Recommendation\n\nExtract to macro or inline helper:\n\n**Option 1: Macro (preferred for this codebase)**\n\\`\\`\\`c\n#define VALIDATE_ASYNC_CONTEXT(async, ret_val) \\\n  do { \\\n    if (!(async) || !(async)->async) { \\\n      simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \\\n                       \"Invalid async context\"); \\\n      return (ret_val); \\\n    } \\\n  } while(0)\n\n// Usage:\nint Socket_simple_async_process(SocketSimple_Async_T async, int timeout_ms)\n{\n  Socket_simple_clear_error();\n  VALIDATE_ASYNC_CONTEXT(async, -1);\n  return SocketAsync_process_completions(async->async, timeout_ms);\n}\n\\`\\`\\`\n\n**Option 2: Inline function (type-safe)**\n\\`\\`\\`c\nstatic inline int\nvalidate_async_context_internal(SocketSimple_Async_T async)\n{\n  if (!async || !async->async) {\n    simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid async context\");\n    return 0;\n  }\n  return 1;\n}\n\n#define VALIDATE_ASYNC_CONTEXT(async, ret_val) \\\n  if (!validate_async_context_internal(async)) return (ret_val)\n\\`\\`\\`\n\n## Benefits\n\n- Reduces code duplication by ~33 lines\n- Single point of maintenance for validation logic\n- Consistent error messaging\n- Easier to add additional checks (e.g., state validation)\n\n## References\n\nPer CLAUDE.md anti-patterns section on redundancy.",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}