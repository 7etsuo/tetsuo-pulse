{
  "number": 2294,
  "title": "refactor(simple-timer): extract repeated validation pattern into helper function",
  "body": "## Summary\n\nFour timer control functions share nearly identical validation code, leading to ~80 lines of duplicated logic. This violates DRY principles and makes maintenance harder.\n\n## Location\n\n**File**: src/simple/SocketSimple-timer.c\n**Lines**: 172-315\n**Functions affected**:\n- Socket_simple_timer_cancel (lines 172-206)\n- Socket_simple_timer_reschedule (lines 209-244)\n- Socket_simple_timer_pause (lines 247-279)\n- Socket_simple_timer_resume (lines 282-315)\n\n## Issue Details\n\nEach function repeats the same validation sequence:\n1. Clear error state\n2. Check poll and timer pointers\n3. Check timer->is_valid flag\n4. Get core_poll via simple_poll_get_core()\n5. Check core_poll validity\n\nThis pattern appears 4 times with only minor message variations.\n\n## Code Example\n\nCurrent pattern (repeated 4x):\n```c\nSocket_simple_clear_error ();\n\nif (!poll || !timer)\n  {\n    simple_set_error (SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid argument\");\n    return -1;\n  }\n\nif (!timer->is_valid)\n  {\n    simple_set_error (SOCKET_SIMPLE_ERR_INVALID_ARG, \"Timer cancelled or fired\");\n    return -1;\n  }\n\nSocketPoll_T core_poll = simple_poll_get_core (poll);\nif (!core_poll)\n  {\n    simple_set_error (SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid poll handle\");\n    return -1;\n  }\n```\n\n## Recommendation\n\nExtract into a helper function:\n\n```c\nstatic SocketPoll_T\nvalidate_timer_operation(SocketSimple_Poll_T poll, SocketSimple_Timer_T timer)\n{\n  Socket_simple_clear_error();\n  \n  if (!poll || !timer)\n    {\n      simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid argument\");\n      return NULL;\n    }\n  \n  if (!timer->is_valid)\n    {\n      simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \"Timer cancelled or fired\");\n      return NULL;\n    }\n  \n  SocketPoll_T core_poll = simple_poll_get_core(poll);\n  if (!core_poll)\n    {\n      simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, \"Invalid poll handle\");\n      return NULL;\n    }\n  \n  return core_poll;\n}\n```\n\nThen each function becomes:\n```c\nint\nSocket_simple_timer_cancel(SocketSimple_Poll_T poll, SocketSimple_Timer_T timer)\n{\n  SocketPoll_T core_poll = validate_timer_operation(poll, timer);\n  if (!core_poll)\n    return -1;\n  \n  int result = SocketTimer_cancel(core_poll, timer->core_timer);\n  if (result < 0)\n    {\n      simple_set_error(SOCKET_SIMPLE_ERR_POLL, \"Failed to cancel timer\");\n      return -1;\n    }\n  \n  timer->is_valid = 0;\n  return 0;\n}\n```\n\n## Impact\n\n- **Severity**: HIGH (refactoring)\n- **Category**: Redundancy\n- **Pattern ID**: REPEATED_VALIDATION_PATTERN\n- Reduces code by ~60 lines\n- Improves maintainability\n- Makes validation logic consistent and centralized\n- Easier to add new timer operations\n\n## Test Plan\n\n- [ ] Run existing timer tests to ensure behavior unchanged\n- [ ] Verify all four functions still work correctly\n- [ ] Check error messages are still appropriate\n\n---\n**Pattern**: REPEATED_VALIDATION_PATTERN\n**Verified by**: per-file-pipeline-agent\n**Date**: 2025-12-30",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}