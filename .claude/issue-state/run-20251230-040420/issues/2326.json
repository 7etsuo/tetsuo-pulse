{
  "number": 2326,
  "title": "refactor(reconnect): reduce nesting in check_connect_completion error handling",
  "body": "## Summary\nThe `check_connect_completion` function has deep nesting in the error handling path, making the code harder to read and reason about.\n\n## Location\n- **File**: `src/socket/SocketReconnect.c`\n- **Function**: `check_connect_completion`\n- **Lines**: 454-469\n\n## Issue Details\nCurrent code has nested if statements:\n\n```c\nif (pfd.revents & (POLLERR | POLLHUP | POLLNVAL))\n  {\n    error = 0;\n    len = sizeof (error);\n    int connect_err;\n    if (getsockopt (fd, SOL_SOCKET, SO_ERROR, &error, &len) < 0)\n      {\n        connect_err = errno;\n      }\n    else\n      {\n        connect_err = error ? error : ECONNREFUSED;\n      }\n    reconnect_set_socket_error (conn, \"Connect poll error\", connect_err);\n    return -1;\n  }\n```\n\nThis creates unnecessary nesting and makes the logic harder to follow.\n\n## Recommendation\nUse early return pattern to flatten the logic:\n\n```c\nif (pfd.revents & (POLLERR | POLLHUP | POLLNVAL))\n  {\n    int error = 0;\n    socklen_t len = sizeof(error);\n    int connect_err = ECONNREFUSED;  /* default */\n    \n    if (getsockopt(fd, SOL_SOCKET, SO_ERROR, &error, &len) == 0 && error != 0)\n      connect_err = error;\n    else if (getsockopt(fd, SOL_SOCKET, SO_ERROR, &error, &len) < 0)\n      connect_err = errno;\n    \n    reconnect_set_socket_error(conn, \"Connect poll error\", connect_err);\n    return -1;\n  }\n```\n\nOr even simpler:\n\n```c\nif (!(pfd.revents & (POLLERR | POLLHUP | POLLNVAL)))\n  goto check_so_error;  /* Continue normal path */\n\n/* Handle error case */\nint error = 0;\nsocklen_t len = sizeof(error);\nint connect_err = (getsockopt(fd, SOL_SOCKET, SO_ERROR, &error, &len) < 0) \n                  ? errno \n                  : (error ? error : ECONNREFUSED);\n\nreconnect_set_socket_error(conn, \"Connect poll error\", connect_err);\nreturn -1;\n\ncheck_so_error:\n/* Normal SO_ERROR check continues... */\n```\n\n## Benefits\n- Reduces nesting depth from 3 to 2 levels\n- Improves readability following project's early-return pattern\n- Aligns with CLAUDE.md anti-pattern guidelines for \"Deep Nesting\"\n- Makes error handling flow more obvious\n\n## Pattern\n`DEEP_NESTING`\n\n## Severity\nLOW\n\n## Category\nrefactor\n\n## References\nSee CLAUDE.md section \"Deep Nesting (Arrow Code)\" for project standards on this anti-pattern.",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}