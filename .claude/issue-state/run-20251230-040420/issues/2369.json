{
  "number": 2369,
  "title": "refactor(http2): replace magic number 4 with PRIORITY_UPDATE_MIN_PAYLOAD_SIZE constant",
  "body": "## Summary\n\nMagic number `4` is used directly for stream ID size in PRIORITY_UPDATE frame handling instead of the existing `PRIORITY_UPDATE_MIN_PAYLOAD_SIZE` constant.\n\n## Location\n\n**File:** `src/http/SocketHTTP2-priority.c`\n**Lines:** 382, 391, 464, 465\n\n## Current Code\n\n```c\n// Line 382 - calculating payload length\npayload_len = 4 + (size_t)priority_len;\n\n// Line 391 - copying priority field after stream ID\nmemcpy (payload + 4, priority_field, (size_t)priority_len);\n\n// Line 464 - parsing priority value after stream ID\nconst char *priority_value = (const char *)(payload + 4);\n\n// Line 465 - calculating priority field length\nsize_t priority_len = header->length - 4;\n```\n\n## Context\n\nThe constant `PRIORITY_UPDATE_MIN_PAYLOAD_SIZE` is already defined on line 30:\n\n```c\n/* PRIORITY_UPDATE frame minimum payload size: 4 bytes for stream ID */\n#define PRIORITY_UPDATE_MIN_PAYLOAD_SIZE 4\n```\n\nThe constant is correctly used on line 429 for validation, but the same value appears as magic number `4` in four other locations.\n\n## Suggested Fix\n\nReplace all instances of magic number `4` with the existing constant:\n\n```c\n// Line 382\npayload_len = PRIORITY_UPDATE_MIN_PAYLOAD_SIZE + (size_t)priority_len;\n\n// Line 391\nmemcpy (payload + PRIORITY_UPDATE_MIN_PAYLOAD_SIZE, priority_field, (size_t)priority_len);\n\n// Line 464\nconst char *priority_value = (const char *)(payload + PRIORITY_UPDATE_MIN_PAYLOAD_SIZE);\n\n// Line 465\nsize_t priority_len = header->length - PRIORITY_UPDATE_MIN_PAYLOAD_SIZE;\n```\n\n## Category\n\n- **Type:** Redundancy / Code Quality\n- **Severity:** Medium\n- **Pattern:** MAGIC_NUMBER_4",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}