{
  "number": 1678,
  "title": "refactor(http-server): flatten 5-level nesting in TLS ALPN handling",
  "body": "## Description\n\nDeep nesting (depth 5) in `server_process_tls_handshake()` at lines 460-472 in `src/http/SocketHTTPServer.c`.\n\n## Location\n\n- **File**: `src/http/SocketHTTPServer.c`\n- **Lines**: 460-472\n- **Function**: `server_process_tls_handshake`\n\n## Current Code\n\n```c\nif (alpn != NULL && strcmp (alpn, \"h2\") == 0\n    && server->config.max_version >= HTTP_VERSION_2)\n  {\n    conn->is_http2 = 1;\n    conn->state = CONN_STATE_HTTP2;\n    if (server_http2_enable (server, conn) < 0)\n      {\n        conn->state = CONN_STATE_CLOSED;\n        return -1;\n      }\n    SocketPoll_mod (server->poll, conn->socket, POLL_READ | POLL_WRITE, conn);\n  }\n```\n\n## Recommendation\n\nUse early return for error case:\n```c\nif (server_http2_enable (server, conn) < 0)\n  {\n    conn->state = CONN_STATE_CLOSED;\n    return -1;\n  }\nconn->is_http2 = 1;\n// ...\n```\n\n## Severity\n\nMEDIUM (depth 5)",
  "labels": [
    "enhancement"
  ],
  "state": "OPEN",
  "dependencies": []
}