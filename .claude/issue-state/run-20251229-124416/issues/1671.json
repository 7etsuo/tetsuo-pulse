{
  "number": 1671,
  "title": "refactor(http-server): flatten 9-level nesting in h2c upgrade header filter",
  "body": "## Description\n\nDeep nesting (depth 9) in `server_try_h2c_upgrade()` at lines 815-831 in `src/http/SocketHTTPServer.c`.\n\n## Location\n\n- **File**: `src/http/SocketHTTPServer.c`\n- **Lines**: 815-831\n- **Function**: `server_try_h2c_upgrade`\n\n## Current Code\n\n```c\nfor (size_t i = 0; i < SocketHTTP_Headers_count (headers); i++)\n  {\n    const SocketHTTP_Header *hdr = SocketHTTP_Headers_at (headers, i);\n    if (hdr == NULL || hdr->name == NULL || hdr->value == NULL)\n      continue;\n    if (strcasecmp (hdr->name, \"Connection\") == 0\n        || strcasecmp (hdr->name, \"Upgrade\") == 0\n        || strcasecmp (hdr->name, \"HTTP2-Settings\") == 0\n        || strcasecmp (hdr->name, \"Keep-Alive\") == 0\n        || strcasecmp (hdr->name, \"Proxy-Connection\") == 0\n        || strcasecmp (hdr->name, \"Host\") == 0)\n      continue;\n    if (strcasecmp (hdr->name, \"TE\") == 0\n        && strcasecmp (hdr->value, \"trailers\") != 0)\n      continue;\n    SocketHTTP_Headers_add (h2h, hdr->name, hdr->value);\n  }\n```\n\n## Recommendation\n\nExtract header filtering into a separate helper function like `should_copy_header_to_h2()` to reduce nesting depth.\n\n## Severity\n\nCRITICAL (depth 9)",
  "labels": [
    "enhancement"
  ],
  "state": "OPEN",
  "dependencies": []
}