{
  "number": 1862,
  "title": "Missing return value check for getsockopt() in SocketDNSoverTLS.c",
  "body": "## Summary\n\nMissing return value check for `getsockopt()` at line 406 in `/home/tetsuo/git/tetsuo-socket/src/dns/SocketDNSoverTLS.c` could result in reading uninitialized `error` variable if the syscall fails.\n\n## Location\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/dns/SocketDNSoverTLS.c`\n**Line**: 406\n**Function**: `start_connection()`\n\n## Issue Details\n\n**Category**: Security\n**Severity**: MEDIUM\n**Pattern**: MISSING_RETURN_CHECK\n\n## Current Code\n\n```c\n/* Check socket error */\nint error = 0;\nsocklen_t errlen = sizeof (error);\ngetsockopt (fd, SOL_SOCKET, SO_ERROR, &error, &errlen);  // <- No check\nif (error != 0)\n  {\n    close_connection (transport, conn);\n    transport->stats.handshake_failures++;\n    return -1;\n  }\n```\n\n## Problem\n\nIf `getsockopt()` fails (returns -1), the `error` variable may not be updated, leading to undefined behavior. While initialized to 0, the subsequent check assumes the syscall succeeded.\n\n## Recommendation\n\nCheck the return value before using `error`:\n\n```c\nint error = 0;\nsocklen_t errlen = sizeof (error);\nif (getsockopt (fd, SOL_SOCKET, SO_ERROR, &error, &errlen) < 0)\n  {\n    /* getsockopt failed - treat as connection failure */\n    close_connection (transport, conn);\n    transport->stats.handshake_failures++;\n    return -1;\n  }\nif (error != 0)\n  {\n    close_connection (transport, conn);\n    transport->stats.handshake_failures++;\n    return -1;\n  }\n```\n\n## Impact\n\n- **CWE-252**: Unchecked Return Value\n- Connection state may be incorrectly determined\n- May proceed with invalid connection\n\n## Test Plan\n\n- [ ] Add unit test for getsockopt failure scenario\n- [ ] Verify error handling path is triggered\n- [ ] Ensure stats are updated correctly",
  "labels": [
    "bug",
    "wip:claude-1767075856-973262"
  ],
  "state": "OPEN",
  "dependencies": []
}