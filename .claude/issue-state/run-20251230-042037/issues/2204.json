{
  "number": 2204,
  "title": "security(core): assert(event) compiled out in release builds - SocketEvent.c:62",
  "body": "## Summary\n\nIn `src/core/SocketEvent.c` at line 62, the function `socketevent_dispatch()` uses `assert(event)` to check for NULL pointer. This assert is compiled out when building with `-DNDEBUG` (standard for release/production builds), leaving no NULL pointer protection.\n\n## Location\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/core/SocketEvent.c`  \n**Line**: 62  \n**Function**: `socketevent_dispatch()`\n\n## Vulnerable Code\n\n```c\nstatic void\nsocketevent_dispatch (const SocketEventRecord *event)\n{\n  SocketEventHandler local_handlers[SOCKET_EVENT_MAX_HANDLERS];\n  size_t count;\n\n  assert (event);  /* \u2190 Compiled out in release builds! */\n\n  SOCKET_MUTEX_LOCK_OR_RAISE (&socketevent_mutex, SocketEvent,\n                              SocketEvent_Failed);\n  count = socketevent_copy_handlers_unlocked (local_handlers);\n  SOCKET_MUTEX_UNLOCK (&socketevent_mutex);\n\n  socketevent_invoke_handlers (local_handlers, count, event);\n}\n```\n\n## Security Impact\n\n**Severity**: HIGH\n\nIf `event` is NULL and the code is compiled with optimizations (`-DNDEBUG`):\n1. The assert is removed by the preprocessor\n2. Execution continues to line 64 where `SOCKET_MUTEX_LOCK_OR_RAISE` may access memory\n3. Line 69 will dereference NULL pointer when passing to `socketevent_invoke_handlers`\n4. Leads to undefined behavior / segmentation fault\n\nWhile the current callers (lines 200, 211, 224, 237) pass stack-allocated events, defensive programming requires explicit NULL checks in public/internal APIs that could be called incorrectly.\n\n## Recommendation\n\nReplace assert with explicit NULL check:\n\n```c\nstatic void\nsocketevent_dispatch (const SocketEventRecord *event)\n{\n  SocketEventHandler local_handlers[SOCKET_EVENT_MAX_HANDLERS];\n  size_t count;\n\n  if (event == NULL) {\n    SocketLog_emit(SOCKET_LOG_ERROR, \"SocketEvents\",\n                   \"NULL event passed to socketevent_dispatch\");\n    return;\n  }\n\n  SOCKET_MUTEX_LOCK_OR_RAISE (&socketevent_mutex, SocketEvent,\n                              SocketEvent_Failed);\n  count = socketevent_copy_handlers_unlocked (local_handlers);\n  SOCKET_MUTEX_UNLOCK (&socketevent_mutex);\n\n  socketevent_invoke_handlers (local_handlers, count, event);\n}\n```\n\n## Pattern\n\n**Pattern ID**: `ASSERT_IN_RELEASE`  \n**Category**: Security  \n**CWE**: CWE-476 (NULL Pointer Dereference)\n\n## References\n\n- C11 Standard \u00a77.2.1.1: \"If NDEBUG is defined, assert does nothing\"\n- CERT C Coding Standard: MSC11-C \"Incorporate diagnostic tests using assertions\"\n- Project guidelines: Use explicit checks for release-critical validations",
  "labels": [
    "wip:claude-1767092676-3930812"
  ],
  "state": "OPEN",
  "dependencies": []
}