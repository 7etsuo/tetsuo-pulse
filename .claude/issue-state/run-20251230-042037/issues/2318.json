{
  "number": 2318,
  "title": "[QUIC Transport Params] Eliminate duplicate varint decode pattern",
  "body": "## Summary\n\nThe varint decode pattern is duplicated in `decode_single_param()` when parsing parameter ID and length. A macro would eliminate this duplication.\n\n## Location\n\n**File:** `src/quic/SocketQUICTransportParams.c`\n**Function:** `decode_single_param`\n**Lines:** 1026-1037\n\n## Issue Details\n\n**Severity:** LOW  \n**Category:** Redundancy  \n**Pattern:** DUPLICATE_DECODE_PATTERN\n\n### Current Code\n\nLines 1026-1030 (decode parameter ID):\n```c\n/* Decode parameter ID */\nresult = decode_varint_value (data + *pos, len - *pos, &param_id,\n                              &bytes_consumed);\nif (result != QUIC_TP_OK)\n  return result;\n*pos += bytes_consumed;\n```\n\nLines 1033-1037 (decode parameter length):\n```c\n/* Decode parameter length */\nresult = decode_varint_value (data + *pos, len - *pos, &param_len,\n                              &bytes_consumed);\nif (result != QUIC_TP_OK)\n  return result;\n*pos += bytes_consumed;\n```\n\n### Recommendation\n\nDefine a macro to encapsulate the pattern:\n\n```c\n/**\n * @brief Decode varint at current position and advance.\n *\n * Decodes a varint from data at *pos, stores result in out_var,\n * and advances *pos by the number of bytes consumed.\n *\n * @param data      Input buffer\n * @param len       Length of input buffer  \n * @param pos       Pointer to current position (updated on success)\n * @param out_var   Variable to store decoded value\n *\n * On error, returns early from enclosing function with QUIC_TP_ERROR_*.\n */\n#define DECODE_VARINT_AT_POS(data, len, pos, out_var) \\\n  do { \\\n    size_t __consumed; \\\n    SocketQUICTransportParams_Result __res = \\\n        decode_varint_value((data) + *(pos), (len) - *(pos), \\\n                           &(out_var), &__consumed); \\\n    if (__res != QUIC_TP_OK) \\\n      return __res; \\\n    *(pos) += __consumed; \\\n  } while(0)\n```\n\n### Usage After Fix\n\n```c\nstatic SocketQUICTransportParams_Result\ndecode_single_param (const uint8_t *data, size_t len, size_t *pos,\n                     SocketQUICRole peer_role,\n                     SocketQUICTransportParams_T *params, uint64_t *seen_params)\n{\n  uint64_t param_id;\n  uint64_t param_len;\n\n  /* Decode parameter ID */\n  DECODE_VARINT_AT_POS(data, len, pos, param_id);\n\n  /* Decode parameter length */\n  DECODE_VARINT_AT_POS(data, len, pos, param_len);\n\n  /* Check we have enough data for the parameter value */\n  if (*pos + param_len > len)\n    return QUIC_TP_ERROR_INCOMPLETE;\n\n  /* ... rest of function ... */\n}\n```\n\n### Benefits\n\n- Reduces 5 lines to 1 for each varint decode\n- Makes code more readable (intent is clear)\n- Eliminates need for `bytes_consumed` variable\n- Reduces chance of copy-paste errors\n- Consistent with `do { } while(0)` macro pattern used in codebase\n\n### Impact\n\n- This pattern appears twice in this function\n- Could be useful in other QUIC decoding functions if the pattern recurs\n\n## Labels\n\n`refactoring`, `redundancy`, `quic`, `low-priority`, `good-first-issue`",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}