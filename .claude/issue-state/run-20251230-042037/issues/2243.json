{
  "number": 2243,
  "title": "refactor(quic): break down SocketQUIC_send_connection_close into smaller helpers",
  "body": "## Summary\n\nThe `SocketQUIC_send_connection_close` function in `src/quic/SocketQUICError-handling.c` is 76 lines long (lines 58-133), exceeding the recommended 50-line limit for function length.\n\n## Details\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/quic/SocketQUICError-handling.c`\n**Lines**: 58-133\n**Category**: Refactoring\n**Severity**: HIGH\n**Pattern**: LONG_FUNCTION_75\n\n## Current Code\n\nThe function handles multiple responsibilities:\n- Parameter validation (lines 66-71)\n- Error type classification (lines 73-79)\n- Reason length clamping (lines 82-83)\n- Buffer size calculation with overflow checks (lines 86-96)\n- Frame type encoding (lines 101-102)\n- Error code encoding (lines 105-106)\n- Conditional frame type field encoding for transport errors (lines 110-115)\n- Reason phrase length encoding (lines 118-119)\n- Reason phrase copying with overflow protection (lines 122-130)\n\n## Recommendation\n\nBreak the function into smaller, focused helpers:\n\n1. **validate_connection_close_params**: Validate input parameters and clamp reason length\n2. **calculate_connection_close_size**: Calculate required buffer size with overflow checks\n3. **encode_connection_close_header**: Encode frame type, error code, and frame type field\n4. **encode_reason_phrase**: Encode reason phrase length and copy data\n\nThis will:\n- Improve testability (each helper can be unit tested independently)\n- Enhance readability (each function has a single, clear purpose)\n- Make overflow protection logic more auditable\n- Follow single responsibility principle\n\n## Context\n\nThis follows the code quality guidelines in CLAUDE.md which recommend keeping functions under 50-100 lines for maintainability.\n\n## Labels\n\n- `refactoring`\n- `code-quality`\n- `quic`",
  "labels": [
    "wip:claude-1767092676-3930812"
  ],
  "state": "OPEN",
  "dependencies": []
}