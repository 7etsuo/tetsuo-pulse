{
  "number": 2330,
  "title": "review(simple-timer): evaluate readability of time validation ternary",
  "body": "## Summary\n\nThe time validation logic in `timer_add_common` uses a compact ternary expression that may benefit from being spelled out more explicitly for readability.\n\n## Location\n\n**File**: src/simple/SocketSimple-timer.c\n**Line**: 104\n**Function**: timer_add_common\n\n## Issue Details\n\nCurrent validation code:\n```c\nif (allow_zero ? (time_ms < 0) : (time_ms <= 0))\n  {\n    simple_set_error (SOCKET_SIMPLE_ERR_INVALID_ARG, time_error_msg);\n    return NULL;\n  }\n```\n\n**Semantics**:\n- If allow_zero is true: reject only negative values (time_ms < 0)\n- If allow_zero is false: reject zero or negative values (time_ms <= 0)\n\n## Analysis\n\n**Current approach**:\n- Compact and clever\n- All logic in one conditional\n- Requires mental parsing of ternary\n\n**Alternative approaches**:\n\nOption 1: Explicit if-else\n```c\nif (allow_zero)\n  {\n    if (time_ms < 0)\n      {\n        simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, time_error_msg);\n        return NULL;\n      }\n  }\nelse\n  {\n    if (time_ms <= 0)\n      {\n        simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, time_error_msg);\n        return NULL;\n      }\n  }\n```\n\nOption 2: Clearer boolean expression\n```c\nbool invalid = allow_zero ? (time_ms < 0) : (time_ms <= 0);\nif (invalid)\n  {\n    simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, time_error_msg);\n    return NULL;\n  }\n```\n\nOption 3: Helper function\n```c\nstatic bool\nis_time_valid(int64_t time_ms, int allow_zero)\n{\n  return allow_zero ? (time_ms >= 0) : (time_ms > 0);\n}\n\nif (!is_time_valid(time_ms, allow_zero))\n  {\n    simple_set_error(SOCKET_SIMPLE_ERR_INVALID_ARG, time_error_msg);\n    return NULL;\n  }\n```\n\n## Questions for Review\n\n1. Is the current ternary clear enough, or should it be expanded?\n2. Is this pattern used consistently elsewhere in the codebase?\n3. Would a helper function be useful if this pattern appears in multiple places?\n\n## Impact\n\n- **Severity**: MEDIUM (style/readability)\n- **Category**: Refactoring\n- **Pattern ID**: COMPLEX_TERNARY_VALIDATION\n- Improves code readability\n- Makes logic more explicit\n- Minimal performance impact (likely optimized away)\n\n## Recommendation\n\nThis is primarily a style question. The current code is functionally correct. Review whether:\n- Consistency with other validation patterns is preferred\n- Team prefers explicit conditionals over compact ternaries\n- This is a one-off case or a pattern worth standardizing\n\n---\n**Pattern**: COMPLEX_TERNARY_VALIDATION\n**Status**: Needs Manual Review\n**Date**: 2025-12-30",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}