{
  "number": 2298,
  "title": "[REFACTOR] Missing error handling for strdup failures",
  "body": "## Summary\nMultiple locations silently ignore strdup() allocation failures, potentially leading to incomplete DNS results without proper error reporting.\n\n## Location\n- File: `src/simple/SocketSimple-dns.c`\n- Lines: 108-110, 475-477, 804-806\n\n## Issue\nThe code checks if strdup succeeded before incrementing the counter, but doesn't report the allocation failure:\n\n```c\nresult->addresses[i] = strdup(host);\nif (result->addresses[i])\n    i++;\n```\n\nThis means:\n- If strdup fails partway through, some addresses are lost\n- Final `result->count` is less than actual DNS responses\n- No error is reported to the user\n- Silent data loss\n\n## Risk\n- **Severity**: MEDIUM\n- **Pattern**: MISSING_NULL_CHECK\n- **Impact**: Silent data loss, incomplete DNS results\n\n## Example Scenario\nDNS returns 10 addresses, strdup fails on address 5:\n- Only 4 addresses stored in result\n- `result->count = 4` (not 10)\n- User thinks there are only 4 addresses\n- No error indication\n\n## Recommendation\n\n### Option 1: Fail on any strdup error\n```c\nfor (struct addrinfo *p = res; p != NULL && i < count; p = p->ai_next) {\n    char host[NI_MAXHOST];\n    if (SocketCommon_reverse_lookup(p->ai_addr, p->ai_addrlen, host,\n                                   sizeof(host), NULL, 0, NI_NUMERICHOST,\n                                   SocketCommon_Failed) == 0) {\n        result->addresses[i] = strdup(host);\n        if (!result->addresses[i]) {\n            // Free already allocated addresses\n            for (int j = 0; j < i; j++) {\n                free(result->addresses[j]);\n            }\n            free(result->addresses);\n            result->addresses = NULL;\n            simple_set_error(SOCKET_SIMPLE_ERR_MEMORY,\n                           \"Memory allocation failed during DNS conversion\");\n            return -1;\n        }\n        i++;\n    }\n}\n```\n\n### Option 2: Continue but warn\nLog the allocation failure but continue processing remaining addresses. This is less strict but ensures partial results.\n\n## Affected Functions\n- `convert_addrinfo_to_result` (lines 108-110)\n- `simple_dns_callback_wrapper` (lines 475-477)\n- `Socket_simple_dns_request_result` (lines 804-806)\n\n## Related Issue\nThis is compounded by issue #2274 (duplicate code) - fixing in one place doesn't fix the duplicates.",
  "labels": [
    "bug"
  ],
  "state": "OPEN",
  "dependencies": []
}