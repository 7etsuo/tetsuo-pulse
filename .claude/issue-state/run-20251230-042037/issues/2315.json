{
  "number": 2315,
  "title": "refactor(reconnect): extract common retry logic from SocketReconnect_tick",
  "body": "## Summary\nThe `SocketReconnect_tick` function contains duplicated connection retry logic across two switch cases (RECONNECT_BACKOFF and RECONNECT_CIRCUIT_OPEN), leading to code duplication and increased maintenance burden.\n\n## Location\n- **File**: `src/socket/SocketReconnect.c`\n- **Function**: `SocketReconnect_tick`\n- **Lines**: 1160-1219\n\n## Issue Details\nThe function has nearly identical retry logic in two cases:\n\n**Case 1: RECONNECT_BACKOFF (lines 1175-1183)**\n```c\nif (start_connect(conn)) {\n  if (!conn->connect_in_progress)\n    handle_connect_success(conn);\n} else {\n  handle_connect_failure(conn);\n}\n```\n\n**Case 2: RECONNECT_CIRCUIT_OPEN (lines 1194-1202)**\n```c\nif (start_connect(conn)) {\n  if (!conn->connect_in_progress)\n    handle_connect_success(conn);\n} else {\n  handle_connect_failure(conn);\n}\n```\n\nThis is exactly duplicated code.\n\n## Recommendation\nExtract the common retry logic into a helper function:\n\n```c\nstatic void\nattempt_reconnect(T conn)\n{\n  transition_state(conn, RECONNECT_CONNECTING);\n  if (start_connect(conn)) {\n    if (!conn->connect_in_progress)\n      handle_connect_success(conn);\n  } else {\n    handle_connect_failure(conn);\n  }\n}\n```\n\nThen simplify the tick function:\n\n```c\nvoid\nSocketReconnect_tick(T conn)\n{\n  int64_t now;\n  \n  assert(conn);\n  now = socketreconnect_now_ms();\n  \n  switch (conn->state) {\n    case RECONNECT_BACKOFF:\n      if (now >= conn->backoff_until_ms) {\n        attempt_reconnect(conn);\n      }\n      break;\n      \n    case RECONNECT_CIRCUIT_OPEN:\n      if (now >= conn->circuit_open_time_ms + conn->policy.circuit_reset_timeout_ms) {\n        conn->circuit_state = CIRCUIT_HALF_OPEN;\n        attempt_reconnect(conn);\n      }\n      break;\n      \n    case RECONNECT_CONNECTED:\n      if (conn->policy.health_check_interval_ms > 0\n          && now >= conn->last_health_check_ms + conn->policy.health_check_interval_ms) {\n        perform_health_check(conn);\n      }\n      break;\n      \n    default:\n      break;\n  }\n}\n```\n\n## Benefits\n- Eliminates code duplication (DRY principle)\n- Reduces function length from 59 to ~35 lines\n- Centralizes retry logic for easier maintenance\n- Makes the state machine logic clearer\n\n## Pattern\n`LONG_FUNCTION_59`, `DUPLICATED_LOGIC`\n\n## Severity\nMEDIUM\n\n## Category\nrefactor",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}