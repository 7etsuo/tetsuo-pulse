{
  "number": 2219,
  "title": "security: add warning when weak random fallback used in cnonce generation",
  "body": "## Summary\n\nIn `SocketHTTPClient-auth.c` lines 507-511, when `SocketCrypto_random_bytes()` fails, the code silently falls back to using `time(NULL)` as a source of entropy. This is predictable and weakens the security of HTTP Digest authentication.\n\n## Location\n\n**File:** `/home/tetsuo/git/tetsuo-socket/src/http/SocketHTTPClient-auth.c`  \n**Lines:** 507-511  \n**Function:** `generate_cnonce`\n\n## Current Code\n\n```c\nif (SocketCrypto_random_bytes (random_bytes, sizeof (random_bytes)) != 0)\n  {\n    uint64_t t = (uint64_t)time (NULL);\n    memcpy (random_bytes, &t, sizeof (t));\n    memset (random_bytes + sizeof (t), 0,\n            sizeof (random_bytes) - sizeof (t));\n  }\n```\n\n## Issue\n\nThe cnonce (client nonce) in HTTP Digest authentication must be unpredictable to prevent replay attacks. When crypto RNG fails, falling back to `time(NULL)` creates a predictable nonce that attackers can guess, especially if they know the approximate time of the request.\n\n## Recommendation\n\n1. **Option A (Fail Hard):** Return an error instead of using weak entropy\n2. **Option B (Log Warning):** Add a warning log:\n\n```c\nif (SocketCrypto_random_bytes (random_bytes, sizeof (random_bytes)) != 0)\n  {\n    SOCKET_LOG_WARN_MSG(\"Crypto RNG failed, using weak time-based fallback for cnonce\");\n    uint64_t t = (uint64_t)time (NULL);\n    memcpy (random_bytes, &t, sizeof (t));\n    memset (random_bytes + sizeof (t), 0,\n            sizeof (random_bytes) - sizeof (t));\n  }\n```\n\n## Severity\n\n**MEDIUM** - Weakens authentication security under failure conditions\n\n## Pattern ID\n\n`WEAK_RANDOM_FALLBACK`",
  "labels": [
    "wip:claude-1767092676-3930812"
  ],
  "state": "OPEN",
  "dependencies": []
}