{
  "number": 2360,
  "title": "refactor(tls): deduplicate handshake precondition checks",
  "body": "## Summary\n\nThe functions `SocketTLS_handshake_loop()` and `SocketTLS_handshake_loop_ex()` have duplicate precondition validation logic that should be extracted to a shared helper.\n\n## Location\n\n**File**: `src/tls/SocketTLS.c`\n**Lines**: 782-815\n**Functions**: `SocketTLS_handshake_loop()`, `SocketTLS_handshake_loop_ex()`\n\n## Issue\n\nBoth functions check:\n- `socket->tls_handshake_done` and return early if true\n- Call `validate_handshake_preconditions(socket)`\n- Compute `start_time_ms`\n- Call `handshake_loop_internal()` with similar parameters\n\n## Recommendation\n\nExtract common logic to a helper:\n\n```c\nstatic TLSHandshakeState\nhandshake_loop_with_defaults(Socket_T socket, int timeout_ms, int poll_interval_ms) {\n    assert(socket);\n    \n    if (socket->tls_handshake_done)\n        return TLS_HANDSHAKE_COMPLETE;\n    \n    validate_handshake_preconditions(socket);\n    \n    int64_t start_time_ms = Socket_get_monotonic_ms();\n    return handshake_loop_internal(socket, timeout_ms, poll_interval_ms, start_time_ms);\n}\n\n// Then simplify the public functions\nTLSHandshakeState\nSocketTLS_handshake_loop(Socket_T socket, int timeout_ms) {\n    return handshake_loop_with_defaults(socket, timeout_ms, SOCKET_TLS_POLL_INTERVAL_MS);\n}\n\nTLSHandshakeState\nSocketTLS_handshake_loop_ex(Socket_T socket, int timeout_ms, int poll_interval_ms) {\n    if (poll_interval_ms <= 0)\n        poll_interval_ms = SOCKET_TLS_POLL_INTERVAL_MS;\n    return handshake_loop_with_defaults(socket, timeout_ms, poll_interval_ms);\n}\n```\n\n## Impact\n\n- **Severity**: MEDIUM\n- **Category**: Refactoring\n- **Pattern**: DUPLICATE_PRECONDITION_CHECK\n\n## Labels\n\n- `refactoring`\n- `code-quality`\n- `low-priority`",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}