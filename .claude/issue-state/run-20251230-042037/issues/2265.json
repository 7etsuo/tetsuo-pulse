{
  "number": 2265,
  "title": "refactor(simple-ratelimit): extract duplicated timespec conversion to helper function",
  "body": "## Summary\n\nThe file `src/simple/SocketSimple-ratelimit.c` contains duplicated code for converting milliseconds to `struct timespec` (lines 223-224, 277-278).\n\n## Issue Details\n\n- **File**: `/home/tetsuo/git/tetsuo-socket/src/simple/SocketSimple-ratelimit.c`\n- **Lines**: 223-224, 277-278\n- **Category**: Refactoring\n- **Severity**: MEDIUM\n- **Pattern**: `DUPLICATED_TIMESPEC_CONVERSION`\n\n## Current Code\n\nThe pattern appears twice:\n```c\nstruct timespec ts;\nts.tv_sec = wait_ms / 1000;\nts.tv_nsec = (wait_ms % 1000) * 1000000;\n```\n\n## Recommendation\n\nExtract to a static helper function:\n\n```c\nstatic void\nms_to_timespec(int ms, struct timespec *ts)\n{\n    ts->tv_sec = ms / 1000;\n    ts->tv_nsec = (ms % 1000) * NANOSECONDS_PER_MILLISECOND;\n}\n```\n\nThen use it:\n```c\nstruct timespec ts;\nms_to_timespec(wait_ms, &ts);\nnanosleep(&ts, NULL);\n```\n\n## Locations\n\n- Lines 223-224 in `Socket_simple_ratelimit_acquire()`\n- Lines 277-278 in `Socket_simple_ratelimit_acquire_timeout()`\n\n## Benefits\n\n- Eliminates code duplication\n- Centralizes the conversion logic\n- Makes future changes easier (e.g., adding bounds checking)\n- Improves readability",
  "labels": [
    "enhancement",
    "wip:claude-1767092676-3930812"
  ],
  "state": "OPEN",
  "dependencies": []
}