{
  "number": 486,
  "title": "refactor(proxy): simplify redundant colon-search logic in proxy URL parsing",
  "body": "## Problem\n\nThe URL parsing logic in `proxy_parse_userinfo()` contains an empty else-if block and a redundant else block that duplicates code from the first branch.\n\n## Location\n\n`src/socket/SocketProxy.c:212-239`\n\n```c\n  colon = strchr (start, ':');\n  if (colon != NULL && colon > at_sign)\n    {\n      colon = NULL;\n      for (const char *p = start; p < at_sign; p++)\n        {\n          if (*p == ':')\n            {\n              colon = p;\n              break;\n            }\n        }\n    }\n  else if (colon != NULL && colon < at_sign)\n    {\n      // Empty block - colon is already valid\n    }\n  else\n    {\n      colon = NULL;  // Already NULL in this branch\n      for (const char *p = start; p < at_sign; p++)\n        {\n          if (*p == ':')\n            {\n              colon = p;\n              break;\n            }\n        }\n    }\n```\n\n## Analysis\n\n1. **Empty else-if block (lines 225-227)**: When `colon != NULL && colon < at_sign`, the colon is valid for username:password parsing, so no action is needed. However, an empty block without explanation is confusing.\n\n2. **Redundant else block (lines 228-239)**: This branch is only reachable when:\n   - `colon == NULL` (strchr found no colon in the entire string)\n   - `colon == at_sign` is impossible since `strchr(start, ':')` searches for `:`, not `@`\n\n   When `colon == NULL`, the loop at lines 230-238 will never find a colon because `strchr` already searched the entire string including the `start` to `at_sign` range. This makes the loop effectively dead code.\n\n3. **Code duplication**: The if-block (lines 214-223) and else-block (lines 228-239) contain identical code, which is a maintenance concern.\n\n## Fix\n\nSimplify the logic:\n\n```c\n  colon = strchr (start, ':');\n  \n  /* If colon was found but it's after @, search only in userinfo part */\n  if (colon == NULL || colon >= at_sign)\n    {\n      colon = NULL;\n      for (const char *p = start; p < at_sign; p++)\n        {\n          if (*p == ':')\n            {\n              colon = p;\n              break;\n            }\n        }\n    }\n  /* else: colon is before at_sign, already valid for username:password */\n```\n\nOr use memchr for efficiency:\n\n```c\n  colon = memchr (start, ':', (size_t)(at_sign - start));\n```\n\n## Category\n\nDead Code / Code Quality",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}