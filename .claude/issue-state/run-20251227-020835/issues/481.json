{
  "number": 481,
  "title": "refactor(proxy): simplify IPv6 port parsing in socketproxy_parse_hostport",
  "body": "## Location with Deep Nesting\n\n### SocketProxy.c:322-364 - socketproxy_parse_hostport IPv6 parsing\n\n**Current depth:** 4 levels of nesting with logic issues\n\n**Problems identified:**\n\n1. **Unnecessary extra scope block** at line 335 - adds nesting without purpose\n2. **Duplicated condition check** - lines 338 and 346 check the identical condition:\n   ```c\n   if (endptr > port_start + 1 && p >= 1 && p <= 65535)\n   ```\n3. **Apparent dead code** - The condition at line 346 will never be true because:\n   - We only reach line 346 when the condition at line 338 was false\n   - Line 346 rechecks the exact same condition, which must still be false\n\n**Current structure:**\n```c\nif (*port_start == ':') {\n    {   // <-- unnecessary extra scope\n        if (endptr > port_start+1 && p >= 1 && p <= 65535) {\n            config->port = (int)p;\n            authority_end = endptr;\n        }\n        else if (*endptr == '\\0' || ...) {\n            if (endptr > port_start+1 && p >= 1 && p <= 65535) {  // dead code\n                config->port = (int)p;\n                authority_end = endptr;\n            }\n            else { return -1; }\n        }\n        else { return -1; }\n    }\n    if (config->port <= 0 || config->port > 65535)\n        return -1;\n}\n```\n\n**Suggested simplification:**\n```c\nif (*port_start == ':') {\n    char *endptr;\n    long p = strtol(port_start + 1, &endptr, 10);\n    \n    // Must have parsed at least one digit\n    if (endptr == port_start + 1)\n        return -1;\n    \n    // Must end at valid terminator\n    if (*endptr != '\\0' && *endptr != '/' && *endptr != '?' && *endptr != '#')\n        return -1;\n    \n    // Valid port range\n    if (p < 1 || p > 65535)\n        return -1;\n    \n    config->port = (int)p;\n    authority_end = endptr;\n}\n```\n\nThis reduces nesting from 4 levels to 1 level using early returns.\n\n## Category\nRefactoring - Complexity Reduction / Dead Code Removal\n\n## Notes\n- The other reported locations (SocketCommon.c:639-658 and SocketBuf.c:576-609) were reviewed and found to have justified complexity or less nesting than reported.",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}