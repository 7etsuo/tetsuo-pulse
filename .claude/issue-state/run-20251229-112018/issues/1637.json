{
  "number": 1637,
  "title": "refactor(quic): flatten nested if statements in SocketQUICPMTU.c",
  "body": "## Summary\n\nMultiple instances of deeply nested if statements (3 levels) were identified in SocketQUICPMTU.c that reduce code readability and maintainability.\n\n**Category**: Refactoring\n**Severity**: MEDIUM\n**Pattern**: `NESTED_IF_DEPTH_3`\n**Files Affected**: 1\n\n## Affected Locations\n\n| File | Lines | Function | Context |\n|------|-------|----------|---------|\n| `src/quic/SocketQUICPMTU.c` | 178-198 | `probe_size_selection` | Probe size calculation logic |\n| `src/quic/SocketQUICPMTU.c` | 267-285 | `handle_probe_response` | Probe response processing |\n\n## Problem\n\nNested if statements at 3+ levels deep make code harder to:\n- Read and understand the control flow\n- Test all branches systematically\n- Modify without introducing bugs\n- Debug when issues arise\n\nThe current nesting creates a \"rightward drift\" that obscures the main logic path and buries important conditions deep in the nesting hierarchy.\n\n## Recommended Fix\n\nApply two refactoring patterns to flatten the nesting:\n\n### Pattern 1: Guard Clauses (Early Returns)\n\nReplace nested conditions with early validation and returns:\n\n```c\n// Before (nested)\nif (condition1) {\n    if (condition2) {\n        if (condition3) {\n            // main logic\n        }\n    }\n}\n\n// After (guard clauses)\nif (!condition1)\n    return ERROR_STATE;\n    \nif (!condition2)\n    return ERROR_STATE;\n    \nif (!condition3)\n    return ERROR_STATE;\n\n// main logic\n```\n\n### Pattern 2: Extract Helper Functions\n\nBreak complex nested logic into focused helper functions:\n\n```c\n// Before (nested)\nif (state == SEARCHING) {\n    if (probe_valid(probe)) {\n        if (should_update(probe)) {\n            // update logic\n        }\n    }\n}\n\n// After (extracted)\nstatic bool should_process_probe(state, probe) {\n    return state == SEARCHING && probe_valid(probe) && should_update(probe);\n}\n\nif (should_process_probe(pmtu->state, probe)) {\n    // update logic\n}\n```\n\n### Pattern 3: Combine Related Conditions\n\nUse logical operators to flatten sequential checks:\n\n```c\n// Before\nif (a) {\n    if (b) {\n        if (c) {\n            // logic\n        }\n    }\n}\n\n// After\nif (a && b && c) {\n    // logic\n}\n```\n\n## Specific Recommendations\n\n### Location 1: `probe_size_selection` (lines 178-198)\n\nUse guard clauses to validate state and limits early, then perform the main probe size calculation logic.\n\n### Location 2: `handle_probe_response` (lines 267-285)\n\nApply early validation pattern to check probe state before processing response. Consider extracting probe validation logic to a helper function.\n\n## Checklist\n\n- [ ] Review and flatten nesting in `probe_size_selection` (lines 178-198)\n- [ ] Review and flatten nesting in `handle_probe_response` (lines 267-285)\n- [ ] Ensure all edge cases remain covered\n- [ ] Run tests with sanitizers: `cmake -B build -DENABLE_SANITIZERS=ON && cmake --build build -j$(nproc) && cd build && ctest -j$(nproc) --output-on-failure`\n- [ ] Verify QUIC PMTU tests pass\n- [ ] Check code coverage remains consistent\n\n## Benefits\n\n- **Readability**: Reduced cognitive load for understanding control flow\n- **Testability**: Easier to test individual conditions and paths\n- **Maintainability**: Simpler to modify and extend logic\n- **Debuggability**: Clearer stack traces and easier breakpoint placement\n\n## References\n\n- Martin Fowler's Refactoring: \"Replace Nested Conditional with Guard Clauses\"\n- Linux Kernel Style Guide: Avoid deep nesting (3+ levels)\n- QUIC PMTU module: `src/quic/SocketQUICPMTU.c`\n\n---\n*Generated by /pipeline code analysis - refactor mode*",
  "labels": [
    "enhancement",
    "good first issue",
    "quic"
  ],
  "state": "OPEN",
  "dependencies": []
}