{
  "number": 1721,
  "title": "refactor(http2-priority): inline single-use parse_integer function",
  "body": "## Summary\n\nThe `parse_integer` function is a 26-line static helper that is called exactly once. It should be inlined into its single call site to reduce unnecessary abstraction overhead.\n\n## Location\n\n- **File**: `src/http/SocketHTTP2-priority.c`\n- **Definition**: Lines 58-83 (26 lines)\n- **Single Call Site**: Line 197 (within `SocketHTTP2_Priority_parse`)\n- **Pattern**: SINGLE_USE_INLINE\n- **Severity**: HIGH\n\n## Current Code\n\n**Function Definition (lines 58-83):**\n```c\nstatic int\nparse_integer (const char **pp, const char *end, int *value)\n{\n  const char *p = *pp;\n  int v = 0;\n  int digits = 0;\n\n  if (p >= end)\n    return -1;\n\n  /* Parse digits */\n  while (p < end && *p >= '0' && *p <= '9')\n    {\n      v = v * 10 + (*p - '0');\n      digits++;\n      p++;\n      if (digits > 15)\n        return -1; /* Too many digits */\n    }\n\n  if (digits == 0)\n    return -1;\n\n  *value = v;\n  *pp = p;\n  return 0;\n}\n```\n\n**Single Call Site (line 197):**\n```c\nint urgency;\nif (parse_integer (&p, end, &urgency) < 0)\n  {\n    SOCKET_LOG_DEBUG_MSG (\"Priority parse error: invalid u value\");\n    return -1;\n  }\n```\n\n## Recommendation\n\nInline the function body directly at line 197:\n\n```c\n/* Parse urgency value (RFC 8941: integer = [\"-\"] 1*15DIGIT) */\nint urgency = 0;\nint digits = 0;\nconst char *digit_start = p;\n\nwhile (p < end && *p >= '0' && *p <= '9')\n  {\n    urgency = urgency * 10 + (*p - '0');\n    digits++;\n    p++;\n    if (digits > 15)\n      {\n        SOCKET_LOG_DEBUG_MSG (\"Priority parse error: invalid u value (too many digits)\");\n        return -1;\n      }\n  }\n\nif (digits == 0)\n  {\n    SOCKET_LOG_DEBUG_MSG (\"Priority parse error: invalid u value\");\n    return -1;\n  }\n```\n\n## Rationale\n\n1. **Single use**: Function is called only once in the entire codebase\n2. **Small size**: 26 lines is below the 30-line inlining threshold\n3. **No reusability**: Despite generic name, function is specific to this parser\n4. **Reduced indirection**: Inlining improves code locality and readability\n5. **Similar pattern**: `skip_ows` (7 uses) and `parse_key` (1 use) show inconsistent abstraction\n\n## Impact\n\n- Reduces function call overhead (minimal)\n- Improves code locality and readability\n- Eliminates unnecessary abstraction layer\n- No functional changes",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}