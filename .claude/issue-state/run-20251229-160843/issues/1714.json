{
  "number": 1714,
  "title": "refactor(http-core): inline single-use sockethttp_header_value_is_safe function",
  "body": "## Summary\n\nThe static function `sockethttp_header_value_is_safe` is called exactly once in the codebase and should be inlined for better code locality and reduced indirection.\n\n## Location\n\n**File**: `src/http/SocketHTTP-core.c`  \n**Function**: `sockethttp_header_value_is_safe` (lines 145-155)  \n**Single call site**: line 439 in `SocketHTTP_header_value_valid`\n\n## Current Code\n\n```c\n/* SECURITY: Check for NUL/CR/LF to prevent header injection (CWE-113) */\nstatic int\nsockethttp_header_value_is_safe (const char *s, size_t len)\n{\n  for (size_t i = 0; i < len; i++)\n    {\n      unsigned char c = (unsigned char)s[i];\n      if (c == 0 || c == '\\r' || c == '\\n')\n        return 0;\n    }\n  return 1;\n}\n```\n\nCalled from:\n```c\nint\nSocketHTTP_header_value_valid (const char *value, size_t len)\n{\n  if (!value)\n    return len == 0;\n  len = sockethttp_effective_length (value, len);\n  if (len > SOCKETHTTP_MAX_HEADER_VALUE)\n    return 0;\n  return sockethttp_header_value_is_safe (value, len);  // Line 439\n}\n```\n\n## Analysis\n\n- **Pattern**: SINGLE_USE_INLINE\n- **Severity**: HIGH\n- **Lines of code**: 11\n- **Call count**: 1 (entire codebase)\n\n## Recommendation\n\nInline the function into `SocketHTTP_header_value_valid`, preserving the security comment:\n\n```c\nint\nSocketHTTP_header_value_valid (const char *value, size_t len)\n{\n  if (!value)\n    return len == 0;\n  len = sockethttp_effective_length (value, len);\n  if (len > SOCKETHTTP_MAX_HEADER_VALUE)\n    return 0;\n  \n  /* SECURITY: Check for NUL/CR/LF to prevent header injection (CWE-113) */\n  for (size_t i = 0; i < len; i++)\n    {\n      unsigned char c = (unsigned char)value[i];\n      if (c == 0 || c == '\\r' || c == '\\n')\n        return 0;\n    }\n  return 1;\n}\n```\n\n## Justification\n\n1. The function is only called once, making the indirection unnecessary\n2. Inlining improves code locality and readability\n3. The security comment can be preserved at the call site\n4. Recent commits (e.g., `dbd6d72f`) show the team actively inlines similar single-use security functions (like `response_header_safe`)\n5. The function is small (11 lines) and straightforward\n\n## Related\n\nThis follows the same pattern as recent refactoring work:\n- #1695: Inline single-use `response_header_safe` function\n- #1692: Inline single-use `is_ipv4_address` function\n\n---\n\n**Pattern ID**: SINGLE_USE_INLINE  \n**Category**: Refactoring (readability)  \n**Verified**: Yes",
  "labels": [],
  "state": "OPEN",
  "dependencies": []
}