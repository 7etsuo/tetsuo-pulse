{
  "number": 1699,
  "title": "refactor(http-client-retry): inline single-use is_idempotent_method function",
  "body": "## Summary\n\nThe static function `is_idempotent_method()` is called exactly once in `SocketHTTPClient-retry.c` at line 124. This 15-line helper function checks if an HTTP method is idempotent per RFC 7231.\n\n## Location\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/http/SocketHTTPClient-retry.c`  \n**Lines**: 95-110  \n**Pattern**: `SINGLE_USE_INLINE`  \n**Severity**: HIGH  \n**Category**: Readability Refactor\n\n## Current Code\n\n```c\n/* RFC 7231: GET, HEAD, PUT, DELETE, OPTIONS, TRACE are idempotent */\nstatic int\nis_idempotent_method (SocketHTTP_Method method)\n{\n  switch (method)\n    {\n    case HTTP_METHOD_GET:\n    case HTTP_METHOD_HEAD:\n    case HTTP_METHOD_PUT:\n    case HTTP_METHOD_DELETE:\n    case HTTP_METHOD_OPTIONS:\n    case HTTP_METHOD_TRACE:\n      return 1;\n    default:\n      return 0;\n    }\n}\n```\n\n**Single call site** (line 124):\n```c\nif (!is_idempotent_method (method))\n  {\n    SOCKET_LOG_DEBUG_MSG (\"Not retrying %d on non-idempotent method\", status);\n    return 0;\n  }\n```\n\n## Recommendation\n\nInline the switch statement directly at line 124 within `httpclient_should_retry_status_with_method()`. This improves readability by keeping the idempotency check visible at its single use site.\n\n### Proposed Refactor\n\n```c\n/* SECURITY: Only retry 5xx for idempotent methods (RFC 7231) */\nswitch (method)\n  {\n  case HTTP_METHOD_GET:\n  case HTTP_METHOD_HEAD:\n  case HTTP_METHOD_PUT:\n  case HTTP_METHOD_DELETE:\n  case HTTP_METHOD_OPTIONS:\n  case HTTP_METHOD_TRACE:\n    break;  /* Idempotent - allow retry */\n  default:\n    SOCKET_LOG_DEBUG_MSG (\"Not retrying %d on non-idempotent method\", status);\n    return 0;\n  }\nreturn 1;\n```\n\n## Benefits\n\n1. Eliminates unnecessary function indirection for single-use code\n2. Improves code locality - logic is visible at point of use\n3. Maintains the RFC 7231 comment for context\n4. Reduces cognitive overhead (no need to jump to function definition)\n\n## Related\n\nThis follows the pattern from recent refactors:\n- #1695 - Inlined `response_header_safe` (single-use)\n- #1692 - Inlined `is_ipv4_address` (single-use)",
  "labels": [
    "enhancement"
  ],
  "state": "OPEN",
  "dependencies": []
}