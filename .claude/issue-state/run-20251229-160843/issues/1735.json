{
  "number": 1735,
  "title": "refactor(http-uri): flatten 4-level nesting in parse_quoted_value escape handling",
  "body": "## Summary\n\nThe `parse_quoted_value` function contains 4 levels of nested if statements in the escape sequence validation logic, making error handling harder to follow.\n\n## Location\n\n**File**: `/home/tetsuo/git/tetsuo-socket/src/http/SocketHTTP-uri.c`  \n**Lines**: 1266-1281  \n**Function**: `parse_quoted_value`  \n**Pattern**: `DEEP_NESTING_4`  \n**Severity**: HIGH\n\n## Current Code\n\n```c\nwhile (p < end && *p != '\"')\n  {\n    if (*p == '\\\\')\n      {\n        if (p + 1 >= end)\n          {\n            *value_start = NULL;\n            *value_len = 0;\n            return end;\n          }\n        p++;\n        unsigned char esc = (unsigned char)*p;\n        if (esc < 0x20 || esc == 0x7F)\n          {\n            *value_start = NULL;\n            *value_len = 0;\n            return end;\n          }\n      }\n    p++;\n  }\n```\n\n## Issue\n\nThis code has **4 levels of nesting**:\n1. `while` loop\n2. `if` (backslash check)\n3. `if` (bounds check for escape sequence)\n4. Error handling (null + return)\n\nThe control char validation adds another level of nesting in a different branch.\n\n## Recommendation\n\nFlatten using early error returns or extract validation to a helper:\n\n```c\nwhile (p < end && *p != '\"')\n  {\n    if (*p != '\\\\')\n      {\n        p++;\n        continue;\n      }\n    \n    /* Handle escape sequence */\n    if (p + 1 >= end)\n      {\n        *value_start = NULL;\n        *value_len = 0;\n        return end;\n      }\n    \n    p++;\n    unsigned char esc = (unsigned char)*p;\n    if (esc < 0x20 || esc == 0x7F)\n      {\n        *value_start = NULL;\n        *value_len = 0;\n        return end;\n      }\n    \n    p++;\n  }\n```\n\nThis reduces nesting from 4 levels to 3 levels by inverting the first condition.\n\n## Context\n\nThis function parses quoted strings in HTTP media type parameters (Content-Type headers). It validates escape sequences to prevent injection attacks.\n\n## Category\nReadability refactoring",
  "labels": [
    "enhancement"
  ],
  "state": "OPEN",
  "dependencies": []
}