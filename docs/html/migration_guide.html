<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tetsuo Pulse: Migration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="socket-brand.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Tetsuo Pulse<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-performance networking from Tetsuo</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('migration_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Migration Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Guide for migrating to the Socket Library from other networking libraries.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md1078"></a>
Migration from BSD Sockets</h1>
<p>The Socket Library provides a higher-level abstraction over BSD sockets.</p>
<h2><a class="anchor" id="autotoc_md1079"></a>
Socket Creation</h2>
<p><b>BSD Sockets:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> fd = socket(AF_INET, SOCK_STREAM, 0);</div>
<div class="line"><span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line">    perror(<span class="stringliteral">&quot;socket&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    Socket_T sock = <a class="code hl_function" href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1">Socket_new</a>(AF_INET, SOCK_STREAM, 0);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__core__io.html#ga225f4a8fd657fd52a05146c6fc4f58b0">Socket_Failed</a>) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error: %s\n&quot;</span>, <a class="code hl_function" href="group__foundation.html#gac71a25566cdc9e11eaecb16c966081db">Socket_GetLastError</a>());</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
<div class="ttc" id="agroup__core__io_html_ga225f4a8fd657fd52a05146c6fc4f58b0"><div class="ttname"><a href="group__core__io.html#ga225f4a8fd657fd52a05146c6fc4f58b0">Socket_Failed</a></div><div class="ttdeci">const Except_T Socket_Failed</div><div class="ttdoc">General socket operation failure exception.</div></div>
<div class="ttc" id="agroup__core__io_html_ga6212fb2b6eefa567592a59f55c25a6f1"><div class="ttname"><a href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1">Socket_new</a></div><div class="ttdeci">Socket_T Socket_new(int domain, int type, int protocol)</div><div class="ttdoc">Create a new socket with specified domain, type, and protocol.</div></div>
<div class="ttc" id="agroup__foundation_html_gab5e72fc2bd41014c75e0ace4feabfe8e"><div class="ttname"><a href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a></div><div class="ttdeci">#define EXCEPT(e)</div><div class="ttdoc">Catch a specific exception type within a TRY block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01105">Except.h:1105</a></div></div>
<div class="ttc" id="agroup__foundation_html_gac71a25566cdc9e11eaecb16c966081db"><div class="ttname"><a href="group__foundation.html#gac71a25566cdc9e11eaecb16c966081db">Socket_GetLastError</a></div><div class="ttdeci">const char * Socket_GetLastError(void)</div><div class="ttdoc">Socket_GetLastError - Retrieve the most recent formatted error message.</div></div>
<div class="ttc" id="agroup__foundation_html_gad2746371528bdf15c3910b7bf217dac0"><div class="ttname"><a href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a></div><div class="ttdeci">#define TRY</div><div class="ttdoc">Start a TRY/EXCEPT/FINALLY exception handling block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l00991">Except.h:991</a></div></div>
<div class="ttc" id="agroup__foundation_html_gae6628ac788ad213363b89dba9868420b"><div class="ttname"><a href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a></div><div class="ttdeci">#define END_TRY</div><div class="ttdoc">Complete a TRY/EXCEPT/FINALLY exception handling block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01439">Except.h:1439</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1080"></a>
Connecting</h2>
<p><b>BSD Sockets:</b> </p><div class="fragment"><div class="line"><span class="keyword">struct </span>sockaddr_in addr;</div>
<div class="line">memset(&amp;addr, 0, <span class="keyword">sizeof</span>(addr));</div>
<div class="line">addr.sin_family = AF_INET;</div>
<div class="line">addr.sin_port = htons(port);</div>
<div class="line">inet_pton(AF_INET, host, &amp;addr.sin_addr);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (connect(fd, (<span class="keyword">struct</span> sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(addr)) &lt; 0) {</div>
<div class="line">    perror(<span class="stringliteral">&quot;connect&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a>(sock, host, port);  <span class="comment">/* Handles DNS too */</span></div>
<div class="ttc" id="agroup__core__io_html_gac14390090ee26136c1f7a816fc08406e"><div class="ttname"><a href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a></div><div class="ttdeci">void Socket_connect(Socket_T socket, const char *host, int port)</div><div class="ttdoc">Establish a connection to a remote host and port.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1081"></a>
Sending Data</h2>
<p><b>BSD Sockets:</b> </p><div class="fragment"><div class="line">ssize_t total = 0;</div>
<div class="line"><span class="keywordflow">while</span> (total &lt; len) {</div>
<div class="line">    ssize_t n = send(fd, buf + total, len - total, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (errno == EINTR) <span class="keywordflow">continue</span>;</div>
<div class="line">        perror(<span class="stringliteral">&quot;send&quot;</span>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    total += n;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__core__io.html#ga6ea9ad33d78c50d327c9677b52849bcb">Socket_sendall</a>(sock, buf, len);  <span class="comment">/* Handles partial sends and EINTR */</span></div>
<div class="ttc" id="agroup__core__io_html_ga6ea9ad33d78c50d327c9677b52849bcb"><div class="ttname"><a href="group__core__io.html#ga6ea9ad33d78c50d327c9677b52849bcb">Socket_sendall</a></div><div class="ttdeci">ssize_t Socket_sendall(Socket_T socket, const void *buf, size_t len)</div><div class="ttdoc">Send all data (handles partial sends).</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1082"></a>
Socket Options</h2>
<p><b>BSD Sockets:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> optval = 1;</div>
<div class="line">setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, &amp;optval, <span class="keyword">sizeof</span>(optval));</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>linger l = {1, 0};</div>
<div class="line">setsockopt(fd, SOL_SOCKET, SO_LINGER, &amp;l, <span class="keyword">sizeof</span>(l));</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__core__io.html#ga2c6f352cec920859c71206898ed135fc">Socket_setreuseaddr</a>(sock);</div>
<div class="line">Socket_setlinger(sock, 1, 0);</div>
<div class="ttc" id="agroup__core__io_html_ga2c6f352cec920859c71206898ed135fc"><div class="ttname"><a href="group__core__io.html#ga2c6f352cec920859c71206898ed135fc">Socket_setreuseaddr</a></div><div class="ttdeci">void Socket_setreuseaddr(Socket_T socket)</div><div class="ttdoc">Enable address reuse.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1083"></a>
API Mapping (BSD -&gt; Socket Library)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">BSD Sockets   </th><th class="markdownTableHeadNone">Socket Library    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>socket()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1" title="Create a new socket with specified domain, type, and protocol.">Socket_new()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>close()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37" title="Dispose of a socket instance and close the underlying file descriptor.">Socket_free()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>connect()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e" title="Establish a connection to a remote host and port.">Socket_connect()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>bind()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gacb65d693d8c93e2a1fe6411dd0d0af98" title="Bind a socket to a local IP address and port.">Socket_bind()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>listen()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gab24b026bc4c69e6f766211f44675e189" title="Listen for incoming connections.">Socket_listen()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>accept()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga32b67d95639513cd6a602f6175b48f15" title="Accept incoming connection.">Socket_accept()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>send()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga23ace6e065fe4b9a01db8caa6513515b" title="Send data.">Socket_send()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>recv()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga95db343f47445925cecd6b20054518e9" title="Receive data.">Socket_recv()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>sendall</code> (loop)   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga6ea9ad33d78c50d327c9677b52849bcb" title="Send all data (handles partial sends).">Socket_sendall()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>getsockname()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga04e55475bcedbc100767663e1e7d9de1" title="Get local IP address.">Socket_getlocaladdr()</a></code>, <code><a class="el" href="group__core__io.html#ga3bdedaea9dac966d75343cdffa5d1f3e" title="Get local port number.">Socket_getlocalport()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>getpeername()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gab0957f43694d0728e70b23364a89623c" title="Get peer IP address.">Socket_getpeeraddr()</a></code>, <code><a class="el" href="group__core__io.html#ga38d7e5845519867261a9f24dfe0e03db" title="Get peer port number.">Socket_getpeerport()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>fcntl(O_NONBLOCK)</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga35309677a1760480783d5f0c294d0db4" title="Enable non-blocking mode.">Socket_setnonblocking()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>setsockopt(SO_REUSEADDR)</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga2c6f352cec920859c71206898ed135fc" title="Enable address reuse.">Socket_setreuseaddr()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>setsockopt(TCP_NODELAY)</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga55174d7f9aca0e94d25321540646e6b0" title="Disable Nagle&#39;s algorithm.">Socket_setnodelay()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>setsockopt(SO_KEEPALIVE)</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gaf03ef2a81d1894713aeb96c12bb2389b" title="Enable TCP keepalive.">Socket_setkeepalive()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>poll()</code> / <code>epoll</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__poll__private.html#structSocketPoll__T" title="Opaque internal state structure for SocketPoll instance.">SocketPoll_T</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>sendfile()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#ga6262f6ab4c927347abc0fb3c105a0575" title="Zero-copy file-to-socket transfer (handles partial transfers).">Socket_sendfileall()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>writev()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__core__io.html#gaf6d033a04d5041249950fa2f54a8d9fd" title="Scatter/gather send all (handles partial sends).">Socket_sendvall()</a></code>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md1085"></a>
Migration from libcurl</h1>
<h2><a class="anchor" id="autotoc_md1086"></a>
Simple GET Request</h2>
<p><b>libcurl:</b> </p><div class="fragment"><div class="line">CURL *curl = curl_easy_init();</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_URL, <span class="stringliteral">&quot;https://example.com&quot;</span>);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_WRITEDATA, &amp;response);</div>
<div class="line">CURLcode res = curl_easy_perform(curl);</div>
<div class="line">curl_easy_cleanup(curl);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line">SocketHTTPClient_T client = <a class="code hl_function" href="group__http__client.html#ga2d57db3a9a6388315f253caa099e4205">SocketHTTPClient_new</a>(NULL);</div>
<div class="line"><a class="code hl_struct" href="group__http__client.html#structSocketHTTPClient__Response">SocketHTTPClient_Response</a> response;</div>
<div class="line"><a class="code hl_function" href="group__http__client.html#gafef425814e66932f7cf1f36e9356b70e">SocketHTTPClient_get</a>(client, <span class="stringliteral">&quot;https://example.com&quot;</span>, &amp;response);</div>
<div class="line"><span class="comment">/* response.body contains data */</span></div>
<div class="line"><a class="code hl_function" href="group__http__client.html#ga826bca53483c23de2c8b03d456010149">SocketHTTPClient_Response_free</a>(&amp;response);</div>
<div class="line"><a class="code hl_function" href="group__http__client.html#ga01d6c9bebdcda63949ba9af698f8e7e5">SocketHTTPClient_free</a>(&amp;client);</div>
<div class="ttc" id="agroup__http__client_html_ga01d6c9bebdcda63949ba9af698f8e7e5"><div class="ttname"><a href="group__http__client.html#ga01d6c9bebdcda63949ba9af698f8e7e5">SocketHTTPClient_free</a></div><div class="ttdeci">void SocketHTTPClient_free(SocketHTTPClient_T *client)</div><div class="ttdoc">Destroy HTTP client and release all resources.</div></div>
<div class="ttc" id="agroup__http__client_html_ga2d57db3a9a6388315f253caa099e4205"><div class="ttname"><a href="group__http__client.html#ga2d57db3a9a6388315f253caa099e4205">SocketHTTPClient_new</a></div><div class="ttdeci">SocketHTTPClient_T SocketHTTPClient_new(const SocketHTTPClient_Config *config)</div><div class="ttdoc">Create new HTTP client instance.</div></div>
<div class="ttc" id="agroup__http__client_html_ga826bca53483c23de2c8b03d456010149"><div class="ttname"><a href="group__http__client.html#ga826bca53483c23de2c8b03d456010149">SocketHTTPClient_Response_free</a></div><div class="ttdeci">void SocketHTTPClient_Response_free(SocketHTTPClient_Response *response)</div><div class="ttdoc">Free response resources.</div></div>
<div class="ttc" id="agroup__http__client_html_gafef425814e66932f7cf1f36e9356b70e"><div class="ttname"><a href="group__http__client.html#gafef425814e66932f7cf1f36e9356b70e">SocketHTTPClient_get</a></div><div class="ttdeci">int SocketHTTPClient_get(SocketHTTPClient_T client, const char *url, SocketHTTPClient_Response *response)</div><div class="ttdoc">Perform synchronous GET request.</div></div>
<div class="ttc" id="agroup__http__client_html_structSocketHTTPClient__Response"><div class="ttname"><a href="group__http__client.html#structSocketHTTPClient__Response">SocketHTTPClient_Response</a></div><div class="ttdoc">HTTP response structure returned by client functions.</div><div class="ttdef"><b>Definition</b> <a href="SocketHTTPClient_8h_source.html#l00601">SocketHTTPClient.h:602</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1087"></a>
POST Request</h2>
<p><b>libcurl:</b> </p><div class="fragment"><div class="line">curl_easy_setopt(curl, CURLOPT_POST, 1L);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_POSTFIELDS, json);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__http__client.html#ga9b47bc2dd38d4a6700af79ced0acecb2">SocketHTTPClient_post</a>(client, url, <span class="stringliteral">&quot;application/json&quot;</span>, json, strlen(json), &amp;response);</div>
<div class="ttc" id="agroup__http__client_html_ga9b47bc2dd38d4a6700af79ced0acecb2"><div class="ttname"><a href="group__http__client.html#ga9b47bc2dd38d4a6700af79ced0acecb2">SocketHTTPClient_post</a></div><div class="ttdeci">int SocketHTTPClient_post(SocketHTTPClient_T client, const char *url, const char *content_type, const void *body, size_t body_len, SocketHTTPClient_Response *response)</div><div class="ttdoc">Perform synchronous POST request.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1088"></a>
Custom Headers</h2>
<p><b>libcurl:</b> </p><div class="fragment"><div class="line"><span class="keyword">struct </span>curl_slist *headers = NULL;</div>
<div class="line">headers = curl_slist_append(headers, <span class="stringliteral">&quot;Content-Type: application/json&quot;</span>);</div>
<div class="line">headers = curl_slist_append(headers, <span class="stringliteral">&quot;Authorization: Bearer token&quot;</span>);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line">SocketHTTPClient_Request_T req = <a class="code hl_function" href="group__http__client.html#ga46c9c2ab8d3334dd0ad1359d2bb93102">SocketHTTPClient_Request_new</a>(client, <a class="code hl_enumvalue" href="group__http.html#ggaf6f90bb536a5cd085f4327bda4d3ee8fa90754abc55dbb76862fa50abee5af659">HTTP_METHOD_GET</a>, url);</div>
<div class="line"><a class="code hl_function" href="group__http__client.html#ga8a7c54a81dc916af60f9747162e844a2">SocketHTTPClient_Request_header</a>(req, <span class="stringliteral">&quot;Content-Type&quot;</span>, <span class="stringliteral">&quot;application/json&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__http__client.html#ga8a7c54a81dc916af60f9747162e844a2">SocketHTTPClient_Request_header</a>(req, <span class="stringliteral">&quot;Authorization&quot;</span>, <span class="stringliteral">&quot;Bearer token&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__http__client.html#ga4ba09b6d59cc2aee465749978f62ad76">SocketHTTPClient_Request_execute</a>(req, &amp;response);</div>
<div class="ttc" id="agroup__http__client_html_ga46c9c2ab8d3334dd0ad1359d2bb93102"><div class="ttname"><a href="group__http__client.html#ga46c9c2ab8d3334dd0ad1359d2bb93102">SocketHTTPClient_Request_new</a></div><div class="ttdeci">SocketHTTPClient_Request_T SocketHTTPClient_Request_new(SocketHTTPClient_T client, SocketHTTP_Method method, const char *url)</div><div class="ttdoc">Create request builder.</div></div>
<div class="ttc" id="agroup__http__client_html_ga4ba09b6d59cc2aee465749978f62ad76"><div class="ttname"><a href="group__http__client.html#ga4ba09b6d59cc2aee465749978f62ad76">SocketHTTPClient_Request_execute</a></div><div class="ttdeci">int SocketHTTPClient_Request_execute(SocketHTTPClient_Request_T req, SocketHTTPClient_Response *response)</div><div class="ttdoc">Execute request.</div></div>
<div class="ttc" id="agroup__http__client_html_ga8a7c54a81dc916af60f9747162e844a2"><div class="ttname"><a href="group__http__client.html#ga8a7c54a81dc916af60f9747162e844a2">SocketHTTPClient_Request_header</a></div><div class="ttdeci">int SocketHTTPClient_Request_header(SocketHTTPClient_Request_T req, const char *name, const char *value)</div><div class="ttdoc">Add header.</div></div>
<div class="ttc" id="agroup__http_html_ggaf6f90bb536a5cd085f4327bda4d3ee8fa90754abc55dbb76862fa50abee5af659"><div class="ttname"><a href="group__http.html#ggaf6f90bb536a5cd085f4327bda4d3ee8fa90754abc55dbb76862fa50abee5af659">HTTP_METHOD_GET</a></div><div class="ttdeci">@ HTTP_METHOD_GET</div><div class="ttdef"><b>Definition</b> <a href="SocketHTTP_8h_source.html#l00315">SocketHTTP.h:314</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1089"></a>
Proxy Configuration</h2>
<p><b>libcurl:</b> </p><div class="fragment"><div class="line">curl_easy_setopt(curl, CURLOPT_PROXY, <span class="stringliteral">&quot;socks5://localhost:1080&quot;</span>);</div>
<div class="line">curl_easy_setopt(curl, CURLOPT_PROXYUSERPWD, <span class="stringliteral">&quot;user:pass&quot;</span>);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__proxy.html#structSocketProxy__Config">SocketProxy_Config</a> proxy;</div>
<div class="line"><a class="code hl_function" href="group__core__io.html#gae16c20e1d43f38171ccaad8408598490">SocketProxy_parse_url</a>(<span class="stringliteral">&quot;socks5://user:pass@localhost:1080&quot;</span>, &amp;proxy, NULL);</div>
<div class="line">config.proxy = &amp;proxy;</div>
<div class="line">client = <a class="code hl_function" href="group__http__client.html#ga2d57db3a9a6388315f253caa099e4205">SocketHTTPClient_new</a>(&amp;config);</div>
<div class="ttc" id="agroup__core__io_html_gae16c20e1d43f38171ccaad8408598490"><div class="ttname"><a href="group__core__io.html#gae16c20e1d43f38171ccaad8408598490">SocketProxy_parse_url</a></div><div class="ttdeci">int SocketProxy_parse_url(const char *url, SocketProxy_Config *config, Arena_T arena)</div><div class="ttdoc">Parse proxy URL string into configuration structure.</div></div>
<div class="ttc" id="agroup__proxy_html_structSocketProxy__Config"><div class="ttname"><a href="group__proxy.html#structSocketProxy__Config">SocketProxy_Config</a></div><div class="ttdoc">Configuration structure for proxy connections.</div><div class="ttdef"><b>Definition</b> <a href="SocketProxy_8h_source.html#l00379">SocketProxy.h:380</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1090"></a>
Error Handling</h2>
<p><b>libcurl:</b> </p><div class="fragment"><div class="line">CURLcode res = curl_easy_perform(curl);</div>
<div class="line"><span class="keywordflow">if</span> (res != CURLE_OK) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Error: %s\n&quot;</span>, curl_easy_strerror(res));</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    <a class="code hl_function" href="group__http__client.html#gafef425814e66932f7cf1f36e9356b70e">SocketHTTPClient_get</a>(client, url, &amp;response);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__http__client.html#gaa0847dd6efa2f627e07173f29b29c8ae">SocketHTTPClient_Timeout</a>) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Timeout\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__http__client.html#ga50039c8c595271d7d51b28ed5a4e7196">SocketHTTPClient_DNSFailed</a>) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;DNS error\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
<div class="ttc" id="agroup__http__client_html_ga50039c8c595271d7d51b28ed5a4e7196"><div class="ttname"><a href="group__http__client.html#ga50039c8c595271d7d51b28ed5a4e7196">SocketHTTPClient_DNSFailed</a></div><div class="ttdeci">const Except_T SocketHTTPClient_DNSFailed</div><div class="ttdoc">DNS resolution failure.</div></div>
<div class="ttc" id="agroup__http__client_html_gaa0847dd6efa2f627e07173f29b29c8ae"><div class="ttname"><a href="group__http__client.html#gaa0847dd6efa2f627e07173f29b29c8ae">SocketHTTPClient_Timeout</a></div><div class="ttdeci">const Except_T SocketHTTPClient_Timeout</div><div class="ttdoc">Request timeout exceeded.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1091"></a>
API Mapping (libcurl -&gt; Socket Library)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">libcurl   </th><th class="markdownTableHeadNone">Socket Library    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>curl_easy_init()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__http__client.html#ga2d57db3a9a6388315f253caa099e4205" title="Create new HTTP client instance.">SocketHTTPClient_new()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>curl_easy_cleanup()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__http__client.html#ga01d6c9bebdcda63949ba9af698f8e7e5" title="Destroy HTTP client and release all resources.">SocketHTTPClient_free()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>curl_easy_perform()</code>   </td><td class="markdownTableBodyNone"><code>SocketHTTPClient_get/post/etc()</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CURLOPT_URL</code>   </td><td class="markdownTableBodyNone">Function parameter    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CURLOPT_TIMEOUT</code>   </td><td class="markdownTableBodyNone"><code>config.request_timeout_ms</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CURLOPT_CONNECTTIMEOUT</code>   </td><td class="markdownTableBodyNone"><code>config.connect_timeout_ms</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CURLOPT_FOLLOWLOCATION</code>   </td><td class="markdownTableBodyNone"><code>config.follow_redirects</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CURLOPT_MAXREDIRS</code>   </td><td class="markdownTableBodyNone"><code>config.follow_redirects</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CURLOPT_PROXY</code>   </td><td class="markdownTableBodyNone"><code>config.proxy</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CURLOPT_SSL_VERIFYPEER</code>   </td><td class="markdownTableBodyNone"><code>config.verify_ssl</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CURLOPT_HTTPHEADER</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__http__client.html#ga8a7c54a81dc916af60f9747162e844a2" title="Add header.">SocketHTTPClient_Request_header()</a></code>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md1093"></a>
Migration from libevent</h1>
<h2><a class="anchor" id="autotoc_md1094"></a>
Event Loop</h2>
<p><b>libevent:</b> </p><div class="fragment"><div class="line"><span class="keyword">struct </span>event_base *base = event_base_new();</div>
<div class="line"><span class="keyword">struct </span>event *ev = event_new(base, fd, EV_READ | EV_PERSIST, callback, arg);</div>
<div class="line">event_add(ev, NULL);</div>
<div class="line">event_base_dispatch(base);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__poll__private.html#structSocketPoll__T">SocketPoll_T</a> poll = <a class="code hl_function" href="group__event__system.html#gac1fbd1a09d564f7988b0e427e5707ca7">SocketPoll_new</a>(1000);</div>
<div class="line"><a class="code hl_function" href="group__event__system.html#ga6c9f3f1a23dd85dd2d44ff9b0ced4e1e">SocketPoll_add</a>(poll, socket, <a class="code hl_enumvalue" href="group__event__system.html#gga9e8943c9cb47aba63dda4ad9083142b6a19f5d65c083268df50040f34f306d1b8">POLL_READ</a>, userdata);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (<a class="code hl_variable" href="connection__pool_8c.html#af1f449cc09f8d36befcce07bc38c29c0">running</a>) {</div>
<div class="line">    <a class="code hl_struct" href="group__event__system.html#structSocketEvent__T">SocketEvent_T</a> events[100];</div>
<div class="line">    <span class="keywordtype">int</span> n = <a class="code hl_function" href="group__event__system.html#gaa3d47365dd18329d50ee636284839738">SocketPoll_wait</a>(poll, events, 100, 1000);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line">        handle_event(events[i].socket, events[i].events, events[i].data);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aconnection__pool_8c_html_af1f449cc09f8d36befcce07bc38c29c0"><div class="ttname"><a href="connection__pool_8c.html#af1f449cc09f8d36befcce07bc38c29c0">running</a></div><div class="ttdeci">static volatile int running</div><div class="ttdef"><b>Definition</b> <a href="connection__pool_8c_source.html#l00029">connection_pool.c:29</a></div></div>
<div class="ttc" id="agroup__event__system_html_ga6c9f3f1a23dd85dd2d44ff9b0ced4e1e"><div class="ttname"><a href="group__event__system.html#ga6c9f3f1a23dd85dd2d44ff9b0ced4e1e">SocketPoll_add</a></div><div class="ttdeci">void SocketPoll_add(SocketPoll_T poll, Socket_T socket, unsigned events, void *data)</div><div class="ttdoc">Register a socket for I/O event monitoring within the poll instance.</div></div>
<div class="ttc" id="agroup__event__system_html_gaa3d47365dd18329d50ee636284839738"><div class="ttname"><a href="group__event__system.html#gaa3d47365dd18329d50ee636284839738">SocketPoll_wait</a></div><div class="ttdeci">int SocketPoll_wait(SocketPoll_T poll, SocketEvent_T **events, int timeout)</div><div class="ttdoc">Block and wait for I/O events or timeout on registered sockets.</div></div>
<div class="ttc" id="agroup__event__system_html_gac1fbd1a09d564f7988b0e427e5707ca7"><div class="ttname"><a href="group__event__system.html#gac1fbd1a09d564f7988b0e427e5707ca7">SocketPoll_new</a></div><div class="ttdeci">SocketPoll_T SocketPoll_new(int maxevents)</div><div class="ttdoc">Create a new event poll instance.</div></div>
<div class="ttc" id="agroup__event__system_html_gga9e8943c9cb47aba63dda4ad9083142b6a19f5d65c083268df50040f34f306d1b8"><div class="ttname"><a href="group__event__system.html#gga9e8943c9cb47aba63dda4ad9083142b6a19f5d65c083268df50040f34f306d1b8">POLL_READ</a></div><div class="ttdeci">@ POLL_READ</div><div class="ttdef"><b>Definition</b> <a href="SocketPoll_8h_source.html#l00181">SocketPoll.h:181</a></div></div>
<div class="ttc" id="agroup__event__system_html_structSocketEvent__T"><div class="ttname"><a href="group__event__system.html#structSocketEvent__T">SocketEvent_T</a></div><div class="ttdoc">Event notification structure returned by polling operations.</div><div class="ttdef"><b>Definition</b> <a href="SocketPoll_8h_source.html#l00205">SocketPoll.h:206</a></div></div>
<div class="ttc" id="agroup__poll__private_html_structSocketPoll__T"><div class="ttname"><a href="group__poll__private.html#structSocketPoll__T">SocketPoll_T</a></div><div class="ttdoc">Opaque internal state structure for SocketPoll instance.</div><div class="ttdef"><b>Definition</b> <a href="SocketPoll-private_8h_source.html#l00404">SocketPoll-private.h:405</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1095"></a>
Callback Style</h2>
<p><b>libevent:</b> </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> read_cb(evutil_socket_t fd, <span class="keywordtype">short</span> events, <span class="keywordtype">void</span> *arg) {</div>
<div class="line">    <span class="keywordtype">char</span> buf[1024];</div>
<div class="line">    ssize_t n = recv(fd, buf, <span class="keyword">sizeof</span>(buf), 0);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><span class="comment">/* Event loop style - no callbacks needed */</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (events[i].events &amp; <a class="code hl_enumvalue" href="group__event__system.html#gga9e8943c9cb47aba63dda4ad9083142b6a19f5d65c083268df50040f34f306d1b8">POLL_READ</a>) {</div>
<div class="line">        <span class="keywordtype">char</span> buf[1024];</div>
<div class="line">        ssize_t n = <a class="code hl_function" href="group__core__io.html#ga95db343f47445925cecd6b20054518e9">Socket_recv</a>(events[i].socket, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__core__io_html_ga95db343f47445925cecd6b20054518e9"><div class="ttname"><a href="group__core__io.html#ga95db343f47445925cecd6b20054518e9">Socket_recv</a></div><div class="ttdeci">ssize_t Socket_recv(Socket_T socket, void *buf, size_t len)</div><div class="ttdoc">Receive data.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1096"></a>
Timers</h2>
<p><b>libevent:</b> </p><div class="fragment"><div class="line"><span class="keyword">struct </span>event *timer = evtimer_new(base, timer_cb, arg);</div>
<div class="line"><span class="keyword">struct </span>timeval tv = {5, 0};</div>
<div class="line">evtimer_add(timer, &amp;tv);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__event__system.html#structSocketTimer__T">SocketTimer_T</a> timer = SocketTimer_new(arena);</div>
<div class="line">SocketTimer_schedule(timer, 5000, timer_callback, userdata);</div>
<div class="line"><span class="comment">/* Process in poll loop */</span></div>
<div class="ttc" id="agroup__event__system_html_structSocketTimer__T"><div class="ttname"><a href="group__event__system.html#structSocketTimer__T">SocketTimer_T</a></div><div class="ttdoc">Internal representation of a single scheduled timer event.</div><div class="ttdef"><b>Definition</b> <a href="SocketTimer-private_8h_source.html#l00140">SocketTimer-private.h:141</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1097"></a>
API Mapping (libevent -&gt; Socket Library)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">libevent   </th><th class="markdownTableHeadNone">Socket Library    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>event_base_new()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__event__system.html#gac1fbd1a09d564f7988b0e427e5707ca7" title="Create a new event poll instance.">SocketPoll_new()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>event_base_free()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__event__system.html#gaca744c50badbdb869c52088b9f32f8d2" title="Dispose of a SocketPoll instance and release all associated resources.">SocketPoll_free()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>event_new()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__event__system.html#ga6c9f3f1a23dd85dd2d44ff9b0ced4e1e" title="Register a socket for I/O event monitoring within the poll instance.">SocketPoll_add()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>event_add()</code>   </td><td class="markdownTableBodyNone">Automatic    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>event_del()</code>   </td><td class="markdownTableBodyNone"><code>SocketPoll_remove()</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>event_base_dispatch()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__event__system.html#gaa3d47365dd18329d50ee636284839738" title="Block and wait for I/O events or timeout on registered sockets.">SocketPoll_wait()</a></code> loop    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>EV_READ</code>   </td><td class="markdownTableBodyNone"><code>POLL_READ</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>EV_WRITE</code>   </td><td class="markdownTableBodyNone"><code>POLL_WRITE</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>evtimer_new()</code>   </td><td class="markdownTableBodyNone"><code>SocketTimer_schedule()</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>bufferevent_*</code>   </td><td class="markdownTableBodyNone"><code>SocketBuf_T</code>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md1099"></a>
Migration from libev</h1>
<h2><a class="anchor" id="autotoc_md1100"></a>
Event Loop</h2>
<p><b>libev:</b> </p><div class="fragment"><div class="line"><span class="keyword">struct </span>ev_loop *loop = ev_default_loop(0);</div>
<div class="line">ev_io watcher;</div>
<div class="line">ev_io_init(&amp;watcher, callback, fd, EV_READ);</div>
<div class="line">ev_io_start(loop, &amp;watcher);</div>
<div class="line">ev_run(loop, 0);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__poll__private.html#structSocketPoll__T">SocketPoll_T</a> poll = <a class="code hl_function" href="group__event__system.html#gac1fbd1a09d564f7988b0e427e5707ca7">SocketPoll_new</a>(1000);</div>
<div class="line"><a class="code hl_function" href="group__event__system.html#ga6c9f3f1a23dd85dd2d44ff9b0ced4e1e">SocketPoll_add</a>(poll, socket, <a class="code hl_enumvalue" href="group__event__system.html#gga9e8943c9cb47aba63dda4ad9083142b6a19f5d65c083268df50040f34f306d1b8">POLL_READ</a>, userdata);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (<a class="code hl_variable" href="connection__pool_8c.html#af1f449cc09f8d36befcce07bc38c29c0">running</a>) {</div>
<div class="line">    <a class="code hl_struct" href="group__event__system.html#structSocketEvent__T">SocketEvent_T</a> events[100];</div>
<div class="line">    <span class="keywordtype">int</span> n = <a class="code hl_function" href="group__event__system.html#gaa3d47365dd18329d50ee636284839738">SocketPoll_wait</a>(poll, events, 100, 1000);</div>
<div class="line">    <span class="comment">/* Process events */</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1102"></a>
Migration from OpenSSL Direct</h1>
<h2><a class="anchor" id="autotoc_md1103"></a>
TLS Client</h2>
<p><b>OpenSSL:</b> </p><div class="fragment"><div class="line">SSL_CTX *ctx = SSL_CTX_new(TLS_client_method());</div>
<div class="line">SSL_CTX_set_min_proto_version(ctx, TLS1_3_VERSION);</div>
<div class="line">SSL *ssl = SSL_new(ctx);</div>
<div class="line">SSL_set_fd(ssl, fd);</div>
<div class="line">SSL_set_tlsext_host_name(ssl, hostname);</div>
<div class="line">SSL_connect(ssl);</div>
<div class="line">SSL_write(ssl, data, len);</div>
<div class="line">SSL_read(ssl, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line">SSL_shutdown(ssl);</div>
<div class="line">SSL_free(ssl);</div>
<div class="line">SSL_CTX_free(ctx);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx = <a class="code hl_function" href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a>(NULL);</div>
<div class="line"><a class="code hl_function" href="group__security.html#gab9a8fb788aa1f0d21b5773bc43a48d6f">SocketTLS_enable</a>(sock, ctx);</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga15d2c8f4eaea80114bbd2123da025e56">SocketTLS_set_hostname</a>(sock, hostname);</div>
<div class="line"><span class="keywordflow">while</span> (<a class="code hl_function" href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454">SocketTLS_handshake</a>(sock) &gt; 0) { }</div>
<div class="line"><a class="code hl_function" href="group__security.html#gabdb38e692dde58bbec4ab905eeb8b3aa">SocketTLS_send</a>(sock, data, len);</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga1c71fc02141cd9e6da4fdf1c88dbbaf3">SocketTLS_recv</a>(sock, buf, <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><a class="code hl_function" href="group__security.html#gab11506db6f41f31e9fc170b3d0e848f1">SocketTLS_shutdown</a>(sock);</div>
<div class="line"><a class="code hl_function" href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a>(&amp;sock);</div>
<div class="line"><a class="code hl_function" href="group__security.html#gaea7ca3e656e9b58706fafc3232147203">SocketTLSContext_free</a>(&amp;ctx);</div>
<div class="ttc" id="agroup__core__io_html_ga74ad7a9bb8deaf499c59d90d6e411f37"><div class="ttname"><a href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a></div><div class="ttdeci">void Socket_free(Socket_T *socket)</div><div class="ttdoc">Dispose of a socket instance and close the underlying file descriptor.</div></div>
<div class="ttc" id="agroup__security_html_ga15d2c8f4eaea80114bbd2123da025e56"><div class="ttname"><a href="group__security.html#ga15d2c8f4eaea80114bbd2123da025e56">SocketTLS_set_hostname</a></div><div class="ttdeci">void SocketTLS_set_hostname(Socket_T socket, const char *hostname)</div><div class="ttdoc">Set SNI hostname for client TLS connections.</div></div>
<div class="ttc" id="agroup__security_html_ga1c71fc02141cd9e6da4fdf1c88dbbaf3"><div class="ttname"><a href="group__security.html#ga1c71fc02141cd9e6da4fdf1c88dbbaf3">SocketTLS_recv</a></div><div class="ttdeci">ssize_t SocketTLS_recv(Socket_T socket, void *buf, size_t len)</div><div class="ttdoc">Receive data from TLS-encrypted connection.</div></div>
<div class="ttc" id="agroup__security_html_ga7fe51da14439d768bdf72f4ed8fbb022"><div class="ttname"><a href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a></div><div class="ttdeci">SocketTLSContext_T SocketTLSContext_new_client(const char *ca_file)</div><div class="ttdoc">Create client TLS context.</div></div>
<div class="ttc" id="agroup__security_html_gab11506db6f41f31e9fc170b3d0e848f1"><div class="ttname"><a href="group__security.html#gab11506db6f41f31e9fc170b3d0e848f1">SocketTLS_shutdown</a></div><div class="ttdeci">void SocketTLS_shutdown(Socket_T socket)</div><div class="ttdoc">Perform graceful TLS connection shutdown.</div></div>
<div class="ttc" id="agroup__security_html_gab9a8fb788aa1f0d21b5773bc43a48d6f"><div class="ttname"><a href="group__security.html#gab9a8fb788aa1f0d21b5773bc43a48d6f">SocketTLS_enable</a></div><div class="ttdeci">void SocketTLS_enable(Socket_T socket, SocketTLSContext_T ctx)</div><div class="ttdoc">Enable TLS on a socket using the provided context.</div></div>
<div class="ttc" id="agroup__security_html_gabdb38e692dde58bbec4ab905eeb8b3aa"><div class="ttname"><a href="group__security.html#gabdb38e692dde58bbec4ab905eeb8b3aa">SocketTLS_send</a></div><div class="ttdeci">ssize_t SocketTLS_send(Socket_T socket, const void *buf, size_t len)</div><div class="ttdoc">Send data over TLS-encrypted connection.</div></div>
<div class="ttc" id="agroup__security_html_gaea7ca3e656e9b58706fafc3232147203"><div class="ttname"><a href="group__security.html#gaea7ca3e656e9b58706fafc3232147203">SocketTLSContext_free</a></div><div class="ttdeci">void SocketTLSContext_free(SocketTLSContext_T *ctx_p)</div><div class="ttdoc">Dispose of TLS context and resources.</div></div>
<div class="ttc" id="agroup__security_html_gaeaa77dd7852b535baf17b53ee2518454"><div class="ttname"><a href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454">SocketTLS_handshake</a></div><div class="ttdeci">TLSHandshakeState SocketTLS_handshake(Socket_T socket)</div><div class="ttdoc">Perform non-blocking TLS handshake.</div></div>
<div class="ttc" id="agroup__security_html_structSocketTLSContext__T"><div class="ttname"><a href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a></div><div class="ttdoc">TLS context structure for managing OpenSSL SSL_CTX with secure defaults, certificates,...</div><div class="ttdef"><b>Definition</b> <a href="SocketTLS-private_8h_source.html#l00619">SocketTLS-private.h:620</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1104"></a>
API Mapping (OpenSSL -&gt; Socket Library)</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">OpenSSL   </th><th class="markdownTableHeadNone">Socket Library    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_CTX_new()</code>   </td><td class="markdownTableBodyNone"><code>SocketTLSContext_new_client/server()</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_CTX_free()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gaea7ca3e656e9b58706fafc3232147203" title="Dispose of TLS context and resources.">SocketTLSContext_free()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_new()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gab9a8fb788aa1f0d21b5773bc43a48d6f" title="Enable TLS on a socket using the provided context.">SocketTLS_enable()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_set_fd()</code>   </td><td class="markdownTableBodyNone">Automatic    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_set_tlsext_host_name()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#ga15d2c8f4eaea80114bbd2123da025e56" title="Set SNI hostname for client TLS connections.">SocketTLS_set_hostname()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_connect()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454" title="Perform non-blocking TLS handshake.">SocketTLS_handshake()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_accept()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454" title="Perform non-blocking TLS handshake.">SocketTLS_handshake()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_write()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gabdb38e692dde58bbec4ab905eeb8b3aa" title="Send data over TLS-encrypted connection.">SocketTLS_send()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_read()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#ga1c71fc02141cd9e6da4fdf1c88dbbaf3" title="Receive data from TLS-encrypted connection.">SocketTLS_recv()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_shutdown()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gab11506db6f41f31e9fc170b3d0e848f1" title="Perform graceful TLS connection shutdown.">SocketTLS_shutdown()</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SSL_get_version()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#gaef0f67021658d05419f1da479be2957e" title="Get negotiated TLS protocol version.">SocketTLS_get_version()</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>SSL_get_cipher()</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="group__security.html#ga0859f0a6e05840bdc037c3765e22b7b1" title="Get negotiated cipher suite name.">SocketTLS_get_cipher()</a></code>   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md1106"></a>
Common Patterns</h1>
<h2><a class="anchor" id="autotoc_md1107"></a>
Error Handling Pattern</h2>
<p><b>Other Libraries (error codes):</b> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> result = some_function();</div>
<div class="line"><span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line">    <span class="keywordflow">switch</span> (errno) {</div>
<div class="line">        <span class="keywordflow">case</span> ETIMEDOUT: <span class="comment">/* timeout */</span> <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> ECONNREFUSED: <span class="comment">/* refused */</span> <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>: <span class="comment">/* error */</span> <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Socket Library (exceptions):</b> </p><div class="fragment"><div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    some_function();</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(Socket_Timeout) {</div>
<div class="line">    <span class="comment">/* timeout */</span></div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__core__io.html#ga225f4a8fd657fd52a05146c6fc4f58b0">Socket_Failed</a>) {</div>
<div class="line">    <span class="comment">/* error - Socket_GetLastError() for details */</span></div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1108"></a>
Resource Cleanup Pattern</h2>
<p><b>Other Libraries:</b> </p><div class="fragment"><div class="line">Socket *sock = create_socket();</div>
<div class="line"><span class="keywordflow">if</span> (!sock) <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (connect(sock) &lt; 0) <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"><span class="keywordflow">if</span> (send(sock) &lt; 0) <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"> </div>
<div class="line">cleanup:</div>
<div class="line">    <span class="keywordflow">if</span> (sock) free_socket(sock);</div>
</div><!-- fragment --><p><b>Socket Library:</b> </p><div class="fragment"><div class="line">Socket_T sock = NULL;</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    sock = <a class="code hl_function" href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1">Socket_new</a>(AF_INET, SOCK_STREAM, 0);</div>
<div class="line">    <a class="code hl_function" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a>(sock, host, port);</div>
<div class="line">    <a class="code hl_function" href="group__core__io.html#ga6ea9ad33d78c50d327c9677b52849bcb">Socket_sendall</a>(sock, data, len);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#ga0e2a75478cd44f1666a6aca626c5c50b">FINALLY</a> {</div>
<div class="line">    <span class="keywordflow">if</span> (sock) <a class="code hl_function" href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a>(&amp;sock);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
<div class="ttc" id="agroup__foundation_html_ga0e2a75478cd44f1666a6aca626c5c50b"><div class="ttname"><a href="group__foundation.html#ga0e2a75478cd44f1666a6aca626c5c50b">FINALLY</a></div><div class="ttdeci">#define FINALLY</div><div class="ttdoc">Define cleanup code that executes regardless of exceptions.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01326">Except.h:1326</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1110"></a>
Key Differences</h1>
<h2><a class="anchor" id="autotoc_md1111"></a>
Memory Management</h2>
<ul>
<li><b>Arena allocation</b> - Related objects allocated together</li>
<li><b>Automatic cleanup</b> - <a class="el" href="group__foundation.html#ga6842e66018614df08139e67826cf3e0d" title="Dispose of an arena and all its allocations, freeing underlying memory chunks.">Arena_dispose()</a> frees everything</li>
<li><b>No manual free</b> for individual objects in arena</li>
</ul>
<h2><a class="anchor" id="autotoc_md1112"></a>
Error Handling</h2>
<ul>
<li><b>Exceptions</b> instead of error codes</li>
<li><b>Thread-local</b> error messages</li>
<li><b>Detailed context</b> in exceptions</li>
</ul>
<h2><a class="anchor" id="autotoc_md1113"></a>
Thread Safety</h2>
<ul>
<li><b>Instance-based</b> - One instance per thread</li>
<li><b>Thread-local</b> storage for errors</li>
<li><b>No global state</b></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1115"></a>
Getting Started</h1>
<ol type="1">
<li><b>Replace socket creation</b> with <code><a class="el" href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1" title="Create a new socket with specified domain, type, and protocol.">Socket_new()</a></code></li>
<li><b>Wrap operations</b> in TRY/EXCEPT blocks</li>
<li><b>Use convenience functions</b> (sendall, setreuseaddr, etc.)</li>
<li><b>Replace poll/select</b> with <code><a class="el" href="group__poll__private.html#structSocketPoll__T" title="Opaque internal state structure for SocketPoll instance.">SocketPoll_T</a></code></li>
<li><b>Use <a class="el" href="group__http.html#structSocketHTTPClient" title="Main HTTP client instance managing configuration, pool, auth, and state.">SocketHTTPClient</a></b> for HTTP instead of raw sockets</li>
<li><b>Enable TLS</b> with <code><a class="el" href="group__security.html#gab9a8fb788aa1f0d21b5773bc43a48d6f" title="Enable TLS on a socket using the provided context.">SocketTLS_enable()</a></code> for HTTPS</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md1117"></a>
See Also</h1>
<ul>
<li><a class="el" href="http_guide.html">HTTP Guide</a></li>
<li><a class="el" href="websocket_guide.html">WebSocket Guide</a></li>
<li><a class="el" href="security_guide.html">Security Guide</a></li>
<li><a class="el" href="Socket_8h.html">Socket.h</a></li>
<li><a class="el" href="SocketPoll_8h.html">SocketPoll.h</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- GitHub Corner - Waving Octocat -->
<a href="https://github.com/7etsuo/tetsuo-socket" class="github-corner" aria-label="View source on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="m0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
    <path d="m128.3,109.0 C113.8,99.7 119.0,89.4 119.0,89.4 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
    <path d="m115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
  </svg>
</a>
<style>
.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
</style>
<!-- Custom footer for Tetsuo Pulse -->
<div id="nav-path" class="navpath">
  <ul>
    <li class="footer" style="text-align: center; width: 100%;">
       <a href="https://tetsuocorp.com" target="_blank" rel="noopener">Tetsuo Corp</a>
    </li>
  </ul>
</div>
</body>
</html>
