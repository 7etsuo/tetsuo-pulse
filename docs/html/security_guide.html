<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="High-performance, exception-driven socket toolkit for POSIX systems">
<meta name="keywords" content="socket, networking, C, POSIX, TCP, UDP, TLS, async, high-performance, library">
<meta name="author" content="Tetsuo Corporation">
<meta name="theme-color" content="#3b82f6">
<title>Security Guide</title>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="socket-theme.css" rel="stylesheet" type="text/css"/>
<link href="socket-theme.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%233b82f6'/><stop offset='100%25' stop-color='%238b5cf6'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23g)'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white' font-family='sans-serif' font-weight='bold'>S</text></svg>">
</head>
<body>
<div id="top">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Socket Library<span id="projectnumber">1.0.0</span></div>
   <div id="projectbrief">High-performance, exception-driven socket toolkit for POSIX systems</div>
  </td>
  <td style="text-align: right; padding: 20px; vertical-align: middle;">
    <div style="display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap; align-items: center;">
      <a href="index.html" class="quick-link">Home</a>
      <a href="annotated.html" class="quick-link">Structures</a>
      <a href="files.html" class="quick-link">Files</a>
      <a href="globals.html" class="quick-link">API</a>
    </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('security_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Security Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Brief</b>: Security best practices and TLS 1.3 hardening | <b>Tags</b>: <code>security</code>, <code>tls</code>, <code>hardening</code>, <code>certificates</code>, <code>syn-flood</code></p>
<p>Security best practices for applications using the Socket Library.</p>
<p><b>Module Group</b>: Security | <b>Related Modules</b>: SocketTLS, SocketTLSContext, SocketSYNProtect</p>
<hr  />
<h1><a class="anchor" id="autotoc_md1032"></a>
TLS 1.3 Configuration</h1>
<p>The library enforces TLS 1.3 as the minimum protocol version for maximum security.</p>
<h2><a class="anchor" id="autotoc_md1033"></a>
Default Configuration</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketTLSContext_8h.html">tls/SocketTLSContext.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Client context with system CA certificates */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx = <a class="code hl_function" href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a>(NULL);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Server context with certificate */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx = <a class="code hl_function" href="group__security.html#ga79a403f2f54f21c90a92e9cb73e24cbc">SocketTLSContext_new_server</a>(</div>
<div class="line">    <span class="stringliteral">&quot;/path/to/cert.pem&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;/path/to/key.pem&quot;</span></div>
<div class="line">);</div>
<div class="ttc" id="aSocketTLSContext_8h_html"><div class="ttname"><a href="SocketTLSContext_8h.html">SocketTLSContext.h</a></div><div class="ttdoc">TLS context management with secure defaults and certificate handling.</div></div>
<div class="ttc" id="agroup__security_html_ga79a403f2f54f21c90a92e9cb73e24cbc"><div class="ttname"><a href="group__security.html#ga79a403f2f54f21c90a92e9cb73e24cbc">SocketTLSContext_new_server</a></div><div class="ttdeci">SocketTLSContext_T SocketTLSContext_new_server(const char *cert_file, const char *key_file, const char *ca_file)</div><div class="ttdoc">Create server TLS context with cert/key.</div></div>
<div class="ttc" id="agroup__security_html_ga7fe51da14439d768bdf72f4ed8fbb022"><div class="ttname"><a href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a></div><div class="ttdeci">SocketTLSContext_T SocketTLSContext_new_client(const char *ca_file)</div><div class="ttdoc">Create client TLS context.</div></div>
<div class="ttc" id="agroup__security_html_structSocketTLSContext__T"><div class="ttname"><a href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a></div><div class="ttdoc">TLS context structure for managing OpenSSL SSL_CTX with secure defaults, certificates,...</div><div class="ttdef"><b>Definition</b> <a href="SocketTLS-private_8h_source.html#l00678">SocketTLS-private.h:679</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1034"></a>
TLS Settings (SocketTLSConfig.h)</h2>
<div class="fragment"><div class="line"><span class="comment">/* Minimum: TLS 1.3 only (no TLS 1.2 or below) */</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS_MIN_VERSION TLS1_3_VERSION</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS_MAX_VERSION TLS1_3_VERSION</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Modern cipher suites with Perfect Forward Secrecy */</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS13_CIPHERSUITES \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_AES_256_GCM_SHA384:&quot;     \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_CHACHA20_POLY1305_SHA256:&quot; \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_AES_128_GCM_SHA256&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1035"></a>
Why TLS 1.3?</h2>
<ul>
<li><b>No legacy algorithms</b> - Only modern, secure ciphers</li>
<li><b>Faster handshakes</b> - 1-RTT, optional 0-RTT</li>
<li><b>Perfect Forward Secrecy</b> - Ephemeral keys always used</li>
<li><b>Encrypted certificates</b> - Better privacy</li>
<li><b>Simplified protocol</b> - Smaller attack surface</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1037"></a>
Certificate Transparency (CT)</h1>
<p>Certificate Transparency (RFC 6962) provides an auditable public log of certificates issued by CAs. The library supports CT verification for TLS clients to detect mis-issued or undetected certificates.</p>
<h2><a class="anchor" id="autotoc_md1038"></a>
Usage</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx = <a class="code hl_function" href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a>(<span class="stringliteral">&quot;ca-bundle.pem&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Enable strict CT validation (fail if no valid SCTs) */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gaf27bede9402c6c8c7541143e019c635f">SocketTLSContext_enable_ct</a>(ctx, <a class="code hl_enumvalue" href="group__security.html#gga4d930163393a67950a5378e540c0e939a102a7857300a9c88684ed50efe69d3ab">CT_VALIDATION_STRICT</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Or permissive (log but continue on missing/invalid SCTs) */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gaf27bede9402c6c8c7541143e019c635f">SocketTLSContext_enable_ct</a>(ctx, <a class="code hl_enumvalue" href="group__security.html#gga4d930163393a67950a5378e540c0e939aea499abb40ae318f0fd2b596ce6cbaa8">CT_VALIDATION_PERMISSIVE</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Load custom trusted CT log list (overrides OpenSSL defaults) */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gada967caf61c070399281b088b35ed78a">SocketTLSContext_set_ctlog_list_file</a>(ctx, <span class="stringliteral">&quot;/path/to/ctlogs.txt&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Query status */</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="group__security.html#ga3b70029e86352f55e3710673ba30c23f">SocketTLSContext_ct_enabled</a>(ctx)) {</div>
<div class="line">  <a class="code hl_enumeration" href="group__security.html#ga4d930163393a67950a5378e540c0e939">CTValidationMode</a> mode = <a class="code hl_function" href="group__security.html#gaf18e867664012c78a758c5454f62c367">SocketTLSContext_get_ct_mode</a>(ctx);</div>
<div class="line">  <span class="comment">// mode == CT_VALIDATION_STRICT or PERMISSIVE</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__security_html_ga3b70029e86352f55e3710673ba30c23f"><div class="ttname"><a href="group__security.html#ga3b70029e86352f55e3710673ba30c23f">SocketTLSContext_ct_enabled</a></div><div class="ttdeci">int SocketTLSContext_ct_enabled(SocketTLSContext_T ctx)</div><div class="ttdoc">Check if CT verification is enabled.</div></div>
<div class="ttc" id="agroup__security_html_ga4d930163393a67950a5378e540c0e939"><div class="ttname"><a href="group__security.html#ga4d930163393a67950a5378e540c0e939">CTValidationMode</a></div><div class="ttdeci">CTValidationMode</div><div class="ttdoc">Certificate Transparency validation mode enumeration.</div><div class="ttdef"><b>Definition</b> <a href="SocketTLSContext_8h_source.html#l01159">SocketTLSContext.h:1160</a></div></div>
<div class="ttc" id="agroup__security_html_gada967caf61c070399281b088b35ed78a"><div class="ttname"><a href="group__security.html#gada967caf61c070399281b088b35ed78a">SocketTLSContext_set_ctlog_list_file</a></div><div class="ttdeci">void SocketTLSContext_set_ctlog_list_file(SocketTLSContext_T ctx, const char *log_file)</div><div class="ttdoc">Load custom CT log list.</div></div>
<div class="ttc" id="agroup__security_html_gaf18e867664012c78a758c5454f62c367"><div class="ttname"><a href="group__security.html#gaf18e867664012c78a758c5454f62c367">SocketTLSContext_get_ct_mode</a></div><div class="ttdeci">CTValidationMode SocketTLSContext_get_ct_mode(SocketTLSContext_T ctx)</div><div class="ttdoc">Get current CT validation mode.</div></div>
<div class="ttc" id="agroup__security_html_gaf27bede9402c6c8c7541143e019c635f"><div class="ttname"><a href="group__security.html#gaf27bede9402c6c8c7541143e019c635f">SocketTLSContext_enable_ct</a></div><div class="ttdeci">void SocketTLSContext_enable_ct(SocketTLSContext_T ctx, CTValidationMode mode)</div><div class="ttdoc">Enable Certificate Transparency verification.</div></div>
<div class="ttc" id="agroup__security_html_gga4d930163393a67950a5378e540c0e939a102a7857300a9c88684ed50efe69d3ab"><div class="ttname"><a href="group__security.html#gga4d930163393a67950a5378e540c0e939a102a7857300a9c88684ed50efe69d3ab">CT_VALIDATION_STRICT</a></div><div class="ttdeci">@ CT_VALIDATION_STRICT</div><div class="ttdef"><b>Definition</b> <a href="SocketTLSContext_8h_source.html#l01163">SocketTLSContext.h:1162</a></div></div>
<div class="ttc" id="agroup__security_html_gga4d930163393a67950a5378e540c0e939aea499abb40ae318f0fd2b596ce6cbaa8"><div class="ttname"><a href="group__security.html#gga4d930163393a67950a5378e540c0e939aea499abb40ae318f0fd2b596ce6cbaa8">CT_VALIDATION_PERMISSIVE</a></div><div class="ttdeci">@ CT_VALIDATION_PERMISSIVE</div><div class="ttdef"><b>Definition</b> <a href="SocketTLSContext_8h_source.html#l01161">SocketTLSContext.h:1161</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1039"></a>
Security Benefits</h2>
<ul>
<li><b>Mis-issuance Detection</b>: SCTs (Signed Certificate Timestamps) must be obtained from public logs before cert issuance.</li>
<li><b>CA Accountability</b>: Monitors CA behavior through public audits.</li>
<li><b>Integration</b>: Works with CRL/OCSP for full revocation/CT coverage. Errors reflected in <code>SocketTLS_get_verify_result</code>.</li>
<li><b>Modes</b>:<ul>
<li><b>Strict</b>: Handshake fails without valid SCTs (recommended for high-security).</li>
<li><b>Permissive</b>: Logs issues (via OpenSSL error queue) but allows connection.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md1040"></a>
Requirements</h2>
<ul>
<li>OpenSSL 1.1.0+ with CT support (<code>SOCKET_HAS_CT_SUPPORT</code>).</li>
<li>Client-only (server contexts raise <code>SocketTLS_Failed</code>).</li>
</ul>
<h2><a class="anchor" id="autotoc_md1041"></a>
Custom Logs</h2>
<p>OpenSSL uses built-in log list (Google, etc.). For custom (e.g., enterprise logs), provide a file with log descriptors (see OpenSSL <code>CTLOG_STORE_load_file</code> format). Validate paths with library checks (no traversal, length limits).</p>
<h2><a class="anchor" id="autotoc_md1042"></a>
Verification</h2>
<ul>
<li>SCTs validated during cert chain check.</li>
<li>Missing/invalid SCTs: <code>X509_V_ERR_NO_VALID_SCTS</code> or similar in verify result.</li>
<li>Test: Use <code>openssl s_client -ct</code> or library tests (<code>ctest -R tls_ct</code>).</li>
</ul>
<h2><a class="anchor" id="autotoc_md1043"></a>
Limits</h2>
<ul>
<li><code>SOCKET_TLS_MAX_SCT_LEN</code>: Max SCT size (config).</li>
<li>Chain depth (<code>SOCKET_TLS_MAX_CERT_CHAIN_DEPTH</code>) applies to SCT-embedded certs.</li>
</ul>
<p>Combine with pinning (<code>SocketTLSContext_add_pin_*</code>) for defense-in-depth.</p>
<h1><a class="anchor" id="autotoc_md1044"></a>
Certificate Pinning</h1>
<p>Pin expected certificates to prevent MITM attacks:</p>
<h2><a class="anchor" id="autotoc_md1045"></a>
SPKI SHA256 Pinning</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketTLSContext_8h.html">tls/SocketTLSContext.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Get pin from certificate */</span></div>
<div class="line"><span class="comment">/* openssl x509 -in cert.pem -pubkey -noout | \</span></div>
<div class="line"><span class="comment">   openssl pkey -pubin -outform DER | \</span></div>
<div class="line"><span class="comment">   openssl dgst -sha256 -binary | base64 */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *pin = <span class="stringliteral">&quot;sha256//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Pin certificate */</span></div>
<div class="line"><span class="keywordflow">if</span> (SocketTLSContext_pin_certificate(ctx, pin) &lt; 0) {</div>
<div class="line">    <span class="comment">/* Invalid pin format */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Add backup pin */</span></div>
<div class="line">SocketTLSContext_pin_certificate(ctx, backup_pin);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1046"></a>
When to Use Pinning</h2>
<ul>
<li><b>Mobile apps</b> connecting to known servers</li>
<li><b>IoT devices</b> with fixed backend</li>
<li><b>High-security</b> applications</li>
<li><b>Certificate transparency</b> not sufficient</li>
</ul>
<h2><a class="anchor" id="autotoc_md1047"></a>
Pin Rotation</h2>
<p>Always include at least one backup pin for certificate rotation:</p>
<div class="fragment"><div class="line"><span class="comment">/* Current certificate */</span></div>
<div class="line">SocketTLSContext_pin_certificate(ctx, current_pin);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Backup/next certificate */</span></div>
<div class="line">SocketTLSContext_pin_certificate(ctx, backup_pin);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1049"></a>
Input Validation</h1>
<h2><a class="anchor" id="autotoc_md1050"></a>
Hostname Validation</h2>
<div class="fragment"><div class="line"><span class="comment">/* Always validate hostnames before use */</span></div>
<div class="line"><span class="preprocessor">#define MAX_HOSTNAME_LEN 253</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (hostname == NULL || strlen(hostname) &gt; MAX_HOSTNAME_LEN) {</div>
<div class="line">    <span class="comment">/* Reject invalid hostname */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Check for null bytes (injection) */</span></div>
<div class="line"><span class="keywordflow">if</span> (strlen(hostname) != strnlen(hostname, MAX_HOSTNAME_LEN + 1)) {</div>
<div class="line">    <span class="comment">/* Contains embedded null */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1051"></a>
Port Validation</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define SOCKET_VALID_PORT(p) ((int)(p) &gt; 0 &amp;&amp; (int)(p) &lt;= 65535)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_define" href="group__foundation.html#ga79772cb715462c6705db6d9440786f2d">SOCKET_VALID_PORT</a>(port)) {</div>
<div class="line">    <span class="comment">/* Invalid port */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__foundation_html_ga79772cb715462c6705db6d9440786f2d"><div class="ttname"><a href="group__foundation.html#ga79772cb715462c6705db6d9440786f2d">SOCKET_VALID_PORT</a></div><div class="ttdeci">#define SOCKET_VALID_PORT(p)</div><div class="ttdoc">Port number validation macro.</div><div class="ttdef"><b>Definition</b> <a href="SocketConfig_8h_source.html#l02623">SocketConfig.h:2623</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1052"></a>
Buffer Size Validation</h2>
<div class="fragment"><div class="line"><span class="comment">/* Always check for overflow */</span></div>
<div class="line"><span class="keywordflow">if</span> (size &gt; SIZE_MAX / 2) {</div>
<div class="line">    <span class="comment">/* Too large - would overflow */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Use library macros */</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_VALID_BUFFER_SIZE(s) \</span></div>
<div class="line"><span class="preprocessor">    ((size_t)(s) &gt;= SOCKET_MIN_BUFFER_SIZE &amp;&amp; \</span></div>
<div class="line"><span class="preprocessor">     (size_t)(s) &lt;= SOCKET_MAX_BUFFER_SIZE)</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1054"></a>
DNS Security</h1>
<h2><a class="anchor" id="autotoc_md1055"></a>
Blocking DNS Warning</h2>
<p>DNS resolution via <code><a class="el" href="group__core__io.html#gacb65d693d8c93e2a1fe6411dd0d0af98" title="Bind a socket to a local IP address and port.">Socket_bind()</a></code> and <code><a class="el" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e" title="Establish a connection to a remote host and port.">Socket_connect()</a></code> may block:</p>
<div class="fragment"><div class="line"><span class="comment">/* WARNING: May block for 30+ seconds on DNS timeout */</span></div>
<div class="line"><a class="code hl_function" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a>(sock, <span class="stringliteral">&quot;hostname.example.com&quot;</span>, 80);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* For non-blocking, resolve separately */</span></div>
<div class="line"><a class="code hl_struct" href="group__dns.html#structSocketDNS__T">SocketDNS_T</a> dns = <a class="code hl_function" href="group__dns.html#ga799f4d96c77eef54ecb9be5523b591fd">SocketDNS_new</a>();</div>
<div class="line"><a class="code hl_struct" href="group__dns.html#structSocketDNS__Request__T">SocketDNS_Request_T</a> req = <a class="code hl_function" href="group__dns.html#ga380629d9c1650963341d1fe1dacd3253">SocketDNS_resolve</a>(dns, hostname, port, NULL, NULL);</div>
<div class="line"><span class="comment">/* Poll for completion */</span></div>
<div class="ttc" id="agroup__core__io_html_gac14390090ee26136c1f7a816fc08406e"><div class="ttname"><a href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a></div><div class="ttdeci">void Socket_connect(Socket_T socket, const char *host, int port)</div><div class="ttdoc">Establish a connection to a remote host and port.</div></div>
<div class="ttc" id="agroup__dns_html_ga380629d9c1650963341d1fe1dacd3253"><div class="ttname"><a href="group__dns.html#ga380629d9c1650963341d1fe1dacd3253">SocketDNS_resolve</a></div><div class="ttdeci">Request_T SocketDNS_resolve(SocketDNS_T dns, const char *host, int port, SocketDNS_Callback callback, void *data)</div><div class="ttdoc">Start asynchronous DNS resolution.</div></div>
<div class="ttc" id="agroup__dns_html_ga799f4d96c77eef54ecb9be5523b591fd"><div class="ttname"><a href="group__dns.html#ga799f4d96c77eef54ecb9be5523b591fd">SocketDNS_new</a></div><div class="ttdeci">SocketDNS_T SocketDNS_new(void)</div><div class="ttdoc">Create a new asynchronous DNS resolver.</div></div>
<div class="ttc" id="agroup__dns_html_structSocketDNS__Request__T"><div class="ttname"><a href="group__dns.html#structSocketDNS__Request__T">SocketDNS_Request_T</a></div><div class="ttdoc">DNS resolution request structure.</div><div class="ttdef"><b>Definition</b> <a href="SocketDNS-private_8h_source.html#l00189">SocketDNS-private.h:190</a></div></div>
<div class="ttc" id="agroup__dns_html_structSocketDNS__T"><div class="ttname"><a href="group__dns.html#structSocketDNS__T">SocketDNS_T</a></div><div class="ttdoc">Async DNS resolver structure.</div><div class="ttdef"><b>Definition</b> <a href="SocketDNS-private_8h_source.html#l00221">SocketDNS-private.h:222</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1056"></a>
DNS DoS Prevention</h2>
<p>Never use untrusted hostnames directly:</p>
<div class="fragment"><div class="line"><span class="comment">/* BAD - attacker can cause 30+ second block */</span></div>
<div class="line"><a class="code hl_function" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a>(sock, user_provided_hostname, port);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* BETTER - use async DNS with timeout */</span></div>
<div class="line"><a class="code hl_function" href="group__dns.html#ga9b27f46a350b3cfaf9a1092d94f81dd9">SocketDNS_request_settimeout</a>(req, 5000);  <span class="comment">/* 5 second limit */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* BEST - validate and use IP addresses */</span></div>
<div class="line"><span class="keywordflow">if</span> (inet_pton(AF_INET, user_input, &amp;<a class="code hl_variable" href="group__async__io.html#gabf6dc3901a5139f2f7f093db3003b798">addr</a>) &gt; 0) {</div>
<div class="line">    <a class="code hl_function" href="group__core__io.html#gac14390090ee26136c1f7a816fc08406e">Socket_connect</a>(sock, user_input, port);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__async__io_html_gabf6dc3901a5139f2f7f093db3003b798"><div class="ttname"><a href="group__async__io.html#gabf6dc3901a5139f2f7f093db3003b798">addr</a></div><div class="ttdeci">struct addrinfo * addr</div><div class="ttdoc">Single connection attempt structure in Happy Eyeballs racing.</div><div class="ttdef"><b>Definition</b> <a href="SocketHappyEyeballs-private_8h_source.html#l00150">SocketHappyEyeballs-private.h:150</a></div></div>
<div class="ttc" id="agroup__dns_html_ga9b27f46a350b3cfaf9a1092d94f81dd9"><div class="ttname"><a href="group__dns.html#ga9b27f46a350b3cfaf9a1092d94f81dd9">SocketDNS_request_settimeout</a></div><div class="ttdeci">void SocketDNS_request_settimeout(SocketDNS_T dns, Request_T req, int timeout_ms)</div><div class="ttdoc">Override timeout for specific request.</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1058"></a>
Credential Handling</h1>
<h2><a class="anchor" id="autotoc_md1059"></a>
Secure Memory Clearing</h2>
<p>Always clear sensitive data after use:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketCrypto_8h.html">core/SocketCrypto.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> password[256];</div>
<div class="line"><span class="comment">/* ... use password ... */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Clear from memory (won&#39;t be optimized away) */</span></div>
<div class="line"><a class="code hl_function" href="group__foundation.html#ga00f94677d393f24e0b0c549be7bbcdf2">SocketCrypto_secure_clear</a>(password, <span class="keyword">sizeof</span>(password));</div>
<div class="ttc" id="aSocketCrypto_8h_html"><div class="ttname"><a href="SocketCrypto_8h.html">SocketCrypto.h</a></div><div class="ttdoc">Cryptographic utility functions for secure operations.</div></div>
<div class="ttc" id="agroup__foundation_html_ga00f94677d393f24e0b0c549be7bbcdf2"><div class="ttname"><a href="group__foundation.html#ga00f94677d393f24e0b0c549be7bbcdf2">SocketCrypto_secure_clear</a></div><div class="ttdeci">void SocketCrypto_secure_clear(void *ptr, size_t len)</div><div class="ttdoc">Securely clear sensitive data from memory.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1060"></a>
The Library Does This Internally</h2>
<ul>
<li>Proxy credentials cleared after handshake</li>
<li>TLS session keys cleared on close</li>
<li>HTTP auth tokens cleared after use</li>
</ul>
<h2><a class="anchor" id="autotoc_md1061"></a>
Constant-Time Comparison</h2>
<p>Prevent timing attacks when comparing secrets:</p>
<div class="fragment"><div class="line"><span class="comment">/* BAD - timing leak */</span></div>
<div class="line"><span class="keywordflow">if</span> (strcmp(provided_token, expected_token) == 0) { }</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* GOOD - constant time */</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="group__foundation.html#gae5f9b65e71620529159130c81b6d0dba">SocketCrypto_secure_compare</a>(provided, expected, len) == 0) {</div>
<div class="line">    <span class="comment">/* Match */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__foundation_html_gae5f9b65e71620529159130c81b6d0dba"><div class="ttname"><a href="group__foundation.html#gae5f9b65e71620529159130c81b6d0dba">SocketCrypto_secure_compare</a></div><div class="ttdeci">int SocketCrypto_secure_compare(const void *a, const void *b, size_t len)</div><div class="ttdoc">Perform constant-time comparison of two buffers.</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1063"></a>
DoS Protection</h1>
<h2><a class="anchor" id="autotoc_md1064"></a>
SYN Flood Protection</h2>
<p>For servers accepting many connections:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketSYNProtect_8h.html">core/SocketSYNProtect.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Create protection instance */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketSYNProtect__T">SocketSYNProtect_T</a> protect = <a class="code hl_function" href="group__security.html#ga5f5d6f2ac8cbd366d57c1e8e55983143">SocketSYNProtect_new</a>(arena);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Configure thresholds */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketSYNProtect__Config">SocketSYNProtect_Config</a> config = {</div>
<div class="line">    .max_syn_per_second = 100,</div>
<div class="line">    .max_half_open = 1000,</div>
<div class="line">    .challenge_after = 50</div>
<div class="line">};</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga59e979862677789482cb5f297f544001">SocketSYNProtect_configure</a>(protect, &amp;config);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Check before accept */</span></div>
<div class="line">SocketSYNProtect_Action action = <a class="code hl_function" href="group__security.html#ga45b12919783a7ba4426db4134fda1a5f">SocketSYNProtect_check</a>(protect, client_addr);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">switch</span> (action) {</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9ab7af7c3605f188d109f9528dd72a7af8">SYN_ACTION_ALLOW</a>:</div>
<div class="line">    <span class="comment">/* Accept normally */</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9a57b3e54beba358c83e8a91f2136d61d9">SYN_ACTION_THROTTLE</a>:</div>
<div class="line">    <span class="comment">/* Accept with delay */</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9a47e6cde53adccac1b4948afbc22b16d1">SYN_ACTION_CHALLENGE</a>:</div>
<div class="line">    <span class="comment">/* Require proof of work or additional validation */</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9aefd772a5165c7769765f8008396893fa">SYN_ACTION_BLOCK</a>:</div>
<div class="line">    <span class="comment">/* Reject connection */</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aSocketSYNProtect_8h_html"><div class="ttname"><a href="SocketSYNProtect_8h.html">SocketSYNProtect.h</a></div><div class="ttdoc">SYN flood protection using IP reputation and adaptive rate limiting.</div></div>
<div class="ttc" id="agroup__security_html_ga45b12919783a7ba4426db4134fda1a5f"><div class="ttname"><a href="group__security.html#ga45b12919783a7ba4426db4134fda1a5f">SocketSYNProtect_check</a></div><div class="ttdeci">SocketSYN_Action SocketSYNProtect_check(SocketSYNProtect_T protect, const char *client_ip, SocketSYN_IPState *state_out)</div><div class="ttdoc">Evaluate client IP and determine protection action.</div></div>
<div class="ttc" id="agroup__security_html_ga59e979862677789482cb5f297f544001"><div class="ttname"><a href="group__security.html#ga59e979862677789482cb5f297f544001">SocketSYNProtect_configure</a></div><div class="ttdeci">void SocketSYNProtect_configure(SocketSYNProtect_T protect, const SocketSYNProtect_Config *config)</div><div class="ttdoc">Update protection configuration during runtime.</div></div>
<div class="ttc" id="agroup__security_html_ga5f5d6f2ac8cbd366d57c1e8e55983143"><div class="ttname"><a href="group__security.html#ga5f5d6f2ac8cbd366d57c1e8e55983143">SocketSYNProtect_new</a></div><div class="ttdeci">SocketSYNProtect_T SocketSYNProtect_new(Arena_T arena, const SocketSYNProtect_Config *config)</div><div class="ttdoc">Create a new instance of SYN protection.</div></div>
<div class="ttc" id="agroup__security_html_ggaca8f2a71ab649ccd408fd3fdb3b693b9a47e6cde53adccac1b4948afbc22b16d1"><div class="ttname"><a href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9a47e6cde53adccac1b4948afbc22b16d1">SYN_ACTION_CHALLENGE</a></div><div class="ttdeci">@ SYN_ACTION_CHALLENGE</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect_8h_source.html#l00195">SocketSYNProtect.h:195</a></div></div>
<div class="ttc" id="agroup__security_html_ggaca8f2a71ab649ccd408fd3fdb3b693b9a57b3e54beba358c83e8a91f2136d61d9"><div class="ttname"><a href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9a57b3e54beba358c83e8a91f2136d61d9">SYN_ACTION_THROTTLE</a></div><div class="ttdeci">@ SYN_ACTION_THROTTLE</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect_8h_source.html#l00194">SocketSYNProtect.h:194</a></div></div>
<div class="ttc" id="agroup__security_html_ggaca8f2a71ab649ccd408fd3fdb3b693b9ab7af7c3605f188d109f9528dd72a7af8"><div class="ttname"><a href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9ab7af7c3605f188d109f9528dd72a7af8">SYN_ACTION_ALLOW</a></div><div class="ttdeci">@ SYN_ACTION_ALLOW</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect_8h_source.html#l00193">SocketSYNProtect.h:193</a></div></div>
<div class="ttc" id="agroup__security_html_ggaca8f2a71ab649ccd408fd3fdb3b693b9aefd772a5165c7769765f8008396893fa"><div class="ttname"><a href="group__security.html#ggaca8f2a71ab649ccd408fd3fdb3b693b9aefd772a5165c7769765f8008396893fa">SYN_ACTION_BLOCK</a></div><div class="ttdeci">@ SYN_ACTION_BLOCK</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect_8h_source.html#l00197">SocketSYNProtect.h:196</a></div></div>
<div class="ttc" id="agroup__security_html_structSocketSYNProtect__Config"><div class="ttname"><a href="group__security.html#structSocketSYNProtect__Config">SocketSYNProtect_Config</a></div><div class="ttdoc">Configuration parameters for SYN flood protection.</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect_8h_source.html#l00271">SocketSYNProtect.h:272</a></div></div>
<div class="ttc" id="agroup__security_html_structSocketSYNProtect__T"><div class="ttname"><a href="group__security.html#structSocketSYNProtect__T">SocketSYNProtect_T</a></div><div class="ttdoc">Core internal structure for the SYN protection module.</div><div class="ttdef"><b>Definition</b> <a href="SocketSYNProtect-private_8h_source.html#l00215">SocketSYNProtect-private.h:216</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1065"></a>
Rate Limiting</h2>
<p>Limit connection/request rates:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketRateLimit_8h.html">core/SocketRateLimit.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Create token bucket */</span></div>
<div class="line"><a class="code hl_struct" href="group__utilities.html#structSocketRateLimit__T">SocketRateLimit_T</a> limiter = <a class="code hl_function" href="group__utilities.html#ga984414b5ee576c6acb3fbd9e8a96ef0f">SocketRateLimit_new</a>(</div>
<div class="line">    100.0,   <span class="comment">/* 100 tokens per second */</span></div>
<div class="line">    1000     <span class="comment">/* Burst of 1000 */</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Try to acquire token */</span></div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code hl_function" href="group__utilities.html#gabb5d1321362b759ed688cfc414c4b2a7">SocketRateLimit_try_acquire</a>(limiter, 1)) {</div>
<div class="line">    <span class="comment">/* Rate limited - reject or delay */</span></div>
<div class="line">}</div>
<div class="ttc" id="aSocketRateLimit_8h_html"><div class="ttname"><a href="SocketRateLimit_8h.html">SocketRateLimit.h</a></div><div class="ttdoc">Token bucket rate limiter for controlling operation rates.</div></div>
<div class="ttc" id="agroup__utilities_html_ga984414b5ee576c6acb3fbd9e8a96ef0f"><div class="ttname"><a href="group__utilities.html#ga984414b5ee576c6acb3fbd9e8a96ef0f">SocketRateLimit_new</a></div><div class="ttdeci">SocketRateLimit_T SocketRateLimit_new(Arena_T arena, size_t tokens_per_sec, size_t bucket_size)</div><div class="ttdoc">Create a new token bucket rate limiter.</div></div>
<div class="ttc" id="agroup__utilities_html_gabb5d1321362b759ed688cfc414c4b2a7"><div class="ttname"><a href="group__utilities.html#gabb5d1321362b759ed688cfc414c4b2a7">SocketRateLimit_try_acquire</a></div><div class="ttdeci">int SocketRateLimit_try_acquire(SocketRateLimit_T limiter, size_t tokens)</div><div class="ttdoc">Non-blocking attempt to acquire and consume tokens.</div></div>
<div class="ttc" id="agroup__utilities_html_structSocketRateLimit__T"><div class="ttname"><a href="group__utilities.html#structSocketRateLimit__T">SocketRateLimit_T</a></div><div class="ttdoc">Internal structure implementing the token bucket rate limiter.</div><div class="ttdef"><b>Definition</b> <a href="SocketRateLimit-private_8h_source.html#l00126">SocketRateLimit-private.h:127</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1066"></a>
Per-IP Connection Limits</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="SocketIPTracker_8h.html">core/SocketIPTracker.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group__ip__tracker.html#ga763b573474982e2761d5b7fbdf9155fc">SocketIPTracker_T</a> tracker = <a class="code hl_function" href="group__security.html#gab87cad57ddf1ed19226cf8535456bbde">SocketIPTracker_new</a>(arena);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Before accepting */</span></div>
<div class="line"><span class="keywordflow">if</span> (SocketIPTracker_get_count(tracker, client_addr) &gt;= MAX_PER_IP) {</div>
<div class="line">    <span class="comment">/* Too many connections from this IP */</span></div>
<div class="line">    close(client_fd);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">SocketIPTracker_increment(tracker, client_addr);</div>
<div class="ttc" id="aSocketIPTracker_8h_html"><div class="ttname"><a href="SocketIPTracker_8h.html">SocketIPTracker.h</a></div><div class="ttdoc">Header for IP connection tracker module.</div></div>
<div class="ttc" id="agroup__ip__tracker_html_ga763b573474982e2761d5b7fbdf9155fc"><div class="ttname"><a href="group__ip__tracker.html#ga763b573474982e2761d5b7fbdf9155fc">SocketIPTracker_T</a></div><div class="ttdeci">struct SocketIPTracker_T * SocketIPTracker_T</div><div class="ttdef"><b>Definition</b> <a href="SocketIPTracker_8h_source.html#l00199">SocketIPTracker.h:199</a></div></div>
<div class="ttc" id="agroup__security_html_gab87cad57ddf1ed19226cf8535456bbde"><div class="ttname"><a href="group__security.html#gab87cad57ddf1ed19226cf8535456bbde">SocketIPTracker_new</a></div><div class="ttdeci">SocketIPTracker_T SocketIPTracker_new(Arena_T arena, int max_per_ip)</div><div class="ttdoc">Create and initialize a new IP connection tracker instance.</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1068"></a>
Thread Safety</h1>
<h2><a class="anchor" id="autotoc_md1069"></a>
Thread-Local Error Buffers</h2>
<p>Error messages use thread-local storage:</p>
<div class="fragment"><div class="line"><span class="comment">/* Safe - each thread has own buffer */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_variable" href="SocketHappyEyeballs-private_8h.html#a11614f44ef4d939bdd984953346a7572">error</a> = <a class="code hl_function" href="group__foundation.html#gac71a25566cdc9e11eaecb16c966081db">Socket_GetLastError</a>();</div>
<div class="ttc" id="aSocketHappyEyeballs-private_8h_html_a11614f44ef4d939bdd984953346a7572"><div class="ttname"><a href="SocketHappyEyeballs-private_8h.html#a11614f44ef4d939bdd984953346a7572">error</a></div><div class="ttdeci">int error</div><div class="ttdef"><b>Definition</b> <a href="SocketHappyEyeballs-private_8h_source.html#l00152">SocketHappyEyeballs-private.h:152</a></div></div>
<div class="ttc" id="agroup__foundation_html_gac71a25566cdc9e11eaecb16c966081db"><div class="ttname"><a href="group__foundation.html#gac71a25566cdc9e11eaecb16c966081db">Socket_GetLastError</a></div><div class="ttdeci">const char * Socket_GetLastError(void)</div><div class="ttdoc">Socket_GetLastError - Retrieve the most recent formatted error message.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1070"></a>
Exception Thread Safety</h2>
<p>The library uses thread-local exception copies:</p>
<div class="fragment"><div class="line"><span class="comment">/* Internal: Thread-safe exception pattern */</span></div>
<div class="line"><span class="keyword">static</span> __thread <a class="code hl_struct" href="group__foundation.html#structExcept__T">Except_T</a> Module_DetailedException;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define RAISE_MODULE_ERROR(exception)                \</span></div>
<div class="line"><span class="preprocessor">    do {                                             \</span></div>
<div class="line"><span class="preprocessor">        Module_DetailedException = (exception);      \</span></div>
<div class="line"><span class="preprocessor">        Module_DetailedException.reason = error_buf; \</span></div>
<div class="line"><span class="preprocessor">        RAISE(Module_DetailedException);             \</span></div>
<div class="line"><span class="preprocessor">    } while (0)</span></div>
<div class="ttc" id="agroup__foundation_html_structExcept__T"><div class="ttname"><a href="group__foundation.html#structExcept__T">Except_T</a></div><div class="ttdoc">Exception structure for structured error handling.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l00204">Except.h:205</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1071"></a>
What's NOT Thread-Safe</h2>
<ul>
<li><code>Socket_T</code> instances - one socket per thread</li>
<li><code>SocketWS_T</code> instances - one WebSocket per thread</li>
<li><code>SocketHTTPClient_T</code> - use one per thread</li>
<li><code>SocketPoll_T</code> - one event loop per thread</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1073"></a>
Exception Handling</h1>
<h2><a class="anchor" id="autotoc_md1074"></a>
Always Handle Security Exceptions</h2>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    <a class="code hl_function" href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454">SocketTLS_handshake</a>(sock);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__security.html#ga82be75dd764021fb64cd6824768e2254">SocketTLS_HandshakeFailed</a>) {</div>
<div class="line">    <span class="comment">/* TLS negotiation failed - don&#39;t continue */</span></div>
<div class="line">    log_security_event(<span class="stringliteral">&quot;TLS handshake failed&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__security.html#gabe406e483a861198db5bca58300f1728">SocketTLS_VerifyFailed</a>) {</div>
<div class="line">    <span class="comment">/* Certificate invalid - potential MITM */</span></div>
<div class="line">    log_security_event(<span class="stringliteral">&quot;Certificate verification failed&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
<div class="ttc" id="agroup__foundation_html_gab5e72fc2bd41014c75e0ace4feabfe8e"><div class="ttname"><a href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a></div><div class="ttdeci">#define EXCEPT(e)</div><div class="ttdoc">Catch a specific exception type within a TRY block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01035">Except.h:1035</a></div></div>
<div class="ttc" id="agroup__foundation_html_gad2746371528bdf15c3910b7bf217dac0"><div class="ttname"><a href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a></div><div class="ttdeci">#define TRY</div><div class="ttdoc">Start a TRY/EXCEPT/FINALLY exception handling block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l00927">Except.h:927</a></div></div>
<div class="ttc" id="agroup__foundation_html_gae6628ac788ad213363b89dba9868420b"><div class="ttname"><a href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a></div><div class="ttdeci">#define END_TRY</div><div class="ttdoc">Complete a TRY/EXCEPT/FINALLY exception handling block.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01358">Except.h:1358</a></div></div>
<div class="ttc" id="agroup__security_html_ga82be75dd764021fb64cd6824768e2254"><div class="ttname"><a href="group__security.html#ga82be75dd764021fb64cd6824768e2254">SocketTLS_HandshakeFailed</a></div><div class="ttdeci">const Except_T SocketTLS_HandshakeFailed</div><div class="ttdoc">TLS handshake could not complete.</div></div>
<div class="ttc" id="agroup__security_html_gabe406e483a861198db5bca58300f1728"><div class="ttname"><a href="group__security.html#gabe406e483a861198db5bca58300f1728">SocketTLS_VerifyFailed</a></div><div class="ttdeci">const Except_T SocketTLS_VerifyFailed</div><div class="ttdoc">Peer certificate verification failure.</div></div>
<div class="ttc" id="agroup__security_html_gaeaa77dd7852b535baf17b53ee2518454"><div class="ttname"><a href="group__security.html#gaeaa77dd7852b535baf17b53ee2518454">SocketTLS_handshake</a></div><div class="ttdeci">TLSHandshakeState SocketTLS_handshake(Socket_T socket)</div><div class="ttdoc">Perform non-blocking TLS handshake.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1075"></a>
Don't Ignore Verification Failures</h2>
<div class="fragment"><div class="line"><span class="comment">/* BAD - disabling verification */</span></div>
<div class="line">config.verify_ssl = 0;  <span class="comment">/* Never do this in production */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* GOOD - handle failures appropriately */</span></div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gab5e72fc2bd41014c75e0ace4feabfe8e">EXCEPT</a>(<a class="code hl_variable" href="group__security.html#gabe406e483a861198db5bca58300f1728">SocketTLS_VerifyFailed</a>) {</div>
<div class="line">    <span class="comment">/* Log, alert, and abort */</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1077"></a>
HTTP Security</h1>
<h2><a class="anchor" id="autotoc_md1078"></a>
Request Smuggling Prevention</h2>
<p>The HTTP/1.1 parser (SocketHTTP1) includes protections:</p>
<ul>
<li>Rejects both Content-Length AND Transfer-Encoding</li>
<li>Rejects multiple differing Content-Length values</li>
<li>Validates header names/values for injection</li>
<li>Enforces strict parsing mode</li>
</ul>
<h2><a class="anchor" id="autotoc_md1079"></a>
WebSocket Security</h2>
<div class="fragment"><div class="line"><span class="comment">/* Always validate Origin header on server */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *origin = <a class="code hl_function" href="group__http.html#ga14656f39c3a134218da1afd58407bda1">SocketHTTP_Headers_get</a>(headers, <span class="stringliteral">&quot;Origin&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!is_allowed_origin(origin)) {</div>
<div class="line">    <a class="code hl_function" href="group__websocket.html#gad6e400c85623f8603c5965d38b1a60e0">SocketWS_server_reject</a>(socket, 403, <span class="stringliteral">&quot;Origin not allowed&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Validate subprotocols */</span></div>
<div class="line"><span class="keywordflow">if</span> (!is_supported_protocol(selected)) {</div>
<div class="line">    <a class="code hl_function" href="group__websocket.html#gaf04efc033266e882f59db340ca2f8d47">SocketWS_close</a>(ws, <a class="code hl_enumvalue" href="group__websocket.html#gga386c437e966aeaeb091d1d81c0e77b13aaf641b4eedfe849aeed35a84f61709bf">WS_CLOSE_PROTOCOL_ERROR</a>, <span class="stringliteral">&quot;Unsupported protocol&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__http_html_ga14656f39c3a134218da1afd58407bda1"><div class="ttname"><a href="group__http.html#ga14656f39c3a134218da1afd58407bda1">SocketHTTP_Headers_get</a></div><div class="ttdeci">const char * SocketHTTP_Headers_get(SocketHTTP_Headers_T headers, const char *name)</div><div class="ttdoc">Get first header value (case-insensitive).</div></div>
<div class="ttc" id="agroup__websocket_html_gad6e400c85623f8603c5965d38b1a60e0"><div class="ttname"><a href="group__websocket.html#gad6e400c85623f8603c5965d38b1a60e0">SocketWS_server_reject</a></div><div class="ttdeci">void SocketWS_server_reject(Socket_T socket, int status_code, const char *reason)</div><div class="ttdoc">Reject a WebSocket upgrade request with an HTTP error response.</div></div>
<div class="ttc" id="agroup__websocket_html_gaf04efc033266e882f59db340ca2f8d47"><div class="ttname"><a href="group__websocket.html#gaf04efc033266e882f59db340ca2f8d47">SocketWS_close</a></div><div class="ttdeci">int SocketWS_close(SocketWS_T ws, int code, const char *reason)</div><div class="ttdoc">Initiate graceful WebSocket close handshake.</div></div>
<div class="ttc" id="agroup__websocket_html_gga386c437e966aeaeb091d1d81c0e77b13aaf641b4eedfe849aeed35a84f61709bf"><div class="ttname"><a href="group__websocket.html#gga386c437e966aeaeb091d1d81c0e77b13aaf641b4eedfe849aeed35a84f61709bf">WS_CLOSE_PROTOCOL_ERROR</a></div><div class="ttdeci">@ WS_CLOSE_PROTOCOL_ERROR</div><div class="ttdef"><b>Definition</b> <a href="SocketWS_8h_source.html#l00200">SocketWS.h:200</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1080"></a>
Cookie Security</h2>
<div class="fragment"><div class="line"><span class="comment">/* Set secure cookie attributes */</span></div>
<div class="line">SocketHTTPClient_CookieJar_set_flags(jar, </div>
<div class="line">    COOKIE_FLAG_SECURE |     <span class="comment">/* HTTPS only */</span></div>
<div class="line">    COOKIE_FLAG_HTTPONLY |   <span class="comment">/* No JavaScript access */</span></div>
<div class="line">    COOKIE_FLAG_SAMESITE     <span class="comment">/* Prevent CSRF */</span></div>
<div class="line">);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1081"></a>
HTTP/2 Flow Control Hardening</h2>
<p>HTTP/2 flow control now includes enhanced protections (see <a href="HTTP.md#http2-flow-control-security-enhancements" target="_blank">HTTP.md::http2-flow-control-security-enhancements</a>):</p>
<ul>
<li><b>Overflow Prevention</b>: 64-bit checks in window updates/adjustments cap at 2^31-1; errors trigger <code>FLOW_CONTROL_ERROR</code>.</li>
<li><b>Negative Window Rejection</b>: SETTINGS delta adjustments reject cases leading to &lt;0 windows (RFC 9113 6.5.2), closing connections.</li>
<li>**Invalid Inputs**: Zero increments treated as `PROTOCOL_ERROR`; metrics track violations for attack detection.</li>
<li>**Monitoring**: New counters (e.g., `SOCKET_CTR_HTTP2_FLOW_OVERFLOW`) via `SocketMetrics_get` for alerting.</li>
</ul>
<p>Use with `SocketPool` rate limits to mitigate DoS. Fuzz-tested for robustness.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md1083"></a>
File Descriptor Hygiene</h1>
<h2><a class="anchor" id="autotoc_md1084"></a>
Safe Close</h2>
<div class="fragment"><div class="line"><span class="comment">/* Use SAFE_CLOSE to handle EINTR correctly */</span></div>
<div class="line"><a class="code hl_define" href="group__foundation.html#ga71b9fcff797cf3624ea3ec9c02805291">SAFE_CLOSE</a>(fd);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Per POSIX.1-2008: Don&#39;t retry close() on EINTR */</span></div>
<div class="line"><span class="comment">/* The fd state is unspecified - retrying may close wrong fd */</span></div>
<div class="ttc" id="agroup__foundation_html_ga71b9fcff797cf3624ea3ec9c02805291"><div class="ttname"><a href="group__foundation.html#ga71b9fcff797cf3624ea3ec9c02805291">SAFE_CLOSE</a></div><div class="ttdeci">#define SAFE_CLOSE(fd)</div><div class="ttdoc">Safe file descriptor close macro.</div><div class="ttdef"><b>Definition</b> <a href="SocketConfig_8h_source.html#l02680">SocketConfig.h:2680</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1085"></a>
Prevent FD Leaks</h2>
<div class="fragment"><div class="line"><a class="code hl_define" href="group__foundation.html#gad2746371528bdf15c3910b7bf217dac0">TRY</a> {</div>
<div class="line">    Socket_T sock = <a class="code hl_function" href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1">Socket_new</a>(AF_INET, SOCK_STREAM, 0);</div>
<div class="line">    <span class="comment">/* ... operations ... */</span></div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#ga0e2a75478cd44f1666a6aca626c5c50b">FINALLY</a> {</div>
<div class="line">    <span class="keywordflow">if</span> (sock) <a class="code hl_function" href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a>(&amp;sock);  <span class="comment">/* Always clean up */</span></div>
<div class="line">}</div>
<div class="line"><a class="code hl_define" href="group__foundation.html#gae6628ac788ad213363b89dba9868420b">END_TRY</a>;</div>
<div class="ttc" id="agroup__core__io_html_ga6212fb2b6eefa567592a59f55c25a6f1"><div class="ttname"><a href="group__core__io.html#ga6212fb2b6eefa567592a59f55c25a6f1">Socket_new</a></div><div class="ttdeci">Socket_T Socket_new(int domain, int type, int protocol)</div><div class="ttdoc">Create a new socket with specified domain, type, and protocol.</div></div>
<div class="ttc" id="agroup__core__io_html_ga74ad7a9bb8deaf499c59d90d6e411f37"><div class="ttname"><a href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a></div><div class="ttdeci">void Socket_free(Socket_T *socket)</div><div class="ttdoc">Dispose of a socket instance and close the underlying file descriptor.</div></div>
<div class="ttc" id="agroup__foundation_html_ga0e2a75478cd44f1666a6aca626c5c50b"><div class="ttname"><a href="group__foundation.html#ga0e2a75478cd44f1666a6aca626c5c50b">FINALLY</a></div><div class="ttdeci">#define FINALLY</div><div class="ttdoc">Define cleanup code that executes regardless of exceptions.</div><div class="ttdef"><b>Definition</b> <a href="Except_8h_source.html#l01251">Except.h:1251</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1087"></a>
Audit Logging</h1>
<h2><a class="anchor" id="autotoc_md1088"></a>
What to Log</h2>
<ul>
<li><a class="el" href="group__connection__mgmt.html#structConnection" title="Internal structure representing a pooled connection slot.">Connection</a> attempts (source IP, port)</li>
<li>Authentication failures</li>
<li>Certificate verification failures</li>
<li>Rate limiting triggers</li>
<li>Protocol violations</li>
</ul>
<h2><a class="anchor" id="autotoc_md1089"></a>
How to Log Safely</h2>
<div class="fragment"><div class="line"><span class="comment">/* Don&#39;t log sensitive data */</span></div>
<div class="line">log_info(<span class="stringliteral">&quot;Connection from %s:%d&quot;</span>, client_ip, client_port);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* BAD - leaks credentials */</span></div>
<div class="line">log_debug(<span class="stringliteral">&quot;Auth failed for user %s with password %s&quot;</span>, user, pass);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* GOOD - no credentials */</span></div>
<div class="line">log_warn(<span class="stringliteral">&quot;Auth failed for user %s&quot;</span>, user);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md1091"></a>
Security Checklist</h1>
<h2><a class="anchor" id="autotoc_md1092"></a>
Server Applications</h2>
<ul>
<li>[ ] Use TLS 1.3 for all connections</li>
<li>[ ] Validate all input (hostnames, ports, sizes)</li>
<li>[ ] Implement rate limiting</li>
<li>[ ] Enable SYN flood protection</li>
<li>[ ] Per-IP connection limits</li>
<li>[ ] Validate WebSocket Origin headers</li>
<li>[ ] Log security events</li>
<li>[ ] Set appropriate timeouts</li>
</ul>
<h2><a class="anchor" id="autotoc_md1093"></a>
Client Applications</h2>
<ul>
<li>[ ] Verify server certificates</li>
<li>[ ] Consider certificate pinning</li>
<li>[ ] Use async DNS for untrusted hostnames</li>
<li>[ ] Clear credentials after use</li>
<li>[ ] Handle TLS errors properly</li>
<li>[ ] Set reasonable timeouts</li>
</ul>
<h2><a class="anchor" id="autotoc_md1094"></a>
General</h2>
<ul>
<li>[ ] Use exception handling everywhere</li>
<li>[ ] Clean up resources in FINALLY blocks</li>
<li>[ ] Don't disable security features</li>
<li>[ ] Keep dependencies updated</li>
<li>[ ] Review code for injection vulnerabilities</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1096"></a>
TLS Configuration Best Practices</h1>
<h2><a class="anchor" id="autotoc_md1097"></a>
Protocol Version</h2>
<p>The library enforces TLS 1.3 only by default. <b>Do not weaken this</b>:</p>
<div class="fragment"><div class="line"><span class="comment">/* Default: TLS 1.3 only - keep it this way */</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS_MIN_VERSION TLS1_3_VERSION</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS_MAX_VERSION TLS1_3_VERSION</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* BAD: Don&#39;t lower the minimum version */</span></div>
<div class="line"><span class="comment">// SocketTLSContext_set_min_protocol(ctx, TLS1_VERSION);  // INSECURE!</span></div>
</div><!-- fragment --><p><b>Why TLS 1.3 only?</b></p><ul>
<li>Removes all legacy vulnerable ciphers (RC4, DES, 3DES, etc.)</li>
<li>No renegotiation (eliminates CVE-2009-3555 class attacks)</li>
<li>Mandatory forward secrecy (all key exchanges are ephemeral)</li>
<li>Encrypted handshake (protects certificate from passive observers)</li>
<li>Faster: 1-RTT handshake, optional 0-RTT resumption</li>
</ul>
<h2><a class="anchor" id="autotoc_md1098"></a>
Cipher Suite Configuration</h2>
<p>The library uses secure TLS 1.3 cipher suites by default:</p>
<div class="fragment"><div class="line"><span class="comment">/* Default: Modern AEAD ciphers with PFS */</span></div>
<div class="line"><span class="preprocessor">#define SOCKET_TLS13_CIPHERSUITES \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_AES_256_GCM_SHA384:&quot;     \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_CHACHA20_POLY1305_SHA256:&quot; \</span></div>
<div class="line"><span class="preprocessor">    &quot;TLS_AES_128_GCM_SHA256&quot;</span></div>
</div><!-- fragment --><p>All three ciphers provide:</p><ul>
<li><b>AEAD encryption</b> (authenticated encryption with associated data)</li>
<li><b>256-bit or 128-bit keys</b> (both considered secure)</li>
<li><b>Perfect Forward Secrecy</b> (compromised long-term key doesn't decrypt past traffic)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1099"></a>
Certificate Verification</h2>
<p><b>Always verify server certificates in production</b>:</p>
<div class="fragment"><div class="line"><span class="comment">/* Client: Enable verification */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx = <a class="code hl_function" href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a>(<span class="stringliteral">&quot;/etc/ssl/certs/ca-certificates.crt&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga71084c00bec22f65b90301188868b759">SocketTLSContext_set_verify_mode</a>(ctx, <a class="code hl_enumvalue" href="group__security.html#ggac32c3958835b92ff683ae15f78448694ae56010acbcb7edcdcd7707be028cc6fe">TLS_VERIFY_PEER</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* BAD: Never disable verification in production */</span></div>
<div class="line"><span class="comment">// SocketTLSContext_set_verify_mode(ctx, TLS_VERIFY_NONE);  // INSECURE!</span></div>
<div class="ttc" id="agroup__security_html_ga71084c00bec22f65b90301188868b759"><div class="ttname"><a href="group__security.html#ga71084c00bec22f65b90301188868b759">SocketTLSContext_set_verify_mode</a></div><div class="ttdeci">void SocketTLSContext_set_verify_mode(SocketTLSContext_T ctx, TLSVerifyMode mode)</div><div class="ttdoc">Set certificate verification policy.</div></div>
<div class="ttc" id="agroup__security_html_ggac32c3958835b92ff683ae15f78448694ae56010acbcb7edcdcd7707be028cc6fe"><div class="ttname"><a href="group__security.html#ggac32c3958835b92ff683ae15f78448694ae56010acbcb7edcdcd7707be028cc6fe">TLS_VERIFY_PEER</a></div><div class="ttdeci">@ TLS_VERIFY_PEER</div><div class="ttdef"><b>Definition</b> <a href="SocketTLS_8h_source.html#l00600">SocketTLS.h:600</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1100"></a>
Mutual TLS (mTLS)</h2>
<p>For high-security applications, require client certificates:</p>
<div class="fragment"><div class="line"><span class="comment">/* Server: Require client certificate */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> server_ctx = <a class="code hl_function" href="group__security.html#ga79a403f2f54f21c90a92e9cb73e24cbc">SocketTLSContext_new_server</a>(</div>
<div class="line">    <span class="stringliteral">&quot;server.crt&quot;</span>, <span class="stringliteral">&quot;server.key&quot;</span>, <span class="stringliteral">&quot;ca.crt&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga71084c00bec22f65b90301188868b759">SocketTLSContext_set_verify_mode</a>(server_ctx, <a class="code hl_enumvalue" href="group__security.html#ggac32c3958835b92ff683ae15f78448694a29928ea4593855bb860f7a0bb8eb027d">TLS_VERIFY_FAIL_IF_NO_PEER_CERT</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Client: Provide certificate */</span></div>
<div class="line"><a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> client_ctx = <a class="code hl_function" href="group__security.html#ga7fe51da14439d768bdf72f4ed8fbb022">SocketTLSContext_new_client</a>(<span class="stringliteral">&quot;ca.crt&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__security.html#ga1e2af3e4421c3c20c7dbc4b99cfb4211">SocketTLSContext_load_certificate</a>(client_ctx, <span class="stringliteral">&quot;client.crt&quot;</span>, <span class="stringliteral">&quot;client.key&quot;</span>);</div>
<div class="ttc" id="agroup__security_html_ga1e2af3e4421c3c20c7dbc4b99cfb4211"><div class="ttname"><a href="group__security.html#ga1e2af3e4421c3c20c7dbc4b99cfb4211">SocketTLSContext_load_certificate</a></div><div class="ttdeci">void SocketTLSContext_load_certificate(SocketTLSContext_T ctx, const char *cert_file, const char *key_file)</div><div class="ttdoc">Load server certificate and private key.</div></div>
<div class="ttc" id="agroup__security_html_ggac32c3958835b92ff683ae15f78448694a29928ea4593855bb860f7a0bb8eb027d"><div class="ttname"><a href="group__security.html#ggac32c3958835b92ff683ae15f78448694a29928ea4593855bb860f7a0bb8eb027d">TLS_VERIFY_FAIL_IF_NO_PEER_CERT</a></div><div class="ttdeci">@ TLS_VERIFY_FAIL_IF_NO_PEER_CERT</div><div class="ttdef"><b>Definition</b> <a href="SocketTLS_8h_source.html#l00601">SocketTLS.h:601</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1101"></a>
OCSP Stapling</h2>
<p>Enable OCSP stapling for real-time revocation checking:</p>
<div class="fragment"><div class="line"><span class="comment">/* Client: Request OCSP status */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#ga414fb627189037256afd8c4e015b74d1">SocketTLSContext_enable_ocsp_stapling</a>(client_ctx);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* After handshake, check status */</span></div>
<div class="line">OCSPStatus status = <a class="code hl_function" href="group__security.html#gae1a1b2392cfa8dd68e636bbef9df443f">SocketTLS_get_ocsp_status</a>(socket);</div>
<div class="line"><span class="keywordflow">if</span> (status == OCSP_STATUS_REVOKED) {</div>
<div class="line">    <span class="comment">/* Certificate revoked - abort! */</span></div>
<div class="line">    <a class="code hl_function" href="group__core__io.html#ga74ad7a9bb8deaf499c59d90d6e411f37">Socket_free</a>(&amp;socket);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Server: Provide OCSP response */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gacad0c368922de598277e4237779504b7">SocketTLSContext_set_ocsp_response</a>(server_ctx, ocsp_response, ocsp_len);</div>
<div class="ttc" id="agroup__security_html_ga414fb627189037256afd8c4e015b74d1"><div class="ttname"><a href="group__security.html#ga414fb627189037256afd8c4e015b74d1">SocketTLSContext_enable_ocsp_stapling</a></div><div class="ttdeci">void SocketTLSContext_enable_ocsp_stapling(SocketTLSContext_T ctx)</div><div class="ttdoc">Enable OCSP stapling request (client).</div></div>
<div class="ttc" id="agroup__security_html_gacad0c368922de598277e4237779504b7"><div class="ttname"><a href="group__security.html#gacad0c368922de598277e4237779504b7">SocketTLSContext_set_ocsp_response</a></div><div class="ttdeci">void SocketTLSContext_set_ocsp_response(SocketTLSContext_T ctx, const unsigned char *response, size_t len)</div><div class="ttdoc">Set static OCSP response for stapling.(server)</div></div>
<div class="ttc" id="agroup__security_html_gae1a1b2392cfa8dd68e636bbef9df443f"><div class="ttname"><a href="group__security.html#gae1a1b2392cfa8dd68e636bbef9df443f">SocketTLS_get_ocsp_status</a></div><div class="ttdeci">int SocketTLS_get_ocsp_status(Socket_T socket)</div><div class="ttdoc">Get OCSP status after handshake (client).</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1102"></a>
Certificate Transparency</h2>
<p>Enable CT verification to detect misissued certificates:</p>
<div class="fragment"><div class="line"><span class="comment">/* Client: Require valid SCTs */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gaf27bede9402c6c8c7541143e019c635f">SocketTLSContext_enable_ct</a>(ctx, <a class="code hl_enumvalue" href="group__security.html#gga4d930163393a67950a5378e540c0e939a102a7857300a9c88684ed50efe69d3ab">CT_VALIDATION_STRICT</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Or permissive mode (log but don&#39;t fail) */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gaf27bede9402c6c8c7541143e019c635f">SocketTLSContext_enable_ct</a>(ctx, <a class="code hl_enumvalue" href="group__security.html#gga4d930163393a67950a5378e540c0e939aea499abb40ae318f0fd2b596ce6cbaa8">CT_VALIDATION_PERMISSIVE</a>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1103"></a>
Certificate Revocation Lists (CRL)</h2>
<p>CRLs provide certificate revocation checking without online OCSP queries:</p>
<p><b>Initial CRL Loading:</b></p>
<div class="fragment"><div class="line"><span class="comment">/* Load CRL from file or directory */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#ga8bf03223d7c3b3cd28f8d03fe082d15e">SocketTLSContext_load_crl</a>(ctx, <span class="stringliteral">&quot;/path/to/crl.pem&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* CRL directory (OpenSSL hashed names required) */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#ga8bf03223d7c3b3cd28f8d03fe082d15e">SocketTLSContext_load_crl</a>(ctx, <span class="stringliteral">&quot;/etc/ssl/crls/&quot;</span>);</div>
<div class="ttc" id="agroup__security_html_ga8bf03223d7c3b3cd28f8d03fe082d15e"><div class="ttname"><a href="group__security.html#ga8bf03223d7c3b3cd28f8d03fe082d15e">SocketTLSContext_load_crl</a></div><div class="ttdeci">void SocketTLSContext_load_crl(SocketTLSContext_T ctx, const char *crl_path)</div><div class="ttdoc">Load CRL file or directory into verification store.</div></div>
</div><!-- fragment --><p><b>Manual CRL Refresh Workflow:</b></p>
<p>CRLs have expiration dates and must be refreshed periodically:</p>
<div class="fragment"><div class="line"><span class="comment">/* 1. Download updated CRL from CA&#39;s distribution point */</span></div>
<div class="line"><span class="comment">/* (Use curl, wget, or HTTP client to fetch from CDP URL) */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* 2. Reload CRL into context */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gac5ba25c0153bc63b6087cff6304f4938">SocketTLSContext_reload_crl</a>(ctx, <span class="stringliteral">&quot;/path/to/updated-crl.pem&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* 3. Schedule next refresh before CRL expires */</span></div>
<div class="line"><span class="comment">/* Typically refresh at 50% of validity period */</span></div>
<div class="ttc" id="agroup__security_html_gac5ba25c0153bc63b6087cff6304f4938"><div class="ttname"><a href="group__security.html#gac5ba25c0153bc63b6087cff6304f4938">SocketTLSContext_reload_crl</a></div><div class="ttdeci">void SocketTLSContext_reload_crl(SocketTLSContext_T ctx, const char *crl_path)</div><div class="ttdoc">Reload CRL from path (alias for refresh_crl).</div></div>
</div><!-- fragment --><p><b>Automatic CRL Refresh:</b></p>
<p>For production systems, configure automatic refresh:</p>
<div class="fragment"><div class="line"><span class="comment">/* Enable automatic CRL refresh every 6 hours */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gac049c86b0b5edba0a7bcb73ca2e1e2eb">SocketTLSContext_set_crl_auto_refresh</a>(ctx, <span class="stringliteral">&quot;/path/to/crl.pem&quot;</span>, </div>
<div class="line">                                       6 * 3600,  <span class="comment">/* 6 hours */</span></div>
<div class="line">                                       crl_refresh_callback,</div>
<div class="line">                                       user_data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback notifies application of refresh success/failure */</span></div>
<div class="line"><span class="keywordtype">void</span> crl_refresh_callback(<a class="code hl_struct" href="group__security.html#structSocketTLSContext__T">SocketTLSContext_T</a> ctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *path,</div>
<div class="line">                          <span class="keywordtype">int</span> success, <span class="keywordtype">void</span> *data) {</div>
<div class="line">    <span class="keywordflow">if</span> (!success) {</div>
<div class="line">        log_error(<span class="stringliteral">&quot;CRL refresh failed for %s&quot;</span>, path);</div>
<div class="line">        <span class="comment">/* Consider alerting or using cached CRL */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Cancel auto-refresh when done */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#gab4bee293124b9d83681f9471f0519689">SocketTLSContext_cancel_crl_auto_refresh</a>(ctx);</div>
<div class="ttc" id="agroup__security_html_gab4bee293124b9d83681f9471f0519689"><div class="ttname"><a href="group__security.html#gab4bee293124b9d83681f9471f0519689">SocketTLSContext_cancel_crl_auto_refresh</a></div><div class="ttdeci">void SocketTLSContext_cancel_crl_auto_refresh(SocketTLSContext_T ctx)</div><div class="ttdoc">Disable automatic CRL refresh.</div></div>
<div class="ttc" id="agroup__security_html_gac049c86b0b5edba0a7bcb73ca2e1e2eb"><div class="ttname"><a href="group__security.html#gac049c86b0b5edba0a7bcb73ca2e1e2eb">SocketTLSContext_set_crl_auto_refresh</a></div><div class="ttdeci">void SocketTLSContext_set_crl_auto_refresh(SocketTLSContext_T ctx, const char *crl_path, long interval_seconds, SocketTLSCrlCallback callback, void *user_data)</div><div class="ttdoc">Enable automatic CRL refresh.</div></div>
</div><!-- fragment --><p><b>CRL Best Practices:</b></p>
<ul>
<li><b>Refresh frequency:</b> Check CRL's nextUpdate field; refresh at 50% of validity</li>
<li><b>Fallback:</b> Cache last known good CRL in case download fails</li>
<li><b>Delta CRLs:</b> Not currently supported; use complete CRLs</li>
<li><b>Multiple CRLs:</b> Call <code>load_crl()</code> multiple times for different issuers</li>
<li><b>CRL vs OCSP:</b> Use OCSP stapling for real-time checks; CRLs for offline validation</li>
</ul>
<p><b>Generating CRL Hash Links (for directory mode):</b></p>
<div class="fragment"><div class="line"># OpenSSL requires hashed symlinks for CRL directories</div>
<div class="line">c_rehash /etc/ssl/crls/</div>
<div class="line"># Or manually:</div>
<div class="line">ln -s crl.pem $(openssl crl -hash -noout -in crl.pem).r0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1104"></a>
Session Resumption Security</h2>
<p>Session resumption improves performance but has security considerations:</p>
<div class="fragment"><div class="line"><span class="comment">/* Enable with appropriate timeout */</span></div>
<div class="line"><a class="code hl_function" href="group__security.html#ga6f0a68e802e789df40eaa28cb641a422">SocketTLSContext_enable_session_cache</a>(ctx, 1000, 300);  <span class="comment">/* 5 min timeout */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* For high-security: disable session tickets */</span></div>
<div class="line"><span class="comment">/* (Session tickets encrypt session state with server key - if key</span></div>
<div class="line"><span class="comment">   is compromised, all past sessions can be decrypted) */</span></div>
<div class="ttc" id="agroup__security_html_ga6f0a68e802e789df40eaa28cb641a422"><div class="ttname"><a href="group__security.html#ga6f0a68e802e789df40eaa28cb641a422">SocketTLSContext_enable_session_cache</a></div><div class="ttdeci">void SocketTLSContext_enable_session_cache(SocketTLSContext_T ctx, size_t max_sessions, long timeout_seconds)</div><div class="ttdoc">Enable session caching.infrastructure.</div></div>
</div><!-- fragment --><p><b>Session Ticket Key Rotation:</b></p><ul>
<li>Rotate session ticket keys regularly (every few hours)</li>
<li>Use <code>SocketTLSContext_rotate_ticket_key()</code> for key rotation</li>
<li>Old tickets become invalid after rotation</li>
</ul>
<h2><a class="anchor" id="autotoc_md1105"></a>
Renegotiation Protection</h2>
<p>TLS renegotiation is disabled by default (SSL_OP_NO_RENEGOTIATION):</p>
<div class="fragment"><div class="line"><span class="comment">/* Renegotiation is automatically disabled for all contexts.</span></div>
<div class="line"><span class="comment"> * TLS 1.3 doesn&#39;t support renegotiation at all.</span></div>
<div class="line"><span class="comment"> * For TLS 1.2 (if ever enabled), renegotiation is blocked.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Renegotiation vulnerabilities:</span></div>
<div class="line"><span class="comment"> * - CVE-2009-3555: Prefix injection attack</span></div>
<div class="line"><span class="comment"> * - Triple Handshake Attack</span></div>
<div class="line"><span class="comment"> * - DoS via repeated renegotiation</span></div>
<div class="line"><span class="comment"> */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1106"></a>
Private Key Protection</h2>
<div class="fragment"><div class="line"><span class="comment">/* Use strong key files with restricted permissions */</span></div>
<div class="line">chmod 600 server.key  <span class="comment">/* Owner read/write only */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Consider using encrypted keys */</span></div>
<div class="line"><span class="comment">/* The library will prompt for passphrase or use callback */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* For production: Use HSM or key management service */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1107"></a>
TLS Security Checklist</h2>
<p><b>Server Configuration:</b></p><ul>
<li>[ ] TLS 1.3 only (default)</li>
<li>[ ] Valid certificate from trusted CA</li>
<li>[ ] Strong private key (RSA 2048+ or ECDSA P-256+)</li>
<li>[ ] OCSP stapling enabled</li>
<li>[ ] Session ticket key rotation</li>
<li>[ ] Certificate Transparency support</li>
</ul>
<p><b>Client Configuration:</b></p><ul>
<li>[ ] Verify server certificates</li>
<li>[ ] Use system CA bundle or explicit trust anchor</li>
<li>[ ] Consider certificate pinning for known servers</li>
<li>[ ] Enable OCSP stapling request</li>
<li>[ ] Enable CT verification in strict mode</li>
</ul>
<p><b>Both:</b></p><ul>
<li>[ ] Keep OpenSSL updated</li>
<li>[ ] Monitor for new vulnerabilities</li>
<li>[ ] Test with tools like testssl.sh or ssllabs.com</li>
<li>[ ] Log TLS errors for security monitoring</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md1109"></a>
See Also</h1>
<ul>
<li><a class="el" href="SocketTLSConfig_8h.html">SocketTLSConfig.h</a> - TLS configuration constants</li>
<li><a class="el" href="SocketTLSContext_8h.html">SocketTLSContext.h</a> - TLS context management</li>
<li><a class="el" href="SocketTLS_8h.html">SocketTLS.h</a> - TLS socket operations</li>
<li><a class="el" href="SocketSYNProtect_8h.html">SocketSYNProtect.h</a> - DoS protection</li>
<li><a class="el" href="SocketRateLimit_8h.html">SocketRateLimit.h</a> - Rate limiting</li>
<li><a class="el" href="SocketCrypto_8h.html">SocketCrypto.h</a> - Cryptographic utilities </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr class="footer"/>
<footer class="footer">
  <div style="max-width: 960px; margin: 0 auto; padding: 40px 24px;">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 40px;">
      <!-- Brand -->
      <div style="flex: 1; min-width: 200px;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
          <div style="width: 24px; height: 24px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 6px;"></div>
          <span style="font-size: 1rem; font-weight: 600; color: #f7f9fa;">Socket Library</span>
        </div>
        <p style="color: #8b98a5; font-size: 0.8125rem; line-height: 1.6; margin: 0;">
          High-performance socket toolkit for POSIX systems with exception-based error handling and TLS 1.3 support.
        </p>
      </div>
      <!-- Links -->
      <div style="display: flex; gap: 48px; flex-wrap: wrap;">
        <div>
          <h4 style="font-size: 0.75rem; font-weight: 600; color: #f7f9fa; text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 12px 0;">Documentation</h4>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="margin: 6px 0;"><a href="index.html" style="color: #8b98a5; text-decoration: none; font-size: 0.8125rem;">Getting Started</a></li>
            <li style="margin: 6px 0;"><a href="annotated.html" style="color: #8b98a5; text-decoration: none; font-size: 0.8125rem;">Data Structures</a></li>
            <li style="margin: 6px 0;"><a href="globals.html" style="color: #8b98a5; text-decoration: none; font-size: 0.8125rem;">API Reference</a></li>
          </ul>
        </div>
        <div>
          <h4 style="font-size: 0.75rem; font-weight: 600; color: #f7f9fa; text-transform: uppercase; letter-spacing: 0.05em; margin: 0 0 12px 0;">Resources</h4>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="margin: 6px 0;"><a href="files.html" style="color: #8b98a5; text-decoration: none; font-size: 0.8125rem;">Header Files</a></li>
            <li style="margin: 6px 0;"><a href="https://x.com/tetsuocorp" target="_blank" style="color: #8b98a5; text-decoration: none; font-size: 0.8125rem;">Twitter/X</a></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Bottom -->
    <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 0.75rem; font-weight: 500; color: #10b981; background: rgba(16, 185, 129, 0.1); padding: 4px 8px; border-radius: 4px;">C11</span>
        <span style="font-size: 0.75rem; font-weight: 500; color: #3b82f6; background: rgba(59, 130, 246, 0.1); padding: 4px 8px; border-radius: 4px;">POSIX</span>
        <span style="font-size: 0.75rem; font-weight: 500; color: #8b5cf6; background: rgba(139, 92, 246, 0.1); padding: 4px 8px; border-radius: 4px;">TLS 1.3</span>
      </div>
      <div style="color: #6e7681; font-size: 0.75rem; display: flex; align-items: center; gap: 8px;">
        <span> 2025 Tetsuo Corporation</span>
        <span style="color: #30363d;"></span>
        <a href="https://opensource.org/licenses/MIT" target="_blank" style="color: #8b98a5; text-decoration: none;">MIT License</a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
