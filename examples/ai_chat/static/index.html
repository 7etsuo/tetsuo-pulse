<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>#ai-debate</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Courier New', Consolas, monospace;
      background: #0a0a0a; color: #c0c0c0;
      height: 100vh; display: flex; flex-direction: column;
    }
    #header {
      background: #1a1a1a; padding: 8px 12px;
      border-bottom: 1px solid #333;
      display: flex; justify-content: space-between; align-items: center;
    }
    #header .channel { color: #5f9; font-weight: bold; }
    #header .topic { color: #f95; font-size: 0.9em; margin-left: 1em; }
    #header .status { font-size: 0.85em; }
    .connected { color: #5f9; }
    .disconnected { color: #f55; }
    #messages {
      flex: 1; overflow-y: auto; padding: 8px 12px;
      font-size: 14px; line-height: 1.4;
    }
    .line { white-space: pre-wrap; word-wrap: break-word; }
    .line .time { color: #666; }
    .line .nick { font-weight: bold; }
    .line .nick.sage { color: #59f; }
    .line .nick.nova { color: #5f9; }
    .line .nick.echo { color: #fd5; }
    .line .nick.server { color: #f5f; }
    .line .text { color: #ddd; }
    .line.action { color: #888; font-style: italic; }
    .line.join { color: #5a5; }
    .line.topic { color: #f95; }
  </style>
</head>
<body>
  <div id="header">
    <div>
      <span class="channel">#ai-debate</span>
      <span class="topic" id="topic"></span>
    </div>
    <span id="status" class="status">connecting...</span>
  </div>
  <div id="messages"></div>
  <script>
    const messagesEl = document.getElementById('messages');
    const topicEl = document.getElementById('topic');
    const statusEl = document.getElementById('status');

    function timestamp() {
      const d = new Date();
      return d.toTimeString().slice(0, 8);
    }

    function addLine(html, cls = '') {
      const div = document.createElement('div');
      div.className = 'line' + (cls ? ' ' + cls : '');
      div.innerHTML = html;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function nickClass(name) {
      return name.toLowerCase();
    }

    function connect() {
      const ws = new WebSocket(`ws://${location.host}/ws`);

      ws.onopen = () => {
        statusEl.className = 'status connected';
        statusEl.textContent = 'connected';
        addLine(`<span class="time">[${timestamp()}]</span> <span class="nick server">***</span> <span class="text">Connected to server</span>`, 'join');
      };

      ws.onclose = () => {
        statusEl.className = 'status disconnected';
        statusEl.textContent = 'disconnected';
        addLine(`<span class="time">[${timestamp()}]</span> <span class="nick server">***</span> <span class="text">Disconnected, reconnecting...</span>`);
        setTimeout(connect, 2000);
      };

      ws.onmessage = (e) => {
        const data = JSON.parse(e.data);

        if (data.type === 'topic') {
          topicEl.textContent = data.text;
          addLine(`<span class="time">[${timestamp()}]</span> <span class="nick server">***</span> <span class="text">Topic: ${data.text}</span>`, 'topic');
        } else if (data.type === 'thinking') {
          addLine(`<span class="time">[${timestamp()}]</span> <span class="nick server">*</span> <span class="text">${data.agent} is typing...</span>`, 'action');
        } else if (data.type === 'msg') {
          const nc = nickClass(data.agent);
          addLine(`<span class="time">[${timestamp()}]</span> &lt;<span class="nick ${nc}">${data.agent}</span>&gt; <span class="text">${escapeHtml(data.text)}</span>`);
        }
      };
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    connect();
  </script>
</body>
</html>
